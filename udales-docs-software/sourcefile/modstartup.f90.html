<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
    <meta name="description" content="Documentation for uDALES">
   
    <meta name="author" content="The uDALES Team" >
    <link rel="icon" href="../favicon.png">

    <title>modstartup.f90 &ndash; uDALES</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">uDALES </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/dalesurban.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/dalesurban.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>modstartup.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title="10.1% of total for source files.">1430 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/modstartup.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">modstartup.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/modstartup.html">modstartup</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/modstartup.f90.html#src">modstartup.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~modstartup.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefilemodstartupf90EfferentGraph" width="641pt" height="514pt"
 viewBox="0.00 0.00 641.00 514.31" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~modstartup.f90~~EfferentGraph" class="graph" transform="scale(.5935 .5935) rotate(0) translate(4 862.5474)">
<title>sourcefile~~modstartup.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-862.5474 1076,-862.5474 1076,4 -4,4"/>
<!-- sourcefile~modstartup.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~modstartup.f90</title>
<polygon fill="none" stroke="#000000" points="1072,-282 978,-282 978,-258 1072,-258 1072,-282"/>
<text text-anchor="middle" x="1025" y="-267.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">modstartup.f90</text>
</g>
<!-- sourcefile~modmpi.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~modmpi.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/modmpi.f90.html" xlink:title="modmpi.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="77,-303 0,-303 0,-279 77,-279 77,-303"/>
<text text-anchor="middle" x="38.5" y="-288.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modmpi.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modstartup.f90&#45;&gt;sourcefile~modmpi.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~modstartup.f90&#45;&gt;sourcefile~modmpi.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M469.5,-848C394.898,-836.0342 369.6418,-876.0851 299.5,-848"/>
</g>
<!-- sourcefile~modibmdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~modibmdata.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/modibmdata.f90.html" xlink:title="modibmdata.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="350,-630 249,-630 249,-606 350,-606 350,-630"/>
<text text-anchor="middle" x="299.5" y="-615.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modibmdata.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modstartup.f90&#45;&gt;sourcefile~modibmdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~modstartup.f90&#45;&gt;sourcefile~modibmdata.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M756,-772C601.8214,-833.6788 544.3522,-746.6119 396,-672 377.8915,-662.8925 377.4533,-654.3076 360,-644 354.0476,-640.4846 347.5317,-637.1793 341.0505,-634.181"/>
<polygon fill="#ff0000" stroke="#ff0000" points="342.2104,-630.8668 331.6496,-630.019 339.3767,-637.2676 342.2104,-630.8668"/>
</g>
<!-- sourcefile~modboundary.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~modboundary.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/modboundary.f90.html" xlink:title="modboundary.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="809,-532 703,-532 703,-508 809,-508 809,-532"/>
<text text-anchor="middle" x="756" y="-517.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modboundary.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modstartup.f90&#45;&gt;sourcefile~modboundary.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~modstartup.f90&#45;&gt;sourcefile~modboundary.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1023.4801,-282.1471C1017.0736,-328.1885 988.0762,-493.7031 893.5,-580"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M893.5,-580C876.4126,-595.5916 816.8402,-560.6604 781.9662,-537.8112"/>
<polygon fill="#ff0000" stroke="#ff0000" points="783.5217,-534.6424 773.2566,-532.0197 779.6457,-540.4714 783.5217,-534.6424"/>
</g>
<!-- sourcefile~modinlet.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~modinlet.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/modinlet.f90.html" xlink:title="modinlet.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="663,-552 583,-552 583,-528 663,-528 663,-552"/>
<text text-anchor="middle" x="623" y="-537.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modinlet.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modstartup.f90&#45;&gt;sourcefile~modinlet.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~modstartup.f90&#45;&gt;sourcefile~modinlet.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M893.5,-580C848.3572,-621.191 816.941,-584.5564 756,-580"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M756,-580C722.526,-577.4972 686.1272,-565.8874 659.8837,-555.8157"/>
<polygon fill="#ff0000" stroke="#ff0000" points="660.9369,-552.4687 650.3502,-552.0531 658.3671,-558.9799 660.9369,-552.4687"/>
</g>
<!-- sourcefile~modinletdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~modinletdata.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node6"><a xlink:href=".././sourcefile/modinletdata.f90.html" xlink:title="modinletdata.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="351.5,-710 247.5,-710 247.5,-686 351.5,-686 351.5,-710"/>
<text text-anchor="middle" x="299.5" y="-695.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modinletdata.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modstartup.f90&#45;&gt;sourcefile~modinletdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~modstartup.f90&#45;&gt;sourcefile~modinletdata.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M756,-772C634.4138,-822.71 598.4047,-875.1715 469.5,-848"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M469.5,-848C394.979,-836.0472 336.7178,-757.8448 312.1674,-719.3438"/>
<polygon fill="#ff0000" stroke="#ff0000" points="314.9102,-717.1259 306.6628,-710.4753 308.9628,-720.8175 314.9102,-717.1259"/>
</g>
<!-- sourcefile~modfields.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node7" class="node">
<title>sourcefile~modfields.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node7"><a xlink:href=".././sourcefile/modfields.f90.html" xlink:title="modfields.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="342,-303 257,-303 257,-279 342,-279 342,-303"/>
<text text-anchor="middle" x="299.5" y="-288.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modfields.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modstartup.f90&#45;&gt;sourcefile~modfields.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge13" class="edge">
<title>sourcefile~modstartup.f90&#45;&gt;sourcefile~modfields.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M893.5,-270C773.4794,-263.0405 742.4256,-283.8169 623,-270"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M623,-270C579.6911,-264.4938 582.5729,-231.4379 543,-213 512.4162,-198.7503 502.8444,-188.8453 469.5,-194"/>
</g>
<!-- sourcefile~modpois.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node8" class="node">
<title>sourcefile~modpois.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node8"><a xlink:href=".././sourcefile/modpois.f90.html" xlink:title="modpois.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="933,-206 854,-206 854,-182 933,-182 933,-206"/>
<text text-anchor="middle" x="893.5" y="-191.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modpois.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modstartup.f90&#45;&gt;sourcefile~modpois.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~modstartup.f90&#45;&gt;sourcefile~modpois.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1004.1634,-257.9576C982.4581,-245.4131 948.2441,-225.6392 923.6035,-211.3982"/>
<polygon fill="#ff0000" stroke="#ff0000" points="925.0839,-208.2114 914.6745,-206.2377 921.5812,-214.272 925.0839,-208.2114"/>
</g>
<!-- sourcefile~modglobal.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node9" class="node">
<title>sourcefile~modglobal.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node9"><a xlink:href=".././sourcefile/modglobal.f90.html" xlink:title="modglobal.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="203,-303 113,-303 113,-279 203,-279 203,-303"/>
<text text-anchor="middle" x="158" y="-288.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modglobal.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modstartup.f90&#45;&gt;sourcefile~modglobal.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~modstartup.f90&#45;&gt;sourcefile~modglobal.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1018.761,-257.8533C993.2819,-210.1176 891.9847,-38 756,-38 756,-38 756,-38 469.5,-38 357.1107,-38 321.36,-65.5266 239,-142 200.0361,-178.179 175.7372,-237.4593 164.8024,-269.2461"/>
<polygon fill="#ff0000" stroke="#ff0000" points="161.427,-268.3054 161.6045,-278.8988 168.0718,-270.5069 161.427,-268.3054"/>
</g>
<!-- sourcefile~modsubgrid.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node10" class="node">
<title>sourcefile~modsubgrid.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node10"><a xlink:href=".././sourcefile/modsubgrid.f90.html" xlink:title="modsubgrid.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="942,-398 845,-398 845,-374 942,-374 942,-398"/>
<text text-anchor="middle" x="893.5" y="-383.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modsubgrid.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modstartup.f90&#45;&gt;sourcefile~modsubgrid.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge10" class="edge">
<title>sourcefile~modstartup.f90&#45;&gt;sourcefile~modsubgrid.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1010.9272,-282.414C987.99,-302.6476 942.3858,-342.8764 915.2534,-366.8107"/>
<polygon fill="#ff0000" stroke="#ff0000" points="912.6555,-364.4352 907.4716,-373.6752 917.2862,-369.6847 912.6555,-364.4352"/>
</g>
<!-- sourcefile~modthermodynamics.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node11" class="node">
<title>sourcefile~modthermodynamics.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node11"><a xlink:href=".././sourcefile/modthermodynamics.f90.html" xlink:title="modthermodynamics.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="543,-166 396,-166 396,-142 543,-142 543,-166"/>
<text text-anchor="middle" x="469.5" y="-151.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modthermodynamics.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modstartup.f90&#45;&gt;sourcefile~modthermodynamics.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge14" class="edge">
<title>sourcefile~modstartup.f90&#45;&gt;sourcefile~modthermodynamics.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M977.6999,-274.4391C952.473,-275.6963 921.0404,-275.4822 893.5,-270"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M893.5,-270C754.5346,-242.3376 594.1197,-193.7849 516.4619,-169.1934"/>
<polygon fill="#ff0000" stroke="#ff0000" points="517.1022,-165.7244 506.5118,-166.0301 514.9813,-172.3954 517.1022,-165.7244"/>
</g>
<!-- sourcefile~moddriver.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node12" class="node">
<title>sourcefile~moddriver.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node12"><a xlink:href=".././sourcefile/moddriver.f90.html" xlink:title="moddriver.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="667,-632 579,-632 579,-608 667,-608 667,-632"/>
<text text-anchor="middle" x="623" y="-617.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">moddriver.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modstartup.f90&#45;&gt;sourcefile~moddriver.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge11" class="edge">
<title>sourcefile~modstartup.f90&#45;&gt;sourcefile~moddriver.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M893.5,-580C831.7598,-636.3354 869.2935,-690.1188 809,-748 790.3462,-765.9075 780.0083,-762.3956 756,-772"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M756,-772C690.623,-798.1539 645.9749,-689.7476 629.763,-641.7925"/>
<polygon fill="#ff0000" stroke="#ff0000" points="633.0076,-640.4529 626.576,-632.0336 626.3534,-642.6261 633.0076,-640.4529"/>
</g>
<!-- sourcefile~modsurfdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node13" class="node">
<title>sourcefile~modsurfdata.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node13"><a xlink:href=".././sourcefile/modsurfdata.f90.html" xlink:title="modsurfdata.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="350,-354 249,-354 249,-330 350,-330 350,-354"/>
<text text-anchor="middle" x="299.5" y="-339.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modsurfdata.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modstartup.f90&#45;&gt;sourcefile~modsurfdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge12" class="edge">
<title>sourcefile~modstartup.f90&#45;&gt;sourcefile~modsurfdata.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M623,-270C516.7564,-256.4925 393.986,-300.6922 334.8904,-325.8223"/>
<polygon fill="#ff0000" stroke="#ff0000" points="333.4157,-322.6468 325.6267,-329.8288 336.1944,-329.0716 333.4157,-322.6468"/>
</g>
<!-- sourcefile~modforces.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node14" class="node">
<title>sourcefile~modforces.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node14"><a xlink:href=".././sourcefile/modforces.f90.html" xlink:title="modforces.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="514.5,-246 424.5,-246 424.5,-222 514.5,-222 514.5,-246"/>
<text text-anchor="middle" x="469.5" y="-231.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modforces.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modstartup.f90&#45;&gt;sourcefile~modforces.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~modstartup.f90&#45;&gt;sourcefile~modforces.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M623,-270C587.8216,-265.9301 548.9956,-256.7794 519.1934,-248.7227"/>
<polygon fill="#ff0000" stroke="#ff0000" points="520.021,-245.3205 509.4508,-246.0414 518.1635,-252.0695 520.021,-245.3205"/>
</g>
<!-- sourcefile~modsubgriddata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node15" class="node">
<title>sourcefile~modsubgriddata.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node15"><a xlink:href=".././sourcefile/modsubgriddata.f90.html" xlink:title="modsubgriddata.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="360,-508 239,-508 239,-484 360,-484 360,-508"/>
<text text-anchor="middle" x="299.5" y="-493.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modsubgriddata.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modstartup.f90&#45;&gt;sourcefile~modsubgriddata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge9" class="edge">
<title>sourcefile~modstartup.f90&#45;&gt;sourcefile~modsubgriddata.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M756,-580C677.1016,-574.101 650.6122,-594.6371 579,-561 558.8018,-551.5127 562.1002,-537.5394 543,-526 513.587,-508.2302 503.8455,-503.1282 469.5,-502"/>
</g>
<!-- sourcefile~modboundary.f90&#45;&gt;sourcefile~modmpi.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge15" class="edge">
<title>sourcefile~modboundary.f90&#45;&gt;sourcefile~modmpi.f90</title>
<path fill="none" stroke="#ffda00" stroke-dasharray="5,2" d="M737.4904,-532.1008C726.0945,-540.4103 711.9948,-552.3751 703,-566 674.1934,-609.6349 701.6438,-638.8384 667,-678 637.19,-711.6974 340.7674,-865.9206 299.5,-848"/>
<path fill="none" stroke="#ffda00" stroke-dasharray="5,2" d="M299.5,-848C201.7548,-808.8624 234.8544,-729.9672 158,-658"/>
</g>
<!-- sourcefile~modboundary.f90&#45;&gt;sourcefile~modinlet.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge16" class="edge">
<title>sourcefile~modboundary.f90&#45;&gt;sourcefile~modinlet.f90</title>
<path fill="none" stroke="#ffda00" stroke-dasharray="5,2" d="M702.6702,-528.0195C693.011,-529.472 682.9656,-530.9826 673.394,-532.422"/>
<polygon fill="#ffda00" stroke="#ffda00" points="672.6026,-529.0015 663.2343,-533.9497 673.6436,-535.9237 672.6026,-529.0015"/>
</g>
<!-- sourcefile~modboundary.f90&#45;&gt;sourcefile~modinletdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge17" class="edge">
<title>sourcefile~modboundary.f90&#45;&gt;sourcefile~modinletdata.f90</title>
<path fill="none" stroke="#ffda00" stroke-dasharray="5,2" d="M738.6065,-532.1629C727.3808,-540.6675 713.051,-552.8266 703,-566 680.572,-595.3955 695.6541,-617.6322 667,-641 580.087,-711.8785 441.9252,-712.8142 362.0752,-706.0906"/>
<polygon fill="#ffda00" stroke="#ffda00" points="361.9587,-702.5656 351.6825,-705.1443 361.3238,-709.5368 361.9587,-702.5656"/>
</g>
<!-- sourcefile~modboundary.f90&#45;&gt;sourcefile~modfields.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge21" class="edge">
<title>sourcefile~modboundary.f90&#45;&gt;sourcefile~modfields.f90</title>
<path fill="none" stroke="#ffda00" stroke-dasharray="5,2" d="M751.5542,-507.9861C741.0312,-481.153 712.0512,-415.8944 667,-380 594.393,-322.1506 561.7045,-322.8003 469.5,-312"/>
</g>
<!-- sourcefile~modboundary.f90&#45;&gt;sourcefile~modglobal.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge18" class="edge">
<title>sourcefile~modboundary.f90&#45;&gt;sourcefile~modglobal.f90</title>
<path fill="none" stroke="#ffda00" stroke-dasharray="5,2" d="M702.7622,-513.0016C678.3743,-509.5376 649.1408,-505.0223 623,-500"/>
<path fill="none" stroke="#ffda00" stroke-dasharray="5,2" d="M623,-500C579.3538,-491.6145 583.6564,-457.9546 543,-440 512.5803,-426.5661 502.7034,-427.833 469.5,-426"/>
</g>
<!-- sourcefile~modboundary.f90&#45;&gt;sourcefile~moddriver.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge19" class="edge">
<title>sourcefile~modboundary.f90&#45;&gt;sourcefile~moddriver.f90</title>
<path fill="none" stroke="#ffda00" stroke-dasharray="5,2" d="M739.9571,-532.0623C716.8903,-549.4058 674.1747,-581.5228 647.244,-601.7714"/>
<polygon fill="#ffda00" stroke="#ffda00" points="644.9892,-599.0878 639.0998,-607.8949 649.196,-604.6827 644.9892,-599.0878"/>
</g>
<!-- sourcefile~modboundary.f90&#45;&gt;sourcefile~modsurfdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge20" class="edge">
<title>sourcefile~modboundary.f90&#45;&gt;sourcefile~modsurfdata.f90</title>
<path fill="none" stroke="#ffda00" stroke-dasharray="5,2" d="M744.6075,-507.7792C708.5457,-470.4172 592.0232,-359.6578 469.5,-350"/>
</g>
<!-- sourcefile~modboundary.f90&#45;&gt;sourcefile~modsubgriddata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge22" class="edge">
<title>sourcefile~modboundary.f90&#45;&gt;sourcefile~modsubgriddata.f90</title>
<path fill="none" stroke="#ffda00" stroke-dasharray="5,2" d="M623,-500C555.9974,-487.1272 537.6186,-505.8629 469.5,-502"/>
</g>
<!-- sourcefile~modinlet.f90&#45;&gt;sourcefile~modmpi.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge23" class="edge">
<title>sourcefile~modinlet.f90&#45;&gt;sourcefile~modmpi.f90</title>
<path fill="none" stroke="#b6ff00" stroke-dasharray="5,2" d="M610.4958,-552.1234C595.5984,-565.9148 569.3932,-588.1786 543,-601 512.651,-615.743 500.516,-606.7175 469.5,-620"/>
<path fill="none" stroke="#b6ff00" stroke-dasharray="5,2" d="M469.5,-620C433.9157,-635.2389 337.9683,-653.6803 299.5,-658"/>
</g>
<!-- sourcefile~modinlet.f90&#45;&gt;sourcefile~modinletdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge24" class="edge">
<title>sourcefile~modinlet.f90&#45;&gt;sourcefile~modinletdata.f90</title>
<path fill="none" stroke="#b6ff00" stroke-dasharray="5,2" d="M469.5,-620C437.9107,-633.528 426.3475,-627.8781 396,-644 378.0994,-653.5096 377.4533,-661.6924 360,-672 354.0476,-675.5154 347.5317,-678.8207 341.0505,-681.819"/>
<polygon fill="#b6ff00" stroke="#b6ff00" points="339.3767,-678.7324 331.6496,-685.981 342.2104,-685.1332 339.3767,-678.7324"/>
</g>
<!-- sourcefile~modinlet.f90&#45;&gt;sourcefile~modfields.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge27" class="edge">
<title>sourcefile~modinlet.f90&#45;&gt;sourcefile~modfields.f90</title>
<path fill="none" stroke="#b6ff00" stroke-dasharray="5,2" d="M595.5979,-527.8046C589.4959,-524.0778 583.5084,-519.4827 579,-514 548.4662,-476.8678 577.3935,-445.5887 543,-412 518.415,-387.9903 495.6176,-410.3329 469.5,-388"/>
<path fill="none" stroke="#b6ff00" stroke-dasharray="5,2" d="M469.5,-388C428.6047,-353.0308 373.2579,-324.2092 336.9845,-307.3095"/>
<polygon fill="#b6ff00" stroke="#b6ff00" points="338.2895,-304.0575 327.741,-303.0687 335.3705,-310.4199 338.2895,-304.0575"/>
</g>
<!-- sourcefile~modinlet.f90&#45;&gt;sourcefile~modglobal.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge25" class="edge">
<title>sourcefile~modinlet.f90&#45;&gt;sourcefile~modglobal.f90</title>
<path fill="none" stroke="#b6ff00" stroke-dasharray="5,2" d="M582.7113,-543.0412C551.626,-544.655 507.6357,-545.3439 469.5,-540"/>
<path fill="none" stroke="#b6ff00" stroke-dasharray="5,2" d="M469.5,-540C394.6548,-529.5121 362.1457,-578.2766 299.5,-536"/>
<path fill="none" stroke="#b6ff00" stroke-dasharray="5,2" d="M299.5,-536C276.1384,-520.2344 259.322,-536.5279 239,-517 180.1255,-460.4261 163.9244,-358.0963 159.5622,-313.1662"/>
<polygon fill="#b6ff00" stroke="#b6ff00" points="163.0356,-312.7052 158.6895,-303.0428 156.0614,-313.3065 163.0356,-312.7052"/>
</g>
<!-- sourcefile~modinlet.f90&#45;&gt;sourcefile~modsurfdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge26" class="edge">
<title>sourcefile~modinlet.f90&#45;&gt;sourcefile~modsurfdata.f90</title>
<path fill="none" stroke="#b6ff00" stroke-dasharray="5,2" d="M601.7212,-527.9556C594.4285,-523.6887 586.2753,-518.7624 579,-514 562.4868,-503.1906 559.5368,-498.7734 543,-488 479.5788,-446.6825 460.8129,-441.0983 396,-402 372.6677,-387.9248 346.4207,-371.5713 327.1967,-359.4955"/>
<polygon fill="#b6ff00" stroke="#b6ff00" points="328.9589,-356.4691 318.631,-354.106 325.2311,-362.3939 328.9589,-356.4691"/>
</g>
<!-- sourcefile~modsave.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node16" class="node">
<title>sourcefile~modsave.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node16"><a xlink:href=".././sourcefile/modsave.f90.html" xlink:title="modsave.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="510.5,-592 428.5,-592 428.5,-568 510.5,-568 510.5,-592"/>
<text text-anchor="middle" x="469.5" y="-577.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">modsave.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modinlet.f90&#45;&gt;sourcefile~modsave.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge28" class="edge">
<title>sourcefile~modinlet.f90&#45;&gt;sourcefile~modsave.f90</title>
<path fill="none" stroke="#b6ff00" stroke-dasharray="5,2" d="M582.6697,-550.5095C563.5858,-555.4825 540.591,-561.4747 520.3278,-566.755"/>
<polygon fill="#b6ff00" stroke="#b6ff00" points="519.4231,-563.3738 510.6289,-569.2824 521.1883,-570.1475 519.4231,-563.3738"/>
</g>
<!-- sourcefile~modfields.f90&#45;&gt;sourcefile~modglobal.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge29" class="edge">
<title>sourcefile~modfields.f90&#45;&gt;sourcefile~modglobal.f90</title>
<path fill="none" stroke="#00ff24" stroke-dasharray="5,2" d="M256.6613,-291C243.0467,-291 227.7899,-291 213.4194,-291"/>
<polygon fill="#00ff24" stroke="#00ff24" points="213.1484,-287.5001 203.1484,-291 213.1483,-294.5001 213.1484,-287.5001"/>
</g>
<!-- sourcefile~modpois.f90&#45;&gt;sourcefile~modmpi.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge30" class="edge">
<title>sourcefile~modpois.f90&#45;&gt;sourcefile~modmpi.f90</title>
<path fill="none" stroke="#00ff91" stroke-dasharray="5,2" d="M885.3105,-181.8644C855.5697,-139.3931 748.4063,0 623,0 623,0 623,0 469.5,0 326.9946,0 279.8822,-2.1587 158,-76"/>
<path fill="none" stroke="#00ff91" stroke-dasharray="5,2" d="M158,-76C84.8972,-118.1969 53.4417,-223.3999 42.9007,-269.1623"/>
<polygon fill="#00ff91" stroke="#00ff91" points="39.4755,-268.4423 40.7581,-278.9592 46.3139,-269.9379 39.4755,-268.4423"/>
</g>
<!-- sourcefile~modpois.f90&#45;&gt;sourcefile~modboundary.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge33" class="edge">
<title>sourcefile~modpois.f90&#45;&gt;sourcefile~modboundary.f90</title>
<path fill="none" stroke="#00ff91" stroke-dasharray="5,2" d="M881.3636,-206.2216C870.3204,-218.0117 854.3575,-236.8444 845,-256 816.0441,-315.2753 830.4045,-337.5993 809,-400 796.8442,-435.4378 778.4265,-474.8813 766.8136,-498.55"/>
<polygon fill="#00ff91" stroke="#00ff91" points="763.598,-497.1563 762.2913,-507.6703 769.8694,-500.266 763.598,-497.1563"/>
</g>
<!-- sourcefile~modpois.f90&#45;&gt;sourcefile~modfields.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge31" class="edge">
<title>sourcefile~modpois.f90&#45;&gt;sourcefile~modfields.f90</title>
<path fill="none" stroke="#00ff91" stroke-dasharray="5,2" d="M853.7928,-190.3805C778.4345,-184.3101 609.6736,-174.5441 469.5,-194"/>
<path fill="none" stroke="#00ff91" stroke-dasharray="5,2" d="M469.5,-194C436.1556,-199.1547 425.4115,-196.4657 396,-213 376.5478,-223.9355 377.145,-233.7163 360,-248 349.4807,-256.7637 337.2717,-265.66 326.5875,-273.0691"/>
<polygon fill="#00ff91" stroke="#00ff91" points="324.3246,-270.3762 318.0421,-278.9074 328.2735,-276.1561 324.3246,-270.3762"/>
</g>
<!-- sourcefile~modpois.f90&#45;&gt;sourcefile~modglobal.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge32" class="edge">
<title>sourcefile~modpois.f90&#45;&gt;sourcefile~modglobal.f90</title>
<path fill="none" stroke="#00ff91" stroke-dasharray="5,2" d="M861.5322,-181.9717C781.7379,-153.6836 567.866,-88.5643 396,-133 303.2058,-156.9918 214.8826,-234.8005 177.1608,-271.5013"/>
<polygon fill="#00ff91" stroke="#00ff91" points="174.5526,-269.1581 169.8961,-278.6748 179.4709,-274.139 174.5526,-269.1581"/>
</g>
<!-- sourcefile~modglobal.f90&#45;&gt;sourcefile~modmpi.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge34" class="edge">
<title>sourcefile~modglobal.f90&#45;&gt;sourcefile~modmpi.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M112.8222,-291C104.4581,-291 95.6884,-291 87.2244,-291"/>
<polygon fill="#00ffff" stroke="#00ffff" points="87.0997,-287.5001 77.0997,-291 87.0997,-294.5001 87.0997,-287.5001"/>
</g>
<!-- sourcefile~modsubgrid.f90&#45;&gt;sourcefile~modmpi.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge35" class="edge">
<title>sourcefile~modsubgrid.f90&#45;&gt;sourcefile~modmpi.f90</title>
<path fill="none" stroke="#0091ff" stroke-dasharray="5,2" d="M882.2953,-373.7635C813.2031,-299.814 438.7946,79.1117 158,-76"/>
</g>
<!-- sourcefile~modsubgrid.f90&#45;&gt;sourcefile~modboundary.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge36" class="edge">
<title>sourcefile~modsubgrid.f90&#45;&gt;sourcefile~modboundary.f90</title>
<path fill="none" stroke="#0091ff" stroke-dasharray="5,2" d="M880.8108,-398.3662C856.8676,-421.7 804.8549,-472.3887 776.1072,-500.4046"/>
<polygon fill="#0091ff" stroke="#0091ff" points="773.3774,-498.1777 768.6585,-507.6637 778.263,-503.1909 773.3774,-498.1777"/>
</g>
<!-- sourcefile~modsubgrid.f90&#45;&gt;sourcefile~modinletdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge37" class="edge">
<title>sourcefile~modsubgrid.f90&#45;&gt;sourcefile~modinletdata.f90</title>
<path fill="none" stroke="#0091ff" stroke-dasharray="5,2" d="M891.3785,-398.2183C884.8468,-432.7043 862.177,-532.2883 809,-594 761.1339,-649.5484 733.9701,-648.137 667,-678 555.8633,-727.5575 517.1109,-728.8095 396,-717 384.5645,-715.8849 372.4736,-714.0434 360.8618,-711.9342"/>
<polygon fill="#0091ff" stroke="#0091ff" points="361.287,-708.4525 350.8093,-710.0234 359.9798,-715.3293 361.287,-708.4525"/>
</g>
<!-- sourcefile~modsubgrid.f90&#45;&gt;sourcefile~modfields.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge40" class="edge">
<title>sourcefile~modsubgrid.f90&#45;&gt;sourcefile~modfields.f90</title>
<path fill="none" stroke="#0091ff" stroke-dasharray="5,2" d="M844.819,-386C818.5183,-386 785.4813,-386 756,-386"/>
<path fill="none" stroke="#0091ff" stroke-dasharray="5,2" d="M756,-386C708.2951,-386 709.5111,-347.6462 667,-326 648.4571,-316.5582 643.4276,-313.9624 623,-310"/>
<path fill="none" stroke="#0091ff" stroke-dasharray="5,2" d="M623,-310C556.0204,-297.0079 537.1713,-320.6982 469.5,-312"/>
<path fill="none" stroke="#0091ff" stroke-dasharray="5,2" d="M469.5,-312C430.2064,-306.9493 385.7722,-301.4684 352.1884,-297.3728"/>
<polygon fill="#0091ff" stroke="#0091ff" points="352.4817,-293.8827 342.1319,-296.1482 351.6355,-300.8314 352.4817,-293.8827"/>
</g>
<!-- sourcefile~modsubgrid.f90&#45;&gt;sourcefile~modglobal.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge38" class="edge">
<title>sourcefile~modsubgrid.f90&#45;&gt;sourcefile~modglobal.f90</title>
<path fill="none" stroke="#0091ff" stroke-dasharray="5,2" d="M756,-386C676.9114,-383.8213 657.2513,-393.3169 579,-405 529.9897,-412.3174 518.9782,-428.7315 469.5,-426"/>
<path fill="none" stroke="#0091ff" stroke-dasharray="5,2" d="M469.5,-426C363.5791,-418.2783 332.3674,-413.6102 239,-363 213.9815,-349.4386 190.2513,-326.769 175.0203,-310.4876"/>
<polygon fill="#0091ff" stroke="#0091ff" points="177.5834,-308.104 168.2576,-303.076 172.4124,-312.8222 177.5834,-308.104"/>
</g>
<!-- sourcefile~modsubgrid.f90&#45;&gt;sourcefile~modsurfdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge39" class="edge">
<title>sourcefile~modsubgrid.f90&#45;&gt;sourcefile~modsurfdata.f90</title>
<path fill="none" stroke="#0091ff" stroke-dasharray="5,2" d="M623,-310C553.7895,-296.5752 539.9023,-353.7203 469.5,-350"/>
<path fill="none" stroke="#0091ff" stroke-dasharray="5,2" d="M469.5,-350C433.2914,-348.0866 392.7321,-346.1693 360.314,-344.6915"/>
<polygon fill="#0091ff" stroke="#0091ff" points="360.2389,-341.1846 350.0905,-344.2277 359.9216,-348.1774 360.2389,-341.1846"/>
</g>
<!-- sourcefile~modsubgrid.f90&#45;&gt;sourcefile~modsubgriddata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge41" class="edge">
<title>sourcefile~modsubgrid.f90&#45;&gt;sourcefile~modsubgriddata.f90</title>
<path fill="none" stroke="#0091ff" stroke-dasharray="5,2" d="M756,-386C618.6255,-386 606.6541,-509.7779 469.5,-502"/>
<path fill="none" stroke="#0091ff" stroke-dasharray="5,2" d="M469.5,-502C436.8821,-500.9286 400.7469,-499.6641 370.2089,-498.5729"/>
<polygon fill="#0091ff" stroke="#0091ff" points="370.1992,-495.0704 360.0803,-498.21 369.9485,-502.0659 370.1992,-495.0704"/>
</g>
<!-- sourcefile~modthermodynamics.f90&#45;&gt;sourcefile~modmpi.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge42" class="edge">
<title>sourcefile~modthermodynamics.f90&#45;&gt;sourcefile~modmpi.f90</title>
<path fill="none" stroke="#0024ff" stroke-dasharray="5,2" d="M439.3053,-166.1002C404.4991,-178.171 346.1027,-192.5891 299.5,-175"/>
<path fill="none" stroke="#0024ff" stroke-dasharray="5,2" d="M299.5,-175C227.6914,-147.8976 225.1839,-38.8875 158,-76"/>
</g>
<!-- sourcefile~modthermodynamics.f90&#45;&gt;sourcefile~modfields.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge44" class="edge">
<title>sourcefile~modthermodynamics.f90&#45;&gt;sourcefile~modfields.f90</title>
<path fill="none" stroke="#0024ff" stroke-dasharray="5,2" d="M419.3135,-166.0621C410.9246,-169.6087 402.7633,-174.1638 396,-180 370.1104,-202.3408 382.5458,-222.2888 360,-248 351.4377,-257.7645 340.2406,-266.505 329.8102,-273.5146"/>
<polygon fill="#0024ff" stroke="#0024ff" points="327.8249,-270.6299 321.3036,-278.9799 331.6087,-276.5191 327.8249,-270.6299"/>
</g>
<!-- sourcefile~modthermodynamics.f90&#45;&gt;sourcefile~modglobal.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge45" class="edge">
<title>sourcefile~modthermodynamics.f90&#45;&gt;sourcefile~modglobal.f90</title>
<path fill="none" stroke="#0024ff" stroke-dasharray="5,2" d="M431.6219,-166.0171C420.0273,-170.0624 407.3442,-174.8646 396,-180 351.2267,-200.2684 346.3492,-219.1469 299.5,-234"/>
<path fill="none" stroke="#0024ff" stroke-dasharray="5,2" d="M299.5,-234C262.8023,-245.6346 222.1578,-262.4343 193.8806,-274.7823"/>
<polygon fill="#0024ff" stroke="#0024ff" points="192.1621,-271.7146 184.4211,-278.9484 194.9836,-278.1209 192.1621,-271.7146"/>
</g>
<!-- sourcefile~modthermodynamics.f90&#45;&gt;sourcefile~modsurfdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge43" class="edge">
<title>sourcefile~modthermodynamics.f90&#45;&gt;sourcefile~modsurfdata.f90</title>
<path fill="none" stroke="#0024ff" stroke-dasharray="5,2" d="M448.8229,-166.1303C432.4646,-176.6691 410.1023,-193.3124 396,-213 368.7363,-251.0617 391.2086,-277.0998 360,-312 355.4319,-317.1084 349.7957,-321.4481 343.8173,-325.1037"/>
<polygon fill="#0024ff" stroke="#0024ff" points="341.9933,-322.1119 334.898,-329.9801 345.3513,-328.254 341.9933,-322.1119"/>
</g>
<!-- sourcefile~moddriver.f90&#45;&gt;sourcefile~modmpi.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge46" class="edge">
<title>sourcefile~moddriver.f90&#45;&gt;sourcefile~modmpi.f90</title>
<path fill="none" stroke="#4800ff" stroke-dasharray="5,2" d="M580.6318,-632.0111C549.9801,-640.3263 507.4501,-651.0984 469.5,-658"/>
<path fill="none" stroke="#4800ff" stroke-dasharray="5,2" d="M469.5,-658C395.1637,-671.5188 374.5837,-649.5687 299.5,-658"/>
</g>
<!-- sourcefile~moddriver.f90&#45;&gt;sourcefile~modinletdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge47" class="edge">
<title>sourcefile~moddriver.f90&#45;&gt;sourcefile~modinletdata.f90</title>
<path fill="none" stroke="#4800ff" stroke-dasharray="5,2" d="M469.5,-658C430.9766,-665.0058 388.059,-675.1224 354.9839,-683.4285"/>
<polygon fill="#4800ff" stroke="#4800ff" points="353.8864,-680.0958 345.051,-685.9426 355.6041,-686.8818 353.8864,-680.0958"/>
</g>
<!-- sourcefile~moddriver.f90&#45;&gt;sourcefile~modfields.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge49" class="edge">
<title>sourcefile~moddriver.f90&#45;&gt;sourcefile~modfields.f90</title>
<path fill="none" stroke="#4800ff" stroke-dasharray="5,2" d="M611.5936,-607.848C601.5864,-596.5452 587.3624,-578.8126 579,-561 550.048,-499.3302 589.2449,-462.0279 543,-412 519.6738,-386.7656 495.6176,-410.3329 469.5,-388"/>
</g>
<!-- sourcefile~moddriver.f90&#45;&gt;sourcefile~modglobal.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge48" class="edge">
<title>sourcefile~moddriver.f90&#45;&gt;sourcefile~modglobal.f90</title>
<path fill="none" stroke="#4800ff" stroke-dasharray="5,2" d="M599.9491,-607.7626C592.9929,-603.7084 585.486,-598.9565 579,-594 561.2691,-580.4505 562.4522,-569.9355 543,-559 513.5885,-542.4657 502.914,-544.6822 469.5,-540"/>
</g>
<!-- sourcefile~moddriver.f90&#45;&gt;sourcefile~modsave.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge50" class="edge">
<title>sourcefile~moddriver.f90&#45;&gt;sourcefile~modsave.f90</title>
<path fill="none" stroke="#4800ff" stroke-dasharray="5,2" d="M578.6014,-608.4303C560.4382,-603.6973 539.3162,-598.1931 520.5218,-593.2956"/>
<polygon fill="#4800ff" stroke="#4800ff" points="521.2041,-589.8566 510.6446,-590.7217 519.4389,-596.6304 521.2041,-589.8566"/>
</g>
<!-- sourcefile~modforces.f90&#45;&gt;sourcefile~modmpi.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge51" class="edge">
<title>sourcefile~modforces.f90&#45;&gt;sourcefile~modmpi.f90</title>
<path fill="none" stroke="#ff00da" stroke-dasharray="5,2" d="M432.818,-221.903C398.2495,-210.3536 345.0962,-192.2092 299.5,-175"/>
</g>
<!-- sourcefile~modforces.f90&#45;&gt;sourcefile~modibmdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge52" class="edge">
<title>sourcefile~modforces.f90&#45;&gt;sourcefile~modibmdata.f90</title>
<path fill="none" stroke="#ff00da" stroke-dasharray="5,2" d="M467.3276,-246.3292C457.0046,-303.6512 411.2763,-543.5704 360,-597 358.9415,-598.103 357.8221,-599.1481 356.6515,-600.1383"/>
<polygon fill="#ff00da" stroke="#ff00da" points="354.5286,-597.3507 348.2837,-605.9095 358.5028,-603.1131 354.5286,-597.3507"/>
</g>
<!-- sourcefile~modforces.f90&#45;&gt;sourcefile~modfields.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge55" class="edge">
<title>sourcefile~modforces.f90&#45;&gt;sourcefile~modfields.f90</title>
<path fill="none" stroke="#ff00da" stroke-dasharray="5,2" d="M433.4474,-246.0882C407.7532,-254.7033 373.0072,-266.3535 345.3426,-275.6293"/>
<polygon fill="#ff00da" stroke="#ff00da" points="343.8692,-272.4317 335.5007,-278.9292 346.0946,-279.0686 343.8692,-272.4317"/>
</g>
<!-- sourcefile~modforces.f90&#45;&gt;sourcefile~modglobal.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge53" class="edge">
<title>sourcefile~modforces.f90&#45;&gt;sourcefile~modglobal.f90</title>
<path fill="none" stroke="#ff00da" stroke-dasharray="5,2" d="M424.3423,-226.7055C389.4148,-222.7844 340.294,-221.0667 299.5,-234"/>
</g>
<!-- sourcefile~modforces.f90&#45;&gt;sourcefile~modsurfdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge54" class="edge">
<title>sourcefile~modforces.f90&#45;&gt;sourcefile~modsurfdata.f90</title>
<path fill="none" stroke="#ff00da" stroke-dasharray="5,2" d="M424.4776,-244.9309C414.4877,-248.6706 404.3878,-253.5887 396,-260 373.6676,-277.07 381.2656,-293.618 360,-312 354.2071,-317.0074 347.4321,-321.4125 340.5532,-325.1966"/>
<polygon fill="#ff00da" stroke="#ff00da" points="338.5099,-322.3096 331.1909,-329.9701 341.6896,-328.5458 338.5099,-322.3096"/>
</g>
<!-- sourcefile~modsave.f90&#45;&gt;sourcefile~modmpi.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge56" class="edge">
<title>sourcefile~modsave.f90&#45;&gt;sourcefile~modmpi.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M428.129,-591.3738C417.2782,-595.2185 405.8621,-600.0753 396,-606 377.3942,-617.1775 378.8023,-628.1564 360,-639 335.5855,-653.0802 327.5077,-654.855 299.5,-658"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M299.5,-658C237.0039,-665.0178 203.9047,-700.9857 158,-658"/>
</g>
<!-- sourcefile~modsave.f90&#45;&gt;sourcefile~modibmdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge57" class="edge">
<title>sourcefile~modsave.f90&#45;&gt;sourcefile~modibmdata.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M428.3477,-589.1987C407.8897,-593.7717 382.765,-599.3878 360.1515,-604.4426"/>
<polygon fill="#ff0000" stroke="#ff0000" points="359.2961,-601.0473 350.3005,-606.6446 360.8232,-607.8788 359.2961,-601.0473"/>
</g>
<!-- sourcefile~modsave.f90&#45;&gt;sourcefile~modinletdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge58" class="edge">
<title>sourcefile~modsave.f90&#45;&gt;sourcefile~modinletdata.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M428.1795,-588.7829C416.8462,-592.6638 405.169,-598.1869 396,-606 370.5678,-627.6714 384.7046,-649.5027 360,-672 356.1884,-675.4711 351.8424,-678.526 347.2685,-681.2037"/>
<polygon fill="#ff0000" stroke="#ff0000" points="345.5186,-678.169 338.2725,-685.8985 348.7572,-684.3747 345.5186,-678.169"/>
</g>
<!-- sourcefile~modsave.f90&#45;&gt;sourcefile~modfields.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge61" class="edge">
<title>sourcefile~modsave.f90&#45;&gt;sourcefile~modfields.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M464.4643,-567.7689C443.5788,-517.0817 364.643,-325.932 360,-321 355.2486,-315.9529 349.4648,-311.6368 343.379,-307.9834"/>
<polygon fill="#ff0000" stroke="#ff0000" points="344.7934,-304.7695 334.3314,-303.0969 341.4668,-310.9286 344.7934,-304.7695"/>
</g>
<!-- sourcefile~modsave.f90&#45;&gt;sourcefile~modglobal.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge59" class="edge">
<title>sourcefile~modsave.f90&#45;&gt;sourcefile~modglobal.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M428.4706,-570.8934C381.6823,-560.2727 310.2399,-543.2479 299.5,-536"/>
</g>
<!-- sourcefile~modsave.f90&#45;&gt;sourcefile~modsurfdata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge60" class="edge">
<title>sourcefile~modsave.f90&#45;&gt;sourcefile~modsurfdata.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M460.6463,-567.7741C446.8088,-548.6523 419.2332,-510.4912 396,-478 366.7769,-437.1319 332.829,-389.1755 313.991,-362.5211"/>
<polygon fill="#ff0000" stroke="#ff0000" points="316.6193,-360.1756 307.9904,-354.028 310.9022,-364.2149 316.6193,-360.1756"/>
</g>
<!-- sourcefile~modsave.f90&#45;&gt;sourcefile~modsubgriddata.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge63" class="edge">
<title>sourcefile~modsave.f90&#45;&gt;sourcefile~modsubgriddata.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M447.9509,-567.9187C426.0577,-555.8035 391.0457,-536.8629 360,-522 353.1235,-518.7079 345.7241,-515.3666 338.5409,-512.2252"/>
<polygon fill="#ff0000" stroke="#ff0000" points="339.5177,-508.8349 328.9491,-508.0887 336.7456,-515.2626 339.5177,-508.8349"/>
</g>
<!-- sourcefile~initfac.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_node17" class="node">
<title>sourcefile~initfac.f90</title>
<g id="a_sourcefile~~modstartup.f90~~EfferentGraph_node17"><a xlink:href=".././sourcefile/initfac.f90.html" xlink:title="initfac.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="332.5,-588 266.5,-588 266.5,-564 332.5,-564 332.5,-588"/>
<text text-anchor="middle" x="299.5" y="-573.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">initfac.f90</text>
</a>
</g>
</g>
<!-- sourcefile~modsave.f90&#45;&gt;sourcefile~initfac.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge62" class="edge">
<title>sourcefile~modsave.f90&#45;&gt;sourcefile~initfac.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M428.3477,-579.0317C402.4095,-578.4214 368.9696,-577.6346 342.6571,-577.0155"/>
<polygon fill="#ff0000" stroke="#ff0000" points="342.6693,-573.5149 332.5897,-576.7786 342.5046,-580.5129 342.6693,-573.5149"/>
</g>
<!-- sourcefile~initfac.f90&#45;&gt;sourcefile~modmpi.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge64" class="edge">
<title>sourcefile~initfac.f90&#45;&gt;sourcefile~modmpi.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M266.3726,-585.423C257.2571,-588.5666 247.5357,-592.4495 239,-597 199.2316,-618.201 190.8958,-688.8039 158,-658"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M158,-658C105.6529,-608.9817 57.2999,-385.361 42.8582,-313.3872"/>
<polygon fill="#ff0000" stroke="#ff0000" points="46.2141,-312.3162 40.8362,-303.1878 39.3477,-313.6776 46.2141,-312.3162"/>
</g>
<!-- sourcefile~initfac.f90&#45;&gt;sourcefile~modglobal.f90 -->
<g id="sourcefile~~modstartup.f90~~EfferentGraph_edge65" class="edge">
<title>sourcefile~initfac.f90&#45;&gt;sourcefile~modglobal.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M266.4433,-567.6526C256.4821,-563.7235 246.275,-558.064 239,-550 176.0523,-480.2255 162.023,-361.9477 158.8964,-313.1081"/>
<polygon fill="#ff0000" stroke="#ff0000" points="162.3855,-312.8094 158.3463,-303.0147 155.3958,-313.1904 162.3855,-312.8094"/>
</g>
</g>
</svg>
</div><script>var pansourcefilemodstartupf90EfferentGraph = svgPanZoom('#sourcefilemodstartupf90EfferentGraph', {zoomEnabled: true,controlIconsEnabled: true, fit: true, center: true,}); </script><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~modstartup.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefilemodstartupf90AfferentGraph" width="217pt" height="32pt"
 viewBox="0.00 0.00 217.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~modstartup.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>sourcefile~~modstartup.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 213,-28 213,4 -4,4"/>
<!-- sourcefile~modstartup.f90 -->
<g id="sourcefile~~modstartup.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~modstartup.f90</title>
<polygon fill="none" stroke="#000000" points="94,-24 0,-24 0,0 94,0 94,-24"/>
<text text-anchor="middle" x="47" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">modstartup.f90</text>
</g>
<!-- sourcefile~program.f90 -->
<g id="sourcefile~~modstartup.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~program.f90</title>
<g id="a_sourcefile~~modstartup.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/program.f90.html" xlink:title="program.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="209,-24 130,-24 130,0 209,0 209,-24"/>
<text text-anchor="middle" x="169.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">program.f90</text>
</a>
</g>
</g>
<!-- sourcefile~program.f90&#45;&gt;sourcefile~modstartup.f90 -->
<g id="sourcefile~~modstartup.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~program.f90&#45;&gt;sourcefile~modstartup.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M129.7278,-12C121.5932,-12 112.88,-12 104.272,-12"/>
<polygon fill="#ff0000" stroke="#ff0000" points="104.2563,-8.5001 94.2563,-12 104.2562,-15.5001 104.2563,-8.5001"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/modstartup.html">modstartup</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/modstartup.f90.html#src">modstartup.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">!&gt; \file modstartup.f90</span>
<a name="ln-2"></a><span class="c">!!  Initializes the run</span>
<a name="ln-3"></a>
<a name="ln-4"></a><span class="c">!&gt;</span>
<a name="ln-5"></a><span class="c">!! Initializes the run.</span>
<a name="ln-6"></a><span class="c">!&gt;</span>
<a name="ln-7"></a><span class="c">!! Modstartup reads the namelists and initial data, sets the fields and calls</span>
<a name="ln-8"></a><span class="c">!! the inits of the other routines where necessary. Reading of the</span>
<a name="ln-9"></a><span class="c">!! restart files also live in this module.</span>
<a name="ln-10"></a><span class="c">!!  \author Jasper Tomas, TU Delft</span>
<a name="ln-11"></a><span class="c">!!  \author Chiel van Heerwaarden, Wageningen U.R.</span>
<a name="ln-12"></a><span class="c">!!  \author Thijs Heus,MPI-M</span>
<a name="ln-13"></a><span class="c">!!  \todo documentation</span>
<a name="ln-14"></a><span class="c">!!  \par Revision list</span>
<a name="ln-15"></a><span class="c">!</span>
<a name="ln-16"></a>
<a name="ln-17"></a><span class="k">module </span><span class="n">modstartup</span>
<a name="ln-18"></a>
<a name="ln-19"></a>   <span class="k">implicit none</span>
<a name="ln-20"></a>   <span class="c">! private</span>
<a name="ln-21"></a>   <span class="c">! public :: startup,trestart</span>
<a name="ln-22"></a>   <span class="k">save</span>
<a name="ln-23"></a>
<a name="ln-24"></a><span class="k">   </span><span class="kt">integer</span><span class="p">(</span><span class="nb">KIND</span><span class="o">=</span><span class="nb">selected_int_kind</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span> <span class="kd">::</span> <span class="n">irandom</span> <span class="o">=</span> <span class="mi">0</span> <span class="c">!    * number to seed the randomnizer with</span>
<a name="ln-25"></a>   <span class="kt">integer</span> <span class="kd">::</span> <span class="n">krand</span> <span class="o">=</span> <span class="nb">huge</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c">! returns the largest integer that is not an infinity</span>
<a name="ln-26"></a>   <span class="kt">real</span> <span class="kd">::</span> <span class="n">randu</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">randthl</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">randqt</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c">!    * uvw,thl and qt amplitude of randomnization</span>
<a name="ln-27"></a>
<a name="ln-28"></a>   <span class="k">contains</span>
<a name="ln-29"></a><span class="k">   subroutine </span><span class="n">startup</span>
<a name="ln-30"></a>
<a name="ln-31"></a>      <span class="c">!-----------------------------------------------------------------|</span>
<a name="ln-32"></a>      <span class="c">!                                                                 |</span>
<a name="ln-33"></a>      <span class="c">!     Reads all general options from namoptions                   |</span>
<a name="ln-34"></a>      <span class="c">!                                                                 |</span>
<a name="ln-35"></a>      <span class="c">!      Jasper Tomas                 31/03/2014                    |</span>
<a name="ln-36"></a>      <span class="c">!      Chiel van Heerwaarden        15/06/2007                    |</span>
<a name="ln-37"></a>      <span class="c">!      Thijs Heus                   15/06/2007                    |</span>
<a name="ln-38"></a>      <span class="c">!-----------------------------------------------------------------|</span>
<a name="ln-39"></a>
<a name="ln-40"></a>      <span class="k">use </span><span class="n">modglobal</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">initglobal</span><span class="p">,</span> <span class="n">iexpnr</span><span class="p">,</span> <span class="n">runtime</span><span class="p">,</span> <span class="n">dtmax</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-41"></a>         <span class="n">lwarmstart</span><span class="p">,</span> <span class="n">lstratstart</span><span class="p">,</span> <span class="n">lfielddump</span><span class="p">,</span> <span class="n">lreadscal</span><span class="p">,</span> <span class="n">startfile</span><span class="p">,</span> <span class="n">tfielddump</span><span class="p">,</span> <span class="n">fieldvars</span><span class="p">,</span> <span class="n">tsample</span><span class="p">,</span> <span class="n">tstatsdump</span><span class="p">,</span> <span class="n">trestart</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-42"></a>         <span class="n">nsv</span><span class="p">,</span> <span class="n">imax</span><span class="p">,</span> <span class="n">jtot</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">xsize</span><span class="p">,</span> <span class="n">ysize</span><span class="p">,</span> <span class="n">xlat</span><span class="p">,</span> <span class="n">xlon</span><span class="p">,</span> <span class="n">xday</span><span class="p">,</span> <span class="n">xtime</span><span class="p">,</span> <span class="n">lwalldist</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-43"></a>         <span class="n">lmoist</span><span class="p">,</span> <span class="n">lcoriol</span><span class="p">,</span> <span class="n">igrw_damp</span><span class="p">,</span> <span class="n">geodamptime</span><span class="p">,</span> <span class="n">ifnamopt</span><span class="p">,</span> <span class="n">fname_options</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-44"></a>         <span class="n">xS</span><span class="p">,</span><span class="n">yS</span><span class="p">,</span><span class="n">zS</span><span class="p">,</span><span class="n">SS</span><span class="p">,</span><span class="n">sigS</span><span class="p">,</span><span class="n">iwallmom</span><span class="p">,</span><span class="n">iwalltemp</span><span class="p">,</span><span class="n">iwallmoist</span><span class="p">,</span><span class="n">iwallscal</span><span class="p">,</span><span class="n">ipoiss</span><span class="p">,</span><span class="n">iadv_mom</span><span class="p">,</span><span class="n">iadv_tke</span><span class="p">,</span><span class="n">iadv_thl</span><span class="p">,</span><span class="n">iadv_qt</span><span class="p">,</span><span class="n">iadv_sv</span><span class="p">,</span><span class="n">courant</span><span class="p">,</span><span class="n">diffnr</span><span class="p">,</span><span class="n">ladaptive</span><span class="p">,</span><span class="n">author</span><span class="p">,&amp;</span>
<a name="ln-45"></a>         <span class="n">linoutflow</span><span class="p">,</span> <span class="n">lper2inout</span><span class="p">,</span> <span class="n">libm</span><span class="p">,</span> <span class="n">lnudge</span><span class="p">,</span> <span class="n">tnudge</span><span class="p">,</span> <span class="n">nnudge</span><span class="p">,</span> <span class="n">lles</span><span class="p">,</span> <span class="n">luoutflowr</span><span class="p">,</span> <span class="n">lvoutflowr</span><span class="p">,</span> <span class="n">luvolflowr</span><span class="p">,</span> <span class="n">lvvolflowr</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-46"></a>         <span class="n">uflowrate</span><span class="p">,</span> <span class="n">vflowrate</span><span class="p">,</span> <span class="n">lstoreplane</span><span class="p">,</span> <span class="n">iplane</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-47"></a>         <span class="n">lreadmean</span><span class="p">,</span> <span class="n">iinletgen</span><span class="p">,</span> <span class="n">inletav</span><span class="p">,</span> <span class="n">lreadminl</span><span class="p">,</span> <span class="n">Uinf</span><span class="p">,</span> <span class="n">Vinf</span><span class="p">,</span> <span class="n">linletRA</span><span class="p">,</span> <span class="n">nblocks</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-48"></a>         <span class="n">lscalrec</span><span class="p">,</span><span class="n">lSIRANEinout</span><span class="p">,</span><span class="n">lscasrc</span><span class="p">,</span><span class="n">lscasrcl</span><span class="p">,</span><span class="n">lscasrcr</span><span class="p">,</span><span class="n">lydump</span><span class="p">,</span><span class="n">lytdump</span><span class="p">,</span><span class="n">lxydump</span><span class="p">,</span><span class="n">lxytdump</span><span class="p">,</span><span class="n">lslicedump</span><span class="p">,</span><span class="n">ltdump</span><span class="p">,</span><span class="n">ltkedump</span><span class="p">,</span><span class="n">lzerogradtop</span><span class="p">,&amp;</span>
<a name="ln-49"></a>         <span class="n">lzerogradtopscal</span><span class="p">,</span> <span class="n">lbuoyancy</span><span class="p">,</span> <span class="n">ltempeq</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-50"></a>         <span class="n">lfixinlet</span><span class="p">,</span> <span class="n">lfixutauin</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-51"></a>         <span class="n">thlsrc</span><span class="p">,</span> <span class="n">ifixuinf</span><span class="p">,</span> <span class="n">lvinf</span><span class="p">,</span> <span class="n">tscale</span><span class="p">,</span> <span class="n">ltempinout</span><span class="p">,</span> <span class="n">lmoistinout</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-52"></a>         <span class="n">lwallfunc</span><span class="p">,</span><span class="n">lprofforc</span><span class="p">,</span><span class="n">lchem</span><span class="p">,</span><span class="n">k1</span><span class="p">,</span><span class="n">JNO2</span><span class="p">,</span><span class="n">rv</span><span class="p">,</span><span class="n">rd</span><span class="p">,</span><span class="n">tnextEB</span><span class="p">,</span><span class="n">tEB</span><span class="p">,</span><span class="n">dtEB</span><span class="p">,</span><span class="n">bldT</span><span class="p">,</span><span class="n">wsoil</span><span class="p">,</span><span class="n">wgrmax</span><span class="p">,</span><span class="n">wwilt</span><span class="p">,</span><span class="n">wfc</span><span class="p">,</span><span class="n">skyLW</span><span class="p">,</span><span class="n">GRLAI</span><span class="p">,</span><span class="n">rsmin</span><span class="p">,</span><span class="n">nfcts</span><span class="p">,</span><span class="n">lEB</span><span class="p">,</span><span class="n">lwriteEBfiles</span><span class="p">,</span><span class="n">nwalllayers</span><span class="p">,</span><span class="n">lconstW</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-53"></a>         <span class="n">BCxm</span><span class="p">,</span><span class="n">BCxT</span><span class="p">,</span><span class="n">BCxq</span><span class="p">,</span><span class="n">BCxs</span><span class="p">,</span><span class="n">BCym</span><span class="p">,</span><span class="n">BCyT</span><span class="p">,</span><span class="n">BCyq</span><span class="p">,</span><span class="n">BCys</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-54"></a>         <span class="n">BCtopm</span><span class="p">,</span><span class="n">BCtopT</span><span class="p">,</span><span class="n">BCtopq</span><span class="p">,</span><span class="n">BCtops</span><span class="p">,</span><span class="n">BCbotm</span><span class="p">,</span><span class="n">BCbotT</span><span class="p">,</span><span class="n">BCbotq</span><span class="p">,</span><span class="n">BCbots</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-55"></a>         <span class="n">idriver</span><span class="p">,</span><span class="n">tdriverstart</span><span class="p">,</span><span class="n">driverjobnr</span><span class="p">,</span><span class="n">dtdriver</span><span class="p">,</span><span class="n">driverstore</span>
<a name="ln-56"></a>      <span class="k">use </span><span class="n">modsurfdata</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">z0</span><span class="p">,</span> <span class="n">z0h</span><span class="p">,</span>  <span class="n">wtsurf</span><span class="p">,</span> <span class="n">wttop</span><span class="p">,</span> <span class="n">wqtop</span><span class="p">,</span> <span class="n">wqsurf</span><span class="p">,</span> <span class="n">wsvsurf</span><span class="p">,</span> <span class="n">wsvtop</span><span class="p">,</span> <span class="n">wsvsurfdum</span><span class="p">,</span> <span class="n">wsvtopdum</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">thvs</span><span class="p">,</span> <span class="n">thls</span><span class="p">,</span> <span class="n">thl_top</span><span class="p">,</span> <span class="n">qt_top</span><span class="p">,</span> <span class="n">qts</span> 
<a name="ln-57"></a>      <span class="c">! use modsurface,        only : initsurface</span>
<a name="ln-58"></a>      <span class="k">use </span><span class="n">modfields</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">initfields</span><span class="p">,</span> <span class="n">dpdx</span><span class="p">,</span> <span class="n">ncname</span>
<a name="ln-59"></a>      <span class="k">use </span><span class="n">modpois</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">initpois</span>
<a name="ln-60"></a>      <span class="k">use </span><span class="n">modboundary</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">initboundary</span><span class="p">,</span> <span class="n">ksp</span>
<a name="ln-61"></a>      <span class="k">use </span><span class="n">modthermodynamics</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">initthermodynamics</span><span class="p">,</span> <span class="n">lqlnr</span><span class="p">,</span> <span class="n">chi_half</span>
<a name="ln-62"></a>      <span class="k">use </span><span class="n">modsubgrid</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">initsubgrid</span>
<a name="ln-63"></a>      <span class="k">use </span><span class="n">modmpi</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">comm3d</span><span class="p">,</span> <span class="n">myid</span><span class="p">,</span> <span class="n">mpi_integer</span><span class="p">,</span> <span class="n">mpi_logical</span><span class="p">,</span> <span class="n">my_real</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">,</span> <span class="n">mpi_character</span>
<a name="ln-64"></a>      <span class="k">use </span><span class="n">modinlet</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">initinlet</span>
<a name="ln-65"></a>      <span class="k">use </span><span class="n">modinletdata</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">di</span><span class="p">,</span> <span class="n">dr</span><span class="p">,</span> <span class="n">di_test</span><span class="p">,</span> <span class="n">dti</span><span class="p">,</span> <span class="n">iangledeg</span><span class="p">,</span> <span class="n">iangle</span>
<a name="ln-66"></a>      <span class="k">use </span><span class="n">modibmdata</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">bctfxm</span><span class="p">,</span> <span class="n">bctfxp</span><span class="p">,</span> <span class="n">bctfym</span><span class="p">,</span> <span class="n">bctfyp</span><span class="p">,</span> <span class="n">bctfz</span>
<a name="ln-67"></a>      <span class="k">use </span><span class="n">modforces</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span> <span class="n">calcfluidvolumes</span>
<a name="ln-68"></a>      <span class="k">use </span><span class="n">moddriver</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span> <span class="n">initdriver</span>
<a name="ln-69"></a>
<a name="ln-70"></a>      <span class="k">implicit none</span>
<a name="ln-71"></a><span class="k">      </span><span class="kt">integer</span> <span class="kd">::</span> <span class="n">ierr</span>
<a name="ln-72"></a>
<a name="ln-73"></a>      <span class="c">!declare namelists</span>
<a name="ln-74"></a>
<a name="ln-75"></a>      <span class="k">namelist</span><span class="o">/</span><span class="n">RUN</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-76"></a>         <span class="n">iexpnr</span><span class="p">,</span> <span class="n">lwarmstart</span><span class="p">,</span> <span class="n">lstratstart</span><span class="p">,</span> <span class="n">startfile</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-77"></a>         <span class="n">runtime</span><span class="p">,</span> <span class="n">dtmax</span><span class="p">,</span> <span class="n">trestart</span><span class="p">,</span> <span class="n">ladaptive</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-78"></a>         <span class="n">irandom</span><span class="p">,</span> <span class="n">randu</span><span class="p">,</span> <span class="n">randthl</span><span class="p">,</span> <span class="n">randqt</span><span class="p">,</span> <span class="n">krand</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-79"></a>         <span class="n">courant</span><span class="p">,</span> <span class="n">diffnr</span><span class="p">,</span> <span class="n">author</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-80"></a>         <span class="n">libm</span><span class="p">,</span> <span class="n">lles</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-81"></a>         <span class="n">lper2inout</span><span class="p">,</span> <span class="n">lwalldist</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-82"></a>         <span class="n">lreadmean</span>
<a name="ln-83"></a>      <span class="k">namelist</span><span class="o">/</span><span class="n">DOMAIN</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-84"></a>         <span class="n">imax</span><span class="p">,</span> <span class="n">jtot</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">xsize</span><span class="p">,</span> <span class="n">ysize</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-85"></a>         <span class="n">xlat</span><span class="p">,</span> <span class="n">xlon</span><span class="p">,</span> <span class="n">xday</span><span class="p">,</span> <span class="n">xtime</span><span class="p">,</span> <span class="n">ksp</span> 
<a name="ln-86"></a>      <span class="k">namelist</span><span class="o">/</span><span class="n">PHYSICS</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-87"></a>         <span class="n">ps</span><span class="p">,</span> <span class="n">igrw_damp</span><span class="p">,</span> <span class="n">lmoist</span><span class="p">,</span> <span class="n">lcoriol</span><span class="p">,</span> <span class="n">lbuoyancy</span><span class="p">,</span> <span class="n">ltempeq</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-88"></a>         <span class="n">lprofforc</span><span class="p">,</span> <span class="n">ifixuinf</span><span class="p">,</span> <span class="n">lvinf</span><span class="p">,</span> <span class="n">tscale</span><span class="p">,</span> <span class="n">dpdx</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-89"></a>         <span class="n">luoutflowr</span><span class="p">,</span> <span class="n">lvoutflowr</span><span class="p">,</span> <span class="n">luvolflowr</span><span class="p">,</span> <span class="n">lvvolflowr</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-90"></a>         <span class="n">uflowrate</span><span class="p">,</span> <span class="n">vflowrate</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-91"></a>         <span class="n">lnudge</span><span class="p">,</span> <span class="n">tnudge</span><span class="p">,</span> <span class="n">nnudge</span>
<a name="ln-92"></a>      <span class="k">namelist</span><span class="o">/</span><span class="n">DYNAMICS</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-93"></a>         <span class="n">lqlnr</span><span class="p">,</span> <span class="n">ipoiss</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-94"></a>         <span class="n">iadv_mom</span><span class="p">,</span> <span class="n">iadv_tke</span><span class="p">,</span> <span class="n">iadv_thl</span><span class="p">,</span> <span class="n">iadv_qt</span><span class="p">,</span> <span class="n">iadv_sv</span>
<a name="ln-95"></a>      <span class="k">namelist</span><span class="o">/</span><span class="n">BC</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-96"></a>         <span class="n">BCxm</span><span class="p">,</span> <span class="n">BCxT</span><span class="p">,</span> <span class="n">BCxq</span><span class="p">,</span> <span class="n">BCxs</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-97"></a>         <span class="n">BCym</span><span class="p">,</span> <span class="n">BCyT</span><span class="p">,</span> <span class="n">BCyq</span><span class="p">,</span> <span class="n">BCys</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-98"></a>         <span class="n">BCtopm</span><span class="p">,</span> <span class="n">BCtopT</span><span class="p">,</span> <span class="n">BCtopq</span><span class="p">,</span> <span class="n">BCtops</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-99"></a>         <span class="n">BCbotm</span><span class="p">,</span> <span class="n">BCbotT</span><span class="p">,</span> <span class="n">BCbotq</span><span class="p">,</span> <span class="n">BCbots</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-100"></a>         <span class="n">bctfxm</span><span class="p">,</span> <span class="n">bctfxp</span><span class="p">,</span> <span class="n">bctfym</span><span class="p">,</span> <span class="n">bctfyp</span><span class="p">,</span> <span class="n">bctfz</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-101"></a>         <span class="n">wttop</span><span class="p">,</span> <span class="n">thl_top</span><span class="p">,</span> <span class="n">qt_top</span><span class="p">,</span> <span class="n">qts</span><span class="p">,</span> <span class="n">wsvsurfdum</span><span class="p">,</span> <span class="n">wsvtopdum</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-102"></a>         <span class="n">wtsurf</span><span class="p">,</span> <span class="n">wqsurf</span><span class="p">,</span> <span class="n">thls</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">z0h</span>
<a name="ln-103"></a>      <span class="k">namelist</span><span class="o">/</span><span class="n">INLET</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-104"></a>         <span class="n">Uinf</span><span class="p">,</span> <span class="n">Vinf</span><span class="p">,</span> <span class="n">di</span><span class="p">,</span> <span class="n">dti</span><span class="p">,</span> <span class="n">inletav</span><span class="p">,</span> <span class="n">linletRA</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-105"></a>         <span class="n">lstoreplane</span><span class="p">,</span> <span class="n">lreadminl</span><span class="p">,</span> <span class="n">lfixinlet</span><span class="p">,</span> <span class="n">lfixutauin</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-106"></a>         <span class="n">lwallfunc</span>
<a name="ln-107"></a>      <span class="k">namelist</span><span class="o">/</span><span class="n">DRIVER</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-108"></a>         <span class="n">idriver</span><span class="p">,</span> <span class="n">tdriverstart</span><span class="p">,</span> <span class="n">driverjobnr</span><span class="p">,</span> <span class="n">dtdriver</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-109"></a>         <span class="n">driverstore</span><span class="p">,</span> <span class="n">iplane</span>
<a name="ln-110"></a>      <span class="k">namelist</span><span class="o">/</span><span class="n">WALLS</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-111"></a>         <span class="n">nblocks</span><span class="p">,</span> <span class="n">nfcts</span><span class="p">,</span> <span class="n">iwallmom</span><span class="p">,</span> <span class="n">iwalltemp</span><span class="p">,</span> <span class="n">iwallmoist</span><span class="p">,</span> <span class="n">iwallscal</span>
<a name="ln-112"></a>      <span class="k">namelist</span><span class="o">/</span><span class="n">ENERGYBALANCE</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-113"></a>         <span class="n">lEB</span><span class="p">,</span> <span class="n">lwriteEBfiles</span><span class="p">,</span> <span class="n">lconstW</span><span class="p">,</span> <span class="n">dtEB</span><span class="p">,</span> <span class="n">bldT</span><span class="p">,</span> <span class="n">wsoil</span><span class="p">,</span> <span class="n">wgrmax</span><span class="p">,</span> <span class="n">wwilt</span><span class="p">,</span> <span class="n">wfc</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-114"></a>         <span class="n">skyLW</span><span class="p">,</span> <span class="n">GRLAI</span><span class="p">,</span> <span class="n">rsmin</span><span class="p">,</span> <span class="n">nwalllayers</span>
<a name="ln-115"></a>      <span class="k">namelist</span><span class="o">/</span><span class="n">SCALARS</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-116"></a>         <span class="n">lreadscal</span><span class="p">,</span> <span class="n">lscasrc</span><span class="p">,</span> <span class="n">lscasrcl</span><span class="p">,</span> <span class="n">lscasrcr</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-117"></a>         <span class="n">nsv</span><span class="p">,</span> <span class="n">xS</span><span class="p">,</span> <span class="n">yS</span><span class="p">,</span> <span class="n">zS</span><span class="p">,</span> <span class="n">SS</span><span class="p">,</span> <span class="n">sigS</span>
<a name="ln-118"></a>      <span class="k">namelist</span><span class="o">/</span><span class="n">CHEMISTRY</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-119"></a>         <span class="n">lchem</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">JNO2</span>
<a name="ln-120"></a>      <span class="k">namelist</span><span class="o">/</span><span class="n">OUTPUT</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-121"></a>         <span class="n">lfielddump</span><span class="p">,</span> <span class="n">tfielddump</span><span class="p">,</span> <span class="n">fieldvars</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-122"></a>         <span class="n">ltdump</span><span class="p">,</span> <span class="n">lydump</span><span class="p">,</span> <span class="n">lytdump</span><span class="p">,</span> <span class="n">lxydump</span><span class="p">,</span> <span class="n">lxytdump</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-123"></a>         <span class="n">lslicedump</span><span class="p">,</span> <span class="n">ltkedump</span><span class="p">,</span> <span class="n">tstatsdump</span><span class="p">,</span> <span class="n">tsample</span>
<a name="ln-124"></a>
<a name="ln-125"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">myid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-126"></a><span class="k">         if</span> <span class="p">(</span><span class="nb">command_argument_count</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-127"></a><span class="k">            call </span><span class="nb">get_command_argument</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">fname_options</span><span class="p">)</span>
<a name="ln-128"></a>         <span class="k">end if</span>
<a name="ln-129"></a><span class="k">         write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">fname_options</span>
<a name="ln-130"></a>
<a name="ln-131"></a>         <span class="k">open</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="n">fname_options</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-132"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-133"></a><span class="k">            write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: Namoptions does not exist&#39;</span>
<a name="ln-134"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;iostat error: &#39;</span><span class="p">,</span> <span class="n">ierr</span>
<a name="ln-135"></a>            <span class="k">stop </span><span class="mi">1</span>
<a name="ln-136"></a>         <span class="k">end if</span>
<a name="ln-137"></a>
<a name="ln-138"></a><span class="k">         read</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">,</span> <span class="n">RUN</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-139"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-140"></a><span class="k">            write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: Problem in namoptions RUN&#39;</span>
<a name="ln-141"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;iostat error: &#39;</span><span class="p">,</span> <span class="n">ierr</span>
<a name="ln-142"></a>            <span class="k">stop </span><span class="mi">1</span>
<a name="ln-143"></a>         <span class="n">endif</span>
<a name="ln-144"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">RUN</span><span class="p">)</span>
<a name="ln-145"></a>         <span class="k">rewind</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">)</span>
<a name="ln-146"></a>
<a name="ln-147"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">,</span> <span class="n">DOMAIN</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-148"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-149"></a><span class="k">            write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: Problem in namoptions DOMAIN&#39;</span>
<a name="ln-150"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;iostat error: &#39;</span><span class="p">,</span> <span class="n">ierr</span>
<a name="ln-151"></a>            <span class="k">stop </span><span class="mi">1</span>
<a name="ln-152"></a>         <span class="n">endif</span>
<a name="ln-153"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">DOMAIN</span><span class="p">)</span>
<a name="ln-154"></a>         <span class="k">rewind</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">)</span>
<a name="ln-155"></a>
<a name="ln-156"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">,</span> <span class="n">PHYSICS</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-157"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-158"></a><span class="k">            write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: Problem in namoptions PHYSICS&#39;</span>
<a name="ln-159"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;iostat error: &#39;</span><span class="p">,</span> <span class="n">ierr</span>
<a name="ln-160"></a>            <span class="k">stop </span><span class="mi">1</span>
<a name="ln-161"></a>         <span class="n">endif</span>
<a name="ln-162"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">PHYSICS</span><span class="p">)</span>
<a name="ln-163"></a>         <span class="k">rewind</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">)</span>
<a name="ln-164"></a>
<a name="ln-165"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">,</span> <span class="n">DYNAMICS</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-166"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-167"></a><span class="k">            write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: Problem in namoptions DYNAMICS&#39;</span>
<a name="ln-168"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;iostat error: &#39;</span><span class="p">,</span> <span class="n">ierr</span>
<a name="ln-169"></a>            <span class="k">stop </span><span class="mi">1</span>
<a name="ln-170"></a>         <span class="n">endif</span>
<a name="ln-171"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">DYNAMICS</span><span class="p">)</span>
<a name="ln-172"></a>         <span class="k">rewind</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">)</span>
<a name="ln-173"></a>
<a name="ln-174"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">,</span> <span class="n">BC</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-175"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-176"></a><span class="k">            write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: Problem in namoptions BC&#39;</span>
<a name="ln-177"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;iostat error: &#39;</span><span class="p">,</span> <span class="n">ierr</span>
<a name="ln-178"></a>            <span class="k">stop </span><span class="mi">1</span>
<a name="ln-179"></a>         <span class="n">endif</span>
<a name="ln-180"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">BC</span><span class="p">)</span>
<a name="ln-181"></a>         <span class="k">rewind</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">)</span>
<a name="ln-182"></a>
<a name="ln-183"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">,</span> <span class="n">INLET</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-184"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-185"></a><span class="k">            write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: Problem in namoptions INLET&#39;</span>
<a name="ln-186"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;iostat error: &#39;</span><span class="p">,</span> <span class="n">ierr</span>
<a name="ln-187"></a>            <span class="k">stop </span><span class="mi">1</span>
<a name="ln-188"></a>         <span class="n">endif</span>
<a name="ln-189"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">INLET</span><span class="p">)</span>
<a name="ln-190"></a>         <span class="k">rewind</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">)</span>
<a name="ln-191"></a>
<a name="ln-192"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">,</span> <span class="n">DRIVER</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-193"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-194"></a><span class="k">            write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Problem in namoptions DRIVER&#39;</span>
<a name="ln-195"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;iostat error: &#39;</span><span class="p">,</span> <span class="n">ierr</span>
<a name="ln-196"></a>            <span class="k">stop</span> <span class="s1">&#39;ERROR: Problem in namoptions DRIVER&#39;</span>
<a name="ln-197"></a>         <span class="n">endif</span>
<a name="ln-198"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">DRIVER</span><span class="p">)</span>
<a name="ln-199"></a>         <span class="k">rewind</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">)</span>
<a name="ln-200"></a>
<a name="ln-201"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">,</span> <span class="n">WALLS</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-202"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-203"></a><span class="k">            write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: Problem in namoptions WALLS&#39;</span>
<a name="ln-204"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;iostat error: &#39;</span><span class="p">,</span> <span class="n">ierr</span>
<a name="ln-205"></a>            <span class="k">stop </span><span class="mi">1</span>
<a name="ln-206"></a>         <span class="n">endif</span>
<a name="ln-207"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">WALLS</span><span class="p">)</span>
<a name="ln-208"></a>         <span class="k">rewind</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">)</span>
<a name="ln-209"></a>
<a name="ln-210"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">,</span> <span class="n">ENERGYBALANCE</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-211"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-212"></a><span class="k">            write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: Problem in namoptions EB&#39;</span>
<a name="ln-213"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;iostat error: &#39;</span><span class="p">,</span> <span class="n">ierr</span>
<a name="ln-214"></a>            <span class="k">stop </span><span class="mi">1</span>
<a name="ln-215"></a>         <span class="n">endif</span>
<a name="ln-216"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">ENERGYBALANCE</span><span class="p">)</span>
<a name="ln-217"></a>         <span class="k">rewind</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">)</span>
<a name="ln-218"></a>
<a name="ln-219"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">,</span> <span class="n">SCALARS</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-220"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-221"></a><span class="k">            write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: Problem in namoptions SCALARS&#39;</span>
<a name="ln-222"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;iostat error: &#39;</span><span class="p">,</span> <span class="n">ierr</span>
<a name="ln-223"></a>            <span class="k">stop </span><span class="mi">1</span>
<a name="ln-224"></a>         <span class="n">endif</span>
<a name="ln-225"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">SCALARS</span><span class="p">)</span>
<a name="ln-226"></a>         <span class="k">rewind</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">)</span>
<a name="ln-227"></a>
<a name="ln-228"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">,</span> <span class="n">CHEMISTRY</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-229"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-230"></a><span class="k">            write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: Problem in namoptions CHEMISTRY&#39;</span>
<a name="ln-231"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;iostat error: &#39;</span><span class="p">,</span> <span class="n">ierr</span>
<a name="ln-232"></a>            <span class="k">stop </span><span class="mi">1</span>
<a name="ln-233"></a>         <span class="n">endif</span>
<a name="ln-234"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">CHEMISTRY</span><span class="p">)</span>
<a name="ln-235"></a>         <span class="k">rewind</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">)</span>
<a name="ln-236"></a>
<a name="ln-237"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-238"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-239"></a><span class="k">            write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: Problem in namoptions OUTPUT&#39;</span>
<a name="ln-240"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;iostat error: &#39;</span><span class="p">,</span> <span class="n">ierr</span>
<a name="ln-241"></a>            <span class="k">stop </span><span class="mi">1</span>
<a name="ln-242"></a>         <span class="n">endif</span>
<a name="ln-243"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">)</span>
<a name="ln-244"></a>         <span class="k">close</span> <span class="p">(</span><span class="n">ifnamopt</span><span class="p">)</span>
<a name="ln-245"></a>      <span class="k">end if</span>
<a name="ln-246"></a>
<a name="ln-247"></a><span class="k">      </span><span class="n">thvs</span> <span class="o">=</span> <span class="n">thls</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="p">(</span><span class="n">rv</span><span class="o">/</span><span class="n">rd</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="n">qts</span><span class="p">)</span>
<a name="ln-248"></a>
<a name="ln-249"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;starting broadcast&quot;</span>
<a name="ln-250"></a>      <span class="c">!broadcast namelists</span>
<a name="ln-251"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iexpnr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-252"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lwarmstart</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-253"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lstratstart</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-254"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lfielddump</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-255"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lreadscal</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: added switch to read scalar pollutant fields (warm start)</span>
<a name="ln-256"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lscasrc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! tg3315</span>
<a name="ln-257"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lscasrcl</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! tg3315</span>
<a name="ln-258"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lscasrcr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! tg3315</span>
<a name="ln-259"></a>
<a name="ln-260"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lbuoyancy</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: added switch for buoyancy force in modforces</span>
<a name="ln-261"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">ltempeq</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: added switch for solving adv/diff equation for temperature</span>
<a name="ln-262"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lper2inout</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: added switch for restart periodic flow to inoutflow</span>
<a name="ln-263"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">libm</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: added switch for turning on/off IBM method</span>
<a name="ln-264"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lnudge</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-265"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">nnudge</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-266"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">tnudge</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-267"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lwalldist</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: added switch for computing wall distances</span>
<a name="ln-268"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lles</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: added switch for turning on/off LES functionality (subgrid model)</span>
<a name="ln-269"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">linletRA</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: added switch for turning on/off Running Average in inletgenerator</span>
<a name="ln-270"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lfixinlet</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: added switch for keeping average inlet velocit and temp fixed at inlet (iinletgen=1,2)</span>
<a name="ln-271"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lfixutauin</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: added switch for keeping utau fixed at inlet (iinletgen=1,2)</span>
<a name="ln-272"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">xS</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-273"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">yS</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-274"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">zS</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-275"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">SS</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-276"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">sigS</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-277"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">idriver</span>    <span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">MPI_INTEGER</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">comm3d</span><span class="p">,</span><span class="n">mpierr</span><span class="p">)</span>        <span class="c">! ae1212: Added switch for driver inlet simulation                                                                         </span>
<a name="ln-278"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">tdriverstart</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">MY_REAL</span>   <span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">comm3d</span><span class="p">,</span><span class="n">mpierr</span><span class="p">)</span>        <span class="c">! ae1212</span>
<a name="ln-279"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">driverjobnr</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">MPI_INTEGER</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">comm3d</span><span class="p">,</span><span class="n">mpierr</span><span class="p">)</span>        <span class="c">! ae1212</span>
<a name="ln-280"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dtdriver</span>   <span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">MY_REAL</span>    <span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">comm3d</span><span class="p">,</span><span class="n">mpierr</span><span class="p">)</span>        <span class="c">! ae1212</span>
<a name="ln-281"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">driverstore</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">MPI_INTEGER</span> <span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">comm3d</span><span class="p">,</span><span class="n">mpierr</span><span class="p">)</span>
<a name="ln-282"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;sec BC&quot;</span>
<a name="ln-283"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxm</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-284"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-285"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxq</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-286"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxs</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-287"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCym</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>                                                                                                                                                                             
<a name="ln-288"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCyT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-289"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCyq</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-290"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCys</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-291"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCtopm</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>                                                         
<a name="ln-292"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCtopT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-293"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCtopq</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-294"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCtops</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-295"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCbotm</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> 
<a name="ln-296"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCbotT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-297"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCbotq</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-298"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCbots</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-299"></a>
<a name="ln-300"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;sec c&quot;</span>
<a name="ln-301"></a>
<a name="ln-302"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lwallfunc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: added switch for reading mean inlet/recycle plane profiles (Uinl,Urec,Wrec)</span>
<a name="ln-303"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lreadminl</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: added switch for reading mean inlet/recycle plane profiles (Uinl,Urec,Wrec)</span>
<a name="ln-304"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iwalltemp</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! case (integer) for wall treatment for temperature (1=no wall function/fixed flux, 2=no wall function/fixed value, 3=uno)</span>
<a name="ln-305"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iwallmoist</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! case (integer) for wall treatment for moisture (1=no wall function/fixed flux, 2=no wall function/fixed value, 3=uno)</span>
<a name="ln-306"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iwallscal</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-307"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iwallmom</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! case (integer) for wall treatment for momentum (1=no wall function, 2=werner-wengle, 3=uno)</span>
<a name="ln-308"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;sec d&quot;</span>
<a name="ln-309"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">luoutflowr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: added switch for turning on/off u-velocity correction for fixed mass outflow rate</span>
<a name="ln-310"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lvoutflowr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! tg3315: added switch for turning on/off v-velocity correction for fixed mass outflow rate</span>
<a name="ln-311"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">luvolflowr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! bss166: added switch for turning on/off u-velocity correction for fixed volume flow rate</span>
<a name="ln-312"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lvvolflowr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! bss116: added switch for turning on/off v-velocity correction for fixed volume flow rate</span>
<a name="ln-313"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lstoreplane</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: added switch for turning on/off for storing i-plane data to serve as inlet for future sim.</span>
<a name="ln-314"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lreadmean</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: added switch for reading mean variables from means#MYID#.#EXPNR#</span>
<a name="ln-315"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lydump</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! tg3315 added switch for writing statistics files</span>
<a name="ln-316"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lytdump</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! tg3315 added switch for writing statistics files</span>
<a name="ln-317"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lxydump</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! tg3315 added switch for writing statistics files</span>
<a name="ln-318"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lxytdump</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! tg3315 added switch for writing statistics files</span>
<a name="ln-319"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lslicedump</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! tg3315 added switch for writing statistics files</span>
<a name="ln-320"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">ltdump</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! tg3315 added switch for writing statistics files</span>
<a name="ln-321"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">ltkedump</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! tg3315 added switch for writing tke budget files</span>
<a name="ln-322"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iplane</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! J.Tomas: ib+iplane is the i-plane that is stored if lstoreplane is .true.</span>
<a name="ln-323"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">startfile</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">MPI_CHARACTER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-324"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">author</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="n">MPI_CHARACTER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-325"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">runtime</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-326"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">trestart</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-327"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">tfielddump</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-328"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">tsample</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">!tg3315</span>
<a name="ln-329"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">tstatsdump</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">!tg3315</span>
<a name="ln-330"></a>
<a name="ln-331"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">tEB</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-332"></a>      <span class="n">tnextEB</span> <span class="o">=</span> <span class="n">dtEB</span>
<a name="ln-333"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">tnextEB</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-334"></a>
<a name="ln-335"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dtmax</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-336"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">nsv</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-337"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">fieldvars</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">MPI_CHARACTER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-338"></a>      <span class="c">!call MPI_BCAST(nstat      ,1,MPI_INTEGER,0,comm3d,mpierr) !tg3315</span>
<a name="ln-339"></a>      <span class="c">!call MPI_BCAST(ncstat     ,80,MPI_CHARACTER,0,comm3d,mpierr) !tg3315</span>
<a name="ln-340"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">ifixuinf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-341"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lvinf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-342"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dpdx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-343"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">tscale</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-344"></a>
<a name="ln-345"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">imax</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-346"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">jtot</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-347"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">kmax</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-348"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">xsize</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-349"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">ysize</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-350"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">xlat</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-351"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">xlon</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-352"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">xday</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-353"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">xtime</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-354"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;sec f&quot;</span>
<a name="ln-355"></a>
<a name="ln-356"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">z0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-357"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">z0h</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-358"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">bctfxm</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-359"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">bctfxp</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-360"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">bctfym</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-361"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">bctfyp</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-362"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">bctfz</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-363"></a>
<a name="ln-364"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">wtsurf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-365"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">wqsurf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-366"></a>      <span class="k">allocate</span> <span class="p">(</span><span class="n">wsvsurf</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsv</span><span class="p">))</span>
<a name="ln-367"></a>      <span class="n">wsvsurf</span> <span class="o">=</span> <span class="n">wsvsurfdum</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsv</span><span class="p">)</span>
<a name="ln-368"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">wsvsurf</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsv</span><span class="p">),</span> <span class="n">nsv</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-369"></a>      <span class="k">allocate</span> <span class="p">(</span><span class="n">wsvtop</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsv</span><span class="p">))</span>
<a name="ln-370"></a>      <span class="n">wsvtop</span> <span class="o">=</span> <span class="n">wsvtopdum</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsv</span><span class="p">)</span>                                                                   
<a name="ln-371"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">wsvtop</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsv</span><span class="p">),</span> <span class="n">nsv</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-372"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">ps</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-373"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">thvs</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-374"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">thls</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-375"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">thl_top</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-376"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">qt_top</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-377"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">qts</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-378"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lmoist</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-379"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lcoriol</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-380"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lprofforc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-381"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lchem</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-382"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-383"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">JNO2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-384"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">igrw_damp</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-385"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">geodamptime</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-386"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">wttop</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-387"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">wqtop</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-388"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">thlsrc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-389"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">uflowrate</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-390"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">vflowrate</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-391"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">Uinf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-392"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">Vinf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-393"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">di</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-394"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dti</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-395"></a>      <span class="n">dr</span> <span class="o">=</span> <span class="n">di</span> <span class="c">! initial value is needed</span>
<a name="ln-396"></a>      <span class="n">di_test</span> <span class="o">=</span> <span class="n">di</span> <span class="c">! initial value is needed</span>
<a name="ln-397"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;sec g&quot;</span>
<a name="ln-398"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iangledeg</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-399"></a>      <span class="n">iangle</span> <span class="o">=</span> <span class="n">iangledeg</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="mi">18</span><span class="mf">0.</span>
<a name="ln-400"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">inletav</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-401"></a>
<a name="ln-402"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lqlnr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-403"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">ksp</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-404"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">nblocks</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span> <span class="c">! no. of blocks used in IBM</span>
<a name="ln-405"></a>
<a name="ln-406"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">nfcts</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-407"></a>
<a name="ln-408"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lconstW</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-409"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lEB</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-410"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">lwriteEBfiles</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-411"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">wsoil</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-412"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">wgrmax</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-413"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">wwilt</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-414"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">wfc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-415"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dtEB</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-416"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">bldT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-417"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">skyLW</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-418"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">GRLAI</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-419"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">rsmin</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-420"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">nwalllayers</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-421"></a>
<a name="ln-422"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">irandom</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-423"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">krand</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-424"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">randthl</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-425"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">randu</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-426"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">randqt</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-427"></a>
<a name="ln-428"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">ladaptive</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-429"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">courant</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-430"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">diffnr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-431"></a>
<a name="ln-432"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">ipoiss</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-433"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iadv_mom</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-434"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iadv_tke</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-435"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iadv_thl</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-436"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iadv_qt</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-437"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iadv_sv</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsv</span><span class="p">),</span> <span class="n">nsv</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-438"></a>      <span class="c">!write(*,*) &quot;sec h&quot;</span>
<a name="ln-439"></a>
<a name="ln-440"></a>      <span class="c">! Allocate and initialize core modules</span>
<a name="ln-441"></a>      <span class="k">call </span><span class="n">initglobal</span>
<a name="ln-442"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;done initglobal&quot;</span>
<a name="ln-443"></a>      <span class="k">call </span><span class="n">initfields</span>
<a name="ln-444"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;done initfields&quot;</span>
<a name="ln-445"></a>      <span class="k">call </span><span class="n">initboundary</span>
<a name="ln-446"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;done initboundayi&quot;</span>
<a name="ln-447"></a>      <span class="k">call </span><span class="n">initthermodynamics</span>
<a name="ln-448"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;done initthermodynamics&quot;</span>
<a name="ln-449"></a>      <span class="c">!!depreated!!</span>
<a name="ln-450"></a>      <span class="c">! call initsurface</span>
<a name="ln-451"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;done initsurface&quot;</span>
<a name="ln-452"></a>      <span class="k">call </span><span class="n">initsubgrid</span>
<a name="ln-453"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;done initsubgrid&quot;</span>
<a name="ln-454"></a>      <span class="k">call </span><span class="n">initpois</span>
<a name="ln-455"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;done initpois&quot;</span>
<a name="ln-456"></a>      <span class="k">call </span><span class="n">initinlet</span> <span class="c">! added by J. Tomas: initialize inlet generator</span>
<a name="ln-457"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;done initinlet&quot;</span>
<a name="ln-458"></a>      <span class="k">call </span><span class="n">initdriver</span>  <span class="c">! added by ae1212: initialise driver inlet                             </span>
<a name="ln-459"></a>      <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s2">&quot;done initdriver&quot;</span>
<a name="ln-460"></a>      <span class="k">call </span><span class="n">checkinitvalues</span>
<a name="ln-461"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;done checkinitvalues&quot;</span>
<a name="ln-462"></a>      <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Determine masking matrices&#39;</span>
<a name="ln-463"></a>      <span class="k">call </span><span class="n">createmasks</span> <span class="c">! determine walls/blocks</span>
<a name="ln-464"></a>      <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Finished determining masking matrices&#39;</span>
<a name="ln-465"></a>      <span class="c">! calculate fluid volume and outlet areas, needs masking matrices</span>
<a name="ln-466"></a>      <span class="k">call </span><span class="n">calcfluidvolumes</span>
<a name="ln-467"></a>
<a name="ln-468"></a>      <span class="k">call </span><span class="n">readinitfiles</span>
<a name="ln-469"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;done readinitfiles&quot;</span>
<a name="ln-470"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;done startup&quot;</span>
<a name="ln-471"></a>
<a name="ln-472"></a>      <span class="k">call </span><span class="n">createscals</span>
<a name="ln-473"></a>      <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;done create scals&quot;</span>
<a name="ln-474"></a>
<a name="ln-475"></a>   <span class="k">end subroutine </span><span class="n">startup</span>
<a name="ln-476"></a>
<a name="ln-477"></a>   <span class="k">subroutine </span><span class="n">checkinitvalues</span>
<a name="ln-478"></a>      <span class="c">!-----------------------------------------------------------------|</span>
<a name="ln-479"></a>      <span class="c">!                                                                 |</span>
<a name="ln-480"></a>      <span class="c">!      Thijs Heus   TU Delft  9/2/2006                            |</span>
<a name="ln-481"></a>      <span class="c">!                                                                 |</span>
<a name="ln-482"></a>      <span class="c">!     purpose.                                                    |</span>
<a name="ln-483"></a>      <span class="c">!     --------                                                    |</span>
<a name="ln-484"></a>      <span class="c">!                                                                 |</span>
<a name="ln-485"></a>      <span class="c">!      checks whether crucial parameters are set correctly        |</span>
<a name="ln-486"></a>      <span class="c">!                                                                 |</span>
<a name="ln-487"></a>      <span class="c">!     interface.                                                  |</span>
<a name="ln-488"></a>      <span class="c">!     ----------                                                  |</span>
<a name="ln-489"></a>      <span class="c">!                                                                 |</span>
<a name="ln-490"></a>      <span class="c">!     *checkinitvalues* is called from *program*.                 |</span>
<a name="ln-491"></a>      <span class="c">!                                                                 |</span>
<a name="ln-492"></a>      <span class="c">!-----------------------------------------------------------------|</span>
<a name="ln-493"></a>
<a name="ln-494"></a>      <span class="k">use </span><span class="n">modsurfdata</span><span class="p">,</span> <span class="k">only</span> <span class="p">:</span> <span class="n">wtsurf</span><span class="p">,</span> <span class="n">wqsurf</span><span class="p">,</span> <span class="n">qts</span><span class="p">,</span> <span class="n">ps</span>
<a name="ln-495"></a>      <span class="k">use </span><span class="n">modglobal</span><span class="p">,</span> <span class="k">only</span>   <span class="p">:</span> <span class="n">imax</span><span class="p">,</span><span class="n">kmax</span><span class="p">,</span><span class="n">jtot</span><span class="p">,</span><span class="n">ysize</span><span class="p">,</span><span class="n">xsize</span><span class="p">,</span><span class="n">dxf</span><span class="p">,</span><span class="n">ib</span><span class="p">,</span><span class="n">ie</span><span class="p">,&amp;</span>
<a name="ln-496"></a>                              <span class="n">dtmax</span><span class="p">,</span><span class="n">runtime</span><span class="p">,</span><span class="n">startfile</span><span class="p">,</span><span class="n">lwarmstart</span><span class="p">,</span><span class="n">lstratstart</span><span class="p">,&amp;</span>
<a name="ln-497"></a>                              <span class="n">BCxm</span><span class="p">,</span><span class="n">BCxT</span><span class="p">,</span><span class="n">BCxq</span><span class="p">,</span><span class="n">BCxs</span><span class="p">,</span><span class="n">BCtopm</span><span class="p">,</span><span class="n">BCbotm</span><span class="p">,&amp;</span>
<a name="ln-498"></a>                              <span class="n">iinletgen</span><span class="p">,</span><span class="n">linoutflow</span><span class="p">,</span><span class="n">ltempeq</span><span class="p">,</span><span class="n">iwalltemp</span><span class="p">,</span><span class="n">iwallmom</span><span class="p">,&amp;</span>
<a name="ln-499"></a>                              <span class="n">ipoiss</span><span class="p">,</span><span class="n">POISS_FFT</span><span class="p">,</span><span class="n">POISS_CYC</span>
<a name="ln-500"></a>      <span class="k">use </span><span class="n">modmpi</span><span class="p">,</span> <span class="k">only</span>      <span class="p">:</span> <span class="n">myid</span><span class="p">,</span> <span class="n">nprocs</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span>
<a name="ln-501"></a>      <span class="k">use </span><span class="n">modglobal</span><span class="p">,</span> <span class="k">only</span>   <span class="p">:</span> <span class="n">idriver</span>
<a name="ln-502"></a>      <span class="k">implicit none</span>
<a name="ln-503"></a><span class="k">      </span><span class="kt">real</span> <span class="kd">::</span> <span class="n">d</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imax</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-504"></a>      <span class="kt">logical</span> <span class="kd">::</span> <span class="n">inequi</span>
<a name="ln-505"></a>
<a name="ln-506"></a>      <span class="k">if</span> <span class="p">(</span><span class="nb">mod</span><span class="p">(</span><span class="n">jtot</span><span class="p">,</span> <span class="n">nprocs</span><span class="p">)</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-507"></a><span class="k">         if</span> <span class="p">(</span><span class="n">myid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-508"></a><span class="k">            write</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;STOP ERROR IN NUMBER OF PROCESSORS&#39;</span>
<a name="ln-509"></a>            <span class="k">write</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;nprocs must divide jtot!!! &#39;</span>
<a name="ln-510"></a>            <span class="k">write</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;nprocs and jtot are: &#39;</span><span class="p">,</span> <span class="n">nprocs</span><span class="p">,</span> <span class="n">jtot</span>
<a name="ln-511"></a>         <span class="k">end if</span>
<a name="ln-512"></a><span class="k">         call </span><span class="n">MPI_FINALIZE</span><span class="p">(</span><span class="n">mpierr</span><span class="p">)</span>
<a name="ln-513"></a>         <span class="k">stop </span><span class="mi">1</span>
<a name="ln-514"></a>      <span class="k">end if</span>
<a name="ln-515"></a>
<a name="ln-516"></a><span class="k">      if</span> <span class="p">(</span><span class="n">ipoiss</span><span class="o">==</span><span class="n">POISS_FFT</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-517"></a><span class="k">        if</span><span class="p">(</span><span class="nb">mod</span><span class="p">(</span><span class="n">imax</span><span class="p">,</span><span class="n">nprocs</span><span class="p">)</span><span class="o">/=</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-518"></a><span class="k">          if</span><span class="p">(</span><span class="n">myid</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-519"></a><span class="k">            write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;STOP ERROR IN NUMBER OF PROCESSORS&#39;</span>
<a name="ln-520"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;nprocs must divide imax!!! &#39;</span>
<a name="ln-521"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;nprocs and imax are: &#39;</span><span class="p">,</span><span class="n">nprocs</span><span class="p">,</span><span class="n">imax</span>
<a name="ln-522"></a>          <span class="k">end if</span>
<a name="ln-523"></a><span class="k">          call </span><span class="n">MPI_FINALIZE</span><span class="p">(</span><span class="n">mpierr</span><span class="p">)</span>
<a name="ln-524"></a>          <span class="k">stop </span><span class="mi">1</span>
<a name="ln-525"></a>        <span class="k">end if</span>
<a name="ln-526"></a><span class="k">      end if</span>
<a name="ln-527"></a>
<a name="ln-528"></a><span class="k">      if</span> <span class="p">(</span><span class="nb">mod</span><span class="p">(</span><span class="n">kmax</span><span class="p">,</span> <span class="n">nprocs</span><span class="p">)</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-529"></a><span class="k">         if</span> <span class="p">(</span><span class="n">myid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-530"></a><span class="k">            write</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;STOP ERROR IN NUMBER OF PROCESSORS&#39;</span>
<a name="ln-531"></a>            <span class="k">write</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;nprocs must divide kmax!!! &#39;</span>
<a name="ln-532"></a>            <span class="k">write</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;nprocs and kmax are: &#39;</span><span class="p">,</span> <span class="n">nprocs</span><span class="p">,</span> <span class="n">kmax</span>
<a name="ln-533"></a>         <span class="k">end if</span>
<a name="ln-534"></a><span class="k">         call </span><span class="n">MPI_FINALIZE</span><span class="p">(</span><span class="n">mpierr</span><span class="p">)</span>
<a name="ln-535"></a>         <span class="k">stop </span><span class="mi">1</span>
<a name="ln-536"></a>      <span class="k">end if</span>
<a name="ln-537"></a>
<a name="ln-538"></a>      <span class="c">!Check Namoptions</span>
<a name="ln-539"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">runtime</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-540"></a><span class="k">         write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: runtime out of range/not set&#39;</span>
<a name="ln-541"></a>         <span class="k">stop </span><span class="mi">1</span>
<a name="ln-542"></a>      <span class="k">end if</span>
<a name="ln-543"></a><span class="k">      if</span> <span class="p">(</span><span class="n">dtmax</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-544"></a><span class="k">         write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: dtmax out of range/not set&#39;</span>
<a name="ln-545"></a>         <span class="k">stop </span><span class="mi">1</span>
<a name="ln-546"></a>      <span class="k">end if</span>
<a name="ln-547"></a><span class="k">      if</span> <span class="p">(</span><span class="n">ps</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-548"></a><span class="k">         write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: psout of range/not set&#39;</span>
<a name="ln-549"></a>         <span class="k">stop </span><span class="mi">1</span>
<a name="ln-550"></a>      <span class="k">end if</span>
<a name="ln-551"></a><span class="k">      if</span> <span class="p">(</span><span class="n">xsize</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-552"></a><span class="k">         write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: xsize out of range/not set&#39;</span>
<a name="ln-553"></a>         <span class="k">stop </span><span class="mi">1</span>
<a name="ln-554"></a>      <span class="k">end if</span>
<a name="ln-555"></a><span class="k">      if</span> <span class="p">(</span><span class="n">ysize</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-556"></a><span class="k">         write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: ysize out of range/not set&#39;</span>
<a name="ln-557"></a>         <span class="k">stop </span><span class="mi">1</span>
<a name="ln-558"></a>      <span class="k">end if</span>
<a name="ln-559"></a>
<a name="ln-560"></a><span class="k">      if</span> <span class="p">((</span><span class="n">lwarmstart</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">lstratstart</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-561"></a><span class="k">         if</span> <span class="p">(</span><span class="n">startfile</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">then </span>
<a name="ln-562"></a><span class="k">            write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;ERROR: no restartfile set&#39;</span>
<a name="ln-563"></a>            <span class="k">stop </span><span class="mi">1</span>
<a name="ln-564"></a>         <span class="k">end if</span>
<a name="ln-565"></a><span class="k">      end if</span>
<a name="ln-566"></a>
<a name="ln-567"></a>      <span class="c">! Switch to ensure that neutral wall function is called when ltempeq=false and if iwalltemp==1 (constant flux and therefore wall temp is not resolved.</span>
<a name="ln-568"></a>      <span class="k">if</span> <span class="p">((</span><span class="n">ltempeq</span> <span class="p">.</span><span class="n">eqv</span><span class="p">.</span> <span class="p">.</span><span class="n">false</span><span class="p">.)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">iwalltemp</span><span class="o">==</span><span class="mi">1</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-569"></a><span class="k">         </span><span class="n">iwallmom</span> <span class="o">=</span> <span class="mi">3</span>
<a name="ln-570"></a>         <span class="n">BCbotm</span> <span class="o">=</span> <span class="mi">3</span>
<a name="ln-571"></a>      <span class="k">end if</span>
<a name="ln-572"></a>
<a name="ln-573"></a>      <span class="c">! choosing inoutflow in x requires switches to be set</span>
<a name="ln-574"></a>      <span class="c">! tg3315 - these could be moved to init boundary</span>
<a name="ln-575"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">BCxm</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-576"></a><span class="k">         write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;inoutflow conditions, setting appropriate switches (1)&quot;</span>
<a name="ln-577"></a>         <span class="n">iinletgen</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-578"></a>         <span class="n">BCxT</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!temperature is considered in inletgen &amp; iolet</span>
<a name="ln-579"></a>         <span class="n">BCxq</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!humidity is considered in iolet</span>
<a name="ln-580"></a>         <span class="n">BCxs</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!scalars are considered in iolet</span>
<a name="ln-581"></a>         <span class="n">BCtopm</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!velocity at top determined by topm</span>
<a name="ln-582"></a>         <span class="n">linoutflow</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-583"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iinletgen</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-584"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-585"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxq</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-586"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxs</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-587"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCtopm</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-588"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">linoutflow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-589"></a>
<a name="ln-590"></a>      <span class="k">else if</span> <span class="p">(</span><span class="n">BCxm</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">3</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-591"></a><span class="k">         write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;inoutflow conditions, setting appropriate switches (2)&quot;</span>
<a name="ln-592"></a>
<a name="ln-593"></a>         <span class="n">iinletgen</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-594"></a>         <span class="c">! see modstartup for conditions that apply with inletgenerators</span>
<a name="ln-595"></a>         <span class="c">! move to modstartup</span>
<a name="ln-596"></a>         <span class="n">BCxT</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!temperature is considered in inletgen &amp; iolet</span>
<a name="ln-597"></a>         <span class="n">BCxq</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!humidity is considered in iolet</span>
<a name="ln-598"></a>         <span class="n">BCxs</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!scalars are considered in iolet</span>
<a name="ln-599"></a>         <span class="n">BCtopm</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!velocity at top determined by topm</span>
<a name="ln-600"></a>         <span class="n">linoutflow</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-601"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iinletgen</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-602"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-603"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxq</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-604"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxs</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-605"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCtopm</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-606"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">linoutflow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-607"></a>
<a name="ln-608"></a>      <span class="k">else if</span> <span class="p">(</span><span class="n">BCxm</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">4</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-609"></a><span class="k">         write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;inoutflow conditions, setting appropriate switches (0)&quot;</span>
<a name="ln-610"></a>
<a name="ln-611"></a>         <span class="n">iinletgen</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-612"></a>         <span class="c">! see modstartup for conditions that apply with inletgenerators</span>
<a name="ln-613"></a>         <span class="c">! move to modstartup</span>
<a name="ln-614"></a>         <span class="n">BCxT</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!temperature is considered in inletgen &amp; iolet</span>
<a name="ln-615"></a>         <span class="n">BCxq</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!humidity is considered in iolet</span>
<a name="ln-616"></a>         <span class="n">BCxs</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!scalars are considered in iolet</span>
<a name="ln-617"></a>         <span class="n">BCtopm</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!velocity at top determined by topm</span>
<a name="ln-618"></a>         <span class="n">linoutflow</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-619"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iinletgen</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-620"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-621"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxq</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-622"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxs</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-623"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCtopm</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-624"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">linoutflow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-625"></a>
<a name="ln-626"></a>      <span class="k">else if</span> <span class="p">(</span><span class="n">BCxm</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">5</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-627"></a>
<a name="ln-628"></a><span class="k">         write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;inoutflow conditions and idriver, setting appropriate switches (0)&quot;</span>
<a name="ln-629"></a>
<a name="ln-630"></a>         <span class="n">iinletgen</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-631"></a>         <span class="n">idriver</span> <span class="o">=</span> <span class="mi">2</span>
<a name="ln-632"></a>         <span class="n">BCxT</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!temperature is considered in inletgen &amp; iolet</span>
<a name="ln-633"></a>         <span class="n">BCxq</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!humidity is considered in iolet</span>
<a name="ln-634"></a>         <span class="n">BCxs</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!scalars are considered in iolet</span>
<a name="ln-635"></a>         <span class="n">BCtopm</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">!velocity at top determined by topm</span>
<a name="ln-636"></a>         <span class="n">linoutflow</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-637"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">iinletgen</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-638"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">idriver</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-639"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-640"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxq</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-641"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCxs</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-642"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">BCtopm</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-643"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">linoutflow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_LOGICAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-644"></a>
<a name="ln-645"></a>      <span class="k">end if</span>
<a name="ln-646"></a>
<a name="ln-647"></a>      <span class="c">! check the Poisson solver setting w.r.t. x-grid</span>
<a name="ln-648"></a>      <span class="n">d</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">imax</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">dxf</span><span class="p">(</span><span class="n">ib</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">ie</span><span class="p">)</span> <span class="o">-</span> <span class="n">dxf</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-649"></a>      <span class="n">inequi</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">&gt;</span><span class="n">dxf</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span><span class="o">*</span><span class="mf">1e-5</span><span class="p">)</span>
<a name="ln-650"></a>
<a name="ln-651"></a>      <span class="k">if</span> <span class="p">((.</span><span class="nb">not</span><span class="p">.</span> <span class="n">inequi</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(</span><span class="n">ipoiss</span> <span class="o">==</span> <span class="n">POISS_CYC</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">linoutflow</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-652"></a><span class="k">         write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;WARNING: consider using FFT poisson solver for better performance!&quot;</span>
<a name="ln-653"></a>      <span class="k">end if</span>
<a name="ln-654"></a>
<a name="ln-655"></a><span class="k">      if</span> <span class="p">((</span><span class="n">ipoiss</span> <span class="o">==</span> <span class="n">POISS_FFT</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(</span><span class="n">inequi</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-656"></a><span class="k">         write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;ERROR: POISS_FFT requires equidistant grid. Aborting...&quot;</span>
<a name="ln-657"></a>         <span class="k">call </span><span class="n">MPI_FINALIZE</span><span class="p">(</span><span class="n">mpierr</span><span class="p">)</span>
<a name="ln-658"></a>         <span class="k">stop </span><span class="mi">1</span>
<a name="ln-659"></a>      <span class="k">end if</span>
<a name="ln-660"></a>
<a name="ln-661"></a><span class="k">   end subroutine </span><span class="n">checkinitvalues</span>
<a name="ln-662"></a>
<a name="ln-663"></a>   <span class="k">subroutine </span><span class="n">readinitfiles</span>
<a name="ln-664"></a>      <span class="k">use </span><span class="n">modfields</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">u0</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">um</span><span class="p">,</span> <span class="n">vm</span><span class="p">,</span> <span class="n">wm</span><span class="p">,</span> <span class="n">thlm</span><span class="p">,</span> <span class="n">thl0</span><span class="p">,</span> <span class="n">thl0h</span><span class="p">,</span> <span class="n">qtm</span><span class="p">,</span> <span class="n">qt0</span><span class="p">,</span> <span class="n">qt0h</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-665"></a>         <span class="n">ql0</span><span class="p">,</span> <span class="n">ql0h</span><span class="p">,</span> <span class="n">thv0h</span><span class="p">,</span> <span class="n">sv0</span><span class="p">,</span> <span class="n">svm</span><span class="p">,</span> <span class="n">e12m</span><span class="p">,</span> <span class="n">e120</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-666"></a>         <span class="n">dudxls</span><span class="p">,</span> <span class="n">dudyls</span><span class="p">,</span> <span class="n">dvdxls</span><span class="p">,</span> <span class="n">dvdyls</span><span class="p">,</span> <span class="n">dthldxls</span><span class="p">,</span> <span class="n">dthldyls</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-667"></a>         <span class="n">dqtdxls</span><span class="p">,</span> <span class="n">dqtdyls</span><span class="p">,</span> <span class="n">dqtdtls</span><span class="p">,</span> <span class="n">dpdx</span><span class="p">,</span> <span class="n">dpdxl</span><span class="p">,</span> <span class="n">dpdyl</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-668"></a>         <span class="n">wfls</span><span class="p">,</span> <span class="n">whls</span><span class="p">,</span> <span class="n">ug</span><span class="p">,</span> <span class="n">vg</span><span class="p">,</span> <span class="n">pgx</span><span class="p">,</span> <span class="n">pgy</span><span class="p">,</span> <span class="n">uprof</span><span class="p">,</span> <span class="n">vprof</span><span class="p">,</span> <span class="n">thlprof</span><span class="p">,</span> <span class="n">qtprof</span><span class="p">,</span> <span class="n">e12prof</span><span class="p">,</span> <span class="n">svprof</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-669"></a>         <span class="n">v0av</span><span class="p">,</span> <span class="n">u0av</span><span class="p">,</span> <span class="n">qt0av</span><span class="p">,</span> <span class="n">ql0av</span><span class="p">,</span> <span class="n">thl0av</span><span class="p">,</span> <span class="n">qt0av</span><span class="p">,</span> <span class="n">sv0av</span><span class="p">,</span> <span class="n">exnf</span><span class="p">,</span> <span class="n">exnh</span><span class="p">,</span> <span class="n">presf</span><span class="p">,</span> <span class="n">presh</span><span class="p">,</span> <span class="n">rhof</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-670"></a>         <span class="n">thlpcar</span><span class="p">,</span> <span class="n">uav</span><span class="p">,</span> <span class="n">thvh</span><span class="p">,</span> <span class="n">thvf</span><span class="p">,</span> <span class="n">IIc</span><span class="p">,</span> <span class="n">IIcs</span><span class="p">,</span> <span class="n">IIu</span><span class="p">,</span> <span class="n">IIus</span><span class="p">,</span> <span class="n">IIv</span><span class="p">,</span> <span class="n">IIvs</span><span class="p">,</span> <span class="n">IIw</span><span class="p">,</span> <span class="n">IIws</span>
<a name="ln-671"></a>            <span class="k">use </span><span class="n">modglobal</span><span class="p">,</span>         <span class="k">only</span> <span class="p">:</span> <span class="n">ib</span><span class="p">,</span><span class="n">ie</span><span class="p">,</span><span class="n">ih</span><span class="p">,</span><span class="n">jb</span><span class="p">,</span><span class="n">je</span><span class="p">,</span><span class="n">jh</span><span class="p">,</span><span class="n">kb</span><span class="p">,</span><span class="n">ke</span><span class="p">,</span><span class="n">kh</span><span class="p">,</span><span class="n">khc</span><span class="p">,</span><span class="n">kmax</span><span class="p">,</span><span class="n">dtmax</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">runtime</span><span class="p">,</span><span class="n">timeleft</span><span class="p">,</span><span class="n">timee</span><span class="p">,</span><span class="n">ntimee</span><span class="p">,</span><span class="n">ntrun</span><span class="p">,</span><span class="n">btime</span><span class="p">,</span><span class="n">dt_lim</span><span class="p">,</span><span class="n">nsv</span><span class="p">,&amp;</span>
<a name="ln-672"></a>         <span class="n">zf</span><span class="p">,</span> <span class="n">zh</span><span class="p">,</span> <span class="n">dzf</span><span class="p">,</span> <span class="n">dzh</span><span class="p">,</span> <span class="n">rv</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">grav</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">rlv</span><span class="p">,</span> <span class="n">pref0</span><span class="p">,</span> <span class="n">om23_gs</span><span class="p">,</span> <span class="n">jgb</span><span class="p">,</span> <span class="n">jge</span><span class="p">,</span> <span class="n">Uinf</span><span class="p">,</span> <span class="n">Vinf</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-673"></a>         <span class="n">rslabs</span><span class="p">,</span> <span class="n">e12min</span><span class="p">,</span> <span class="n">dzh</span><span class="p">,</span> <span class="n">dtheta</span><span class="p">,</span> <span class="n">dqt</span><span class="p">,</span> <span class="n">dsv</span><span class="p">,</span> <span class="n">cexpnr</span><span class="p">,</span> <span class="n">ifinput</span><span class="p">,</span> <span class="n">lwarmstart</span><span class="p">,</span> <span class="n">lstratstart</span><span class="p">,</span> <span class="n">trestart</span><span class="p">,</span> <span class="n">numol</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-674"></a>         <span class="n">ladaptive</span><span class="p">,</span> <span class="n">tnextrestart</span><span class="p">,</span> <span class="n">jmax</span><span class="p">,</span> <span class="n">linoutflow</span><span class="p">,</span> <span class="n">lper2inout</span><span class="p">,</span> <span class="n">iinletgen</span><span class="p">,</span> <span class="n">lreadminl</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-675"></a>         <span class="n">uflowrate</span><span class="p">,</span> <span class="n">vflowrate</span><span class="p">,</span><span class="n">ltempeq</span><span class="p">,</span> <span class="n">prandtlmoli</span><span class="p">,</span> <span class="n">freestreamav</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-676"></a>         <span class="n">tnextfielddump</span><span class="p">,</span> <span class="n">tfielddump</span><span class="p">,</span> <span class="n">tsample</span><span class="p">,</span> <span class="n">tstatsdump</span><span class="p">,</span> <span class="n">startfile</span><span class="p">,</span> <span class="n">lprofforc</span><span class="p">,</span> <span class="n">lchem</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">JNO2</span><span class="p">,&amp;</span>
<a name="ln-677"></a>         <span class="n">idriver</span><span class="p">,</span><span class="n">dtdriver</span><span class="p">,</span><span class="n">driverstore</span><span class="p">,</span><span class="n">tdriverstart</span><span class="p">,</span><span class="n">tdriverdump</span>        
<a name="ln-678"></a>      <span class="k">use </span><span class="n">modsubgriddata</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">ekm</span><span class="p">,</span> <span class="n">ekh</span>
<a name="ln-679"></a>      <span class="k">use </span><span class="n">modsurfdata</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">wtsurf</span><span class="p">,</span> <span class="n">wqsurf</span><span class="p">,</span> <span class="n">wsvsurf</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-680"></a>         <span class="n">thls</span><span class="p">,</span> <span class="n">thvs</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">qts</span><span class="p">,</span> <span class="n">svs</span><span class="p">,</span> <span class="n">sv_top</span>
<a name="ln-681"></a>      <span class="c">! use modsurface,        only : surface,dthldz</span>
<a name="ln-682"></a>      <span class="k">use </span><span class="n">modboundary</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">boundary</span><span class="p">,</span> <span class="n">tqaver</span>
<a name="ln-683"></a>      <span class="k">use </span><span class="n">modmpi</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">slabsum</span><span class="p">,</span> <span class="n">myid</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">,</span> <span class="n">my_real</span><span class="p">,</span> <span class="n">avexy_ibm</span>
<a name="ln-684"></a>      <span class="k">use </span><span class="n">modthermodynamics</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">thermodynamics</span><span class="p">,</span> <span class="n">calc_halflev</span>
<a name="ln-685"></a>      <span class="k">use </span><span class="n">modinletdata</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">Uinl</span><span class="p">,</span> <span class="n">Urec</span><span class="p">,</span> <span class="n">Wrec</span><span class="p">,</span> <span class="n">u0inletbc</span><span class="p">,</span> <span class="n">v0inletbc</span><span class="p">,</span> <span class="n">w0inletbc</span><span class="p">,</span> <span class="n">ubulk</span><span class="p">,</span> <span class="n">irecy</span><span class="p">,</span> <span class="n">Utav</span><span class="p">,</span> <span class="n">Ttav</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-686"></a>         <span class="n">uminletbc</span><span class="p">,</span> <span class="n">vminletbc</span><span class="p">,</span> <span class="n">wminletbc</span><span class="p">,</span> <span class="n">u0inletbcold</span><span class="p">,</span> <span class="n">v0inletbcold</span><span class="p">,</span> <span class="n">w0inletbcold</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-687"></a>         <span class="n">storeu0inletbc</span><span class="p">,</span> <span class="n">storev0inletbc</span><span class="p">,</span> <span class="n">storew0inletbc</span><span class="p">,</span> <span class="n">nstepread</span><span class="p">,</span> <span class="n">nfile</span><span class="p">,</span> <span class="n">Tinl</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-688"></a>         <span class="n">Trec</span><span class="p">,</span> <span class="n">tminletbc</span><span class="p">,</span> <span class="n">t0inletbcold</span><span class="p">,</span> <span class="n">t0inletbc</span><span class="p">,</span> <span class="n">storet0inletbc</span><span class="p">,</span> <span class="n">utaui</span><span class="p">,</span> <span class="n">ttaui</span><span class="p">,</span> <span class="n">iangle</span><span class="p">,&amp;</span>
<a name="ln-689"></a>         <span class="n">u0driver</span><span class="p">,</span><span class="n">v0driver</span><span class="p">,</span><span class="n">w0driver</span><span class="p">,</span><span class="n">e120driver</span><span class="p">,</span><span class="n">tdriver</span><span class="p">,</span><span class="n">thl0driver</span><span class="p">,</span><span class="n">qt0driver</span><span class="p">,</span><span class="n">storetdriver</span><span class="p">,&amp;</span>
<a name="ln-690"></a>         <span class="n">storeu0driver</span><span class="p">,</span><span class="n">storev0driver</span><span class="p">,</span><span class="n">storew0driver</span><span class="p">,</span><span class="n">storee120driver</span><span class="p">,</span><span class="n">storethl0driver</span><span class="p">,</span><span class="n">storeqt0driver</span><span class="p">,&amp;</span>
<a name="ln-691"></a>         <span class="n">nstepreaddriver</span>
<a name="ln-692"></a>      <span class="k">use </span><span class="n">modinlet</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">readinletfile</span>
<a name="ln-693"></a>      <span class="k">use </span><span class="n">moddriver</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span> <span class="n">readdriverfile</span><span class="p">,</span><span class="n">initdriver</span><span class="p">,</span><span class="n">drivergen</span>
<a name="ln-694"></a>
<a name="ln-695"></a>      <span class="kt">integer </span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span>
<a name="ln-696"></a>
<a name="ln-697"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">height</span><span class="p">(:),</span> <span class="n">th0av</span><span class="p">(:)</span>
<a name="ln-698"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">:</span><span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">,</span> <span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">:</span><span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span> <span class="kd">::</span> <span class="n">thv0</span>
<a name="ln-699"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="kd">::</span> <span class="n">uaverage</span> <span class="c">! volume averaged u-velocity</span>
<a name="ln-700"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vaverage</span> <span class="c">! volume averaged v-velocity</span>
<a name="ln-701"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="kd">::</span> <span class="n">uaverager</span> <span class="c">! recycle plane</span>
<a name="ln-702"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="kd">::</span> <span class="n">uaveragei</span> <span class="c">! inlet plane</span>
<a name="ln-703"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="kd">::</span> <span class="n">taverager</span> <span class="c">! recycle plane</span>
<a name="ln-704"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="kd">::</span> <span class="n">taveragei</span> <span class="c">! inlet plane</span>
<a name="ln-705"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">waverage</span>
<a name="ln-706"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">uprofrot</span>
<a name="ln-707"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vprofrot</span>
<a name="ln-708"></a>      <span class="kt">real </span><span class="n">tv</span><span class="p">,</span> <span class="n">ran</span><span class="p">,</span> <span class="n">ran1</span><span class="p">,</span> <span class="n">vbulk</span>
<a name="ln-709"></a>
<a name="ln-710"></a>      <span class="kt">character</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-711"></a>
<a name="ln-712"></a>      <span class="k">allocate</span> <span class="p">(</span><span class="n">height</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">))</span>
<a name="ln-713"></a>      <span class="k">allocate</span> <span class="p">(</span><span class="n">th0av</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">))</span>
<a name="ln-714"></a>
<a name="ln-715"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">lstratstart</span><span class="p">)</span> <span class="k">then</span> <span class="c">! Switch</span>
<a name="ln-716"></a>
<a name="ln-717"></a>         <span class="c">! Read restart files as in lwarmstart</span>
<a name="ln-718"></a>         <span class="k">call </span><span class="n">readrestartfiles</span>
<a name="ln-719"></a>         <span class="n">um</span> <span class="o">=</span> <span class="n">u0</span>
<a name="ln-720"></a>         <span class="n">vm</span> <span class="o">=</span> <span class="n">v0</span>
<a name="ln-721"></a>         <span class="n">wm</span> <span class="o">=</span> <span class="n">w0</span>
<a name="ln-722"></a>         <span class="n">thlm</span> <span class="o">=</span> <span class="n">thl0</span> <span class="c">!do this before or just not?</span>
<a name="ln-723"></a>         <span class="n">qtm</span> <span class="o">=</span> <span class="n">qt0</span>
<a name="ln-724"></a>         <span class="n">svm</span> <span class="o">=</span> <span class="n">sv0</span>
<a name="ln-725"></a>         <span class="n">e12m</span> <span class="o">=</span> <span class="n">e120</span>
<a name="ln-726"></a>
<a name="ln-727"></a>         <span class="c">! Overwrite thlm, thl0, qtm, qt0 from prof.inp.xxx</span>
<a name="ln-728"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">myid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-729"></a><span class="k">            open</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;prof.inp.&#39;</span><span class="o">//</span><span class="n">cexpnr</span><span class="p">)</span>
<a name="ln-730"></a>            <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-731"></a>            <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-732"></a>            <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-733"></a>
<a name="ln-734"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-735"></a>               <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-736"></a>                  <span class="n">height</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-737"></a>                  <span class="n">thlprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-738"></a>                  <span class="n">qtprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-739"></a>                  <span class="n">uprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-740"></a>                  <span class="n">vprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-741"></a>                  <span class="n">e12prof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-742"></a>            <span class="k">end do</span>
<a name="ln-743"></a><span class="k">            close</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span>
<a name="ln-744"></a>
<a name="ln-745"></a>            <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;height    thl     qt      u      v     e12&#39;</span>
<a name="ln-746"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">ke</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-747"></a>               <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="s1">&#39;(f7.1,2f8.1,3f7.1)&#39;</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-748"></a>                  <span class="n">height</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-749"></a>                  <span class="n">thlprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-750"></a>                  <span class="n">qtprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-751"></a>                  <span class="n">uprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-752"></a>                  <span class="n">vprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-753"></a>                  <span class="n">e12prof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-754"></a>
<a name="ln-755"></a>            <span class="k">end do</span>
<a name="ln-756"></a><span class="k">         end if</span> <span class="c">!myid=0</span>
<a name="ln-757"></a>
<a name="ln-758"></a>         <span class="c">! MPI broadcast thl and qt</span>
<a name="ln-759"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">thlprof</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-760"></a>         <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">qtprof</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-761"></a>
<a name="ln-762"></a>         <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-763"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-764"></a>               <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-765"></a>                  <span class="n">thl0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">thlprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-766"></a>                  <span class="n">thlm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">thlprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-767"></a>                  <span class="n">qt0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">qtprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-768"></a>                  <span class="n">qtm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">qtprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-769"></a>               <span class="k">end do</span>
<a name="ln-770"></a><span class="k">            end do</span>
<a name="ln-771"></a><span class="k">         end do</span>
<a name="ln-772"></a>
<a name="ln-773"></a>         <span class="c">!ILS13 reintroduced thv !tg3315 this part may wrong, could need to use</span>
<a name="ln-774"></a>         <span class="k">call </span><span class="n">calc_halflev</span>
<a name="ln-775"></a>         <span class="c">! exnf = (presf/pref0)**(rd/cp)  !exner functions not in restart files</span>
<a name="ln-776"></a>         <span class="c">! anymore.. or at least not read</span>
<a name="ln-777"></a>         <span class="c">! exnh = (presh/pref0)**(rd/cp)</span>
<a name="ln-778"></a>
<a name="ln-779"></a>         <span class="c">!   write(*,*) &quot;exnf&quot;,enf</span>
<a name="ln-780"></a>         <span class="c">!   write(*,*) &quot;exnh&quot;,exnh</span>
<a name="ln-781"></a>         <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span>
<a name="ln-782"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span>
<a name="ln-783"></a>               <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ie</span>
<a name="ln-784"></a>                  <span class="c">!write(*,*) &quot;thl0h&quot;,thl0h(i,j,k)</span>
<a name="ln-785"></a>                  <span class="n">thv0h</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">thl0h</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">rlv</span><span class="o">*</span><span class="n">ql0h</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">cp</span><span class="p">))</span> <span class="p">&amp;</span>
<a name="ln-786"></a>                                   <span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">rv</span><span class="o">/</span><span class="n">rd</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">qt0h</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">rv</span><span class="o">/</span><span class="n">rd</span><span class="o">*</span><span class="n">ql0h</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-787"></a>               <span class="k">end do</span>
<a name="ln-788"></a><span class="k">            end do</span>
<a name="ln-789"></a><span class="k">         end do</span>
<a name="ln-790"></a>
<a name="ln-791"></a><span class="k">         do </span><span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="p">,</span> <span class="n">je</span>
<a name="ln-792"></a>            <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ie</span>
<a name="ln-793"></a>               <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span>
<a name="ln-794"></a>                  <span class="n">thv0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">thl0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">rlv</span><span class="o">*</span><span class="n">ql0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">cp</span><span class="p">))</span> <span class="p">&amp;</span>
<a name="ln-795"></a>                                  <span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">rv</span><span class="o">/</span><span class="n">rd</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">qt0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">rv</span><span class="o">/</span><span class="n">rd</span><span class="o">*</span><span class="n">ql0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-796"></a>               <span class="k">end do</span>
<a name="ln-797"></a><span class="k">            end do</span>
<a name="ln-798"></a><span class="k">         end do</span>
<a name="ln-799"></a>
<a name="ln-800"></a><span class="k">         </span><span class="n">thvh</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-801"></a>         <span class="c">! call slabsum(thvh,kb,ke,thv0h,ib-ih,ie+ih,jb-jh,je+jh,kb-kh,ke+kh,ib,ie,jb,je,kb,ke) ! redefine halflevel thv using calculated thv</span>
<a name="ln-802"></a>         <span class="k">call </span><span class="n">avexy_ibm</span><span class="p">(</span><span class="n">thvh</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">thv0h</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">ib</span><span class="p">,</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">,</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">,</span><span class="n">ke</span><span class="p">,</span><span class="n">ih</span><span class="p">,</span><span class="n">jh</span><span class="p">,</span><span class="n">kh</span><span class="p">,</span><span class="n">IIw</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">IIws</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),.</span><span class="n">false</span><span class="p">.)</span>
<a name="ln-803"></a>         <span class="c">! thvh = thvh/rslabs</span>
<a name="ln-804"></a>
<a name="ln-805"></a>         <span class="n">thvf</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-806"></a>         <span class="k">call </span><span class="n">avexy_ibm</span><span class="p">(</span><span class="n">thvf</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">thv0</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">ib</span><span class="p">,</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">,</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">,</span><span class="n">ke</span><span class="p">,</span><span class="n">ih</span><span class="p">,</span><span class="n">jh</span><span class="p">,</span><span class="n">kh</span><span class="p">,</span><span class="n">IIc</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">IIcs</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),.</span><span class="n">false</span><span class="p">.)</span>
<a name="ln-807"></a>         <span class="c">! call slabsum(thvf,kb,ke,thv0,ib-ih,ie+ih,jb-jh,je+jh,kb-kh,ke+kh,ib,ie,jb,je,kb,ke)</span>
<a name="ln-808"></a>         <span class="c">! thvf = thvf/rslabs</span>
<a name="ln-809"></a>
<a name="ln-810"></a>      <span class="k">else</span> <span class="c">!if not lstratstart</span>
<a name="ln-811"></a>
<a name="ln-812"></a>         <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">lwarmstart</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-813"></a>
<a name="ln-814"></a>            <span class="c">!********************************************************************</span>
<a name="ln-815"></a>
<a name="ln-816"></a>            <span class="c">!    1.0 prepare initial fields from files &#39;prof.inp&#39; and &#39;scalar.inp&#39;</span>
<a name="ln-817"></a>            <span class="c">!    ----------------------------------------------------------------</span>
<a name="ln-818"></a>
<a name="ln-819"></a>            <span class="c">!--------------------------------------------------------------------</span>
<a name="ln-820"></a>            <span class="c">!    1.1 read fields</span>
<a name="ln-821"></a>            <span class="c">!-----------------------------------------------------------------</span>
<a name="ln-822"></a>
<a name="ln-823"></a>            <span class="n">dt</span> <span class="o">=</span> <span class="n">dtmax</span><span class="o">/</span><span class="mi">10</span><span class="mf">0.</span>
<a name="ln-824"></a>            <span class="n">timee</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-825"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">myid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-826"></a><span class="k">               open</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;prof.inp.&#39;</span><span class="o">//</span><span class="n">cexpnr</span><span class="p">)</span>
<a name="ln-827"></a>               <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-828"></a>               <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-829"></a>               <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-830"></a>
<a name="ln-831"></a>               <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-832"></a>                  <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-833"></a>                     <span class="n">height</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-834"></a>                     <span class="n">thlprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-835"></a>                     <span class="n">qtprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-836"></a>                     <span class="n">uprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-837"></a>                     <span class="n">vprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-838"></a>                     <span class="n">e12prof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-839"></a>               <span class="k">end do</span>
<a name="ln-840"></a>
<a name="ln-841"></a>               <span class="c">! Apply rotation in horizontal</span>
<a name="ln-842"></a>               <span class="c">!write (6, *) &#39;iangle = &#39;, iangle</span>
<a name="ln-843"></a>
<a name="ln-844"></a>               <span class="c">!uprofrot = uprof*cos(iangle) - vprof*sin(iangle)</span>
<a name="ln-845"></a>               <span class="c">!vprofrot = vprof*cos(iangle) + uprof*sin(iangle)</span>
<a name="ln-846"></a>               <span class="c">!uprof = uprofrot</span>
<a name="ln-847"></a>               <span class="c">!vprof = vprofrot</span>
<a name="ln-848"></a>
<a name="ln-849"></a>               <span class="k">close</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span>
<a name="ln-850"></a>               <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;height    thl     qt      u      v     e12&#39;</span>
<a name="ln-851"></a>               <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">ke</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-852"></a>                  <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="s1">&#39;(f7.1,2f8.1,3f7.1)&#39;</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-853"></a>                     <span class="n">height</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-854"></a>                     <span class="n">thlprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-855"></a>                     <span class="n">qtprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-856"></a>                     <span class="n">uprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-857"></a>                     <span class="n">vprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-858"></a>                     <span class="n">e12prof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-859"></a>
<a name="ln-860"></a>               <span class="k">end do</span>
<a name="ln-861"></a>
<a name="ln-862"></a><span class="k">               if</span> <span class="p">(</span><span class="nb">minval</span><span class="p">(</span><span class="n">e12prof</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">e12min</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-863"></a><span class="k">                  write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;e12 value is zero (or less) in prof.inp&#39;</span>
<a name="ln-864"></a>                  <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-865"></a>                     <span class="n">e12prof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">e12prof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">e12min</span><span class="p">)</span>
<a name="ln-866"></a>                  <span class="k">end do</span>
<a name="ln-867"></a><span class="k">               end if</span>
<a name="ln-868"></a>
<a name="ln-869"></a><span class="k">            end if</span> <span class="c">! end if myid==0</span>
<a name="ln-870"></a>            <span class="c">! MPI broadcast numbers reading</span>
<a name="ln-871"></a>            <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">thlprof</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-872"></a>            <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">qtprof</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-873"></a>            <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">uprof</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-874"></a>            <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">vprof</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-875"></a>            <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">e12prof</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-876"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-877"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-878"></a>            <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-879"></a>               <span class="n">thl0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">thlprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-880"></a>               <span class="n">thlm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">thlprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-881"></a>               <span class="n">qt0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">qtprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-882"></a>               <span class="n">qtm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">qtprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-883"></a>               <span class="n">u0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">uprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-884"></a>               <span class="n">um</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">uprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-885"></a>               <span class="n">v0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">vprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-886"></a>               <span class="n">vm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">vprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-887"></a>               <span class="n">w0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-888"></a>               <span class="n">wm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-889"></a>               <span class="n">e120</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">e12prof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-890"></a>               <span class="n">e12m</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">e12prof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-891"></a>               <span class="c">!        ekm (i,j,k) = 0.0</span>
<a name="ln-892"></a>               <span class="c">!        ekh (i,j,k) = 0.0</span>
<a name="ln-893"></a>               <span class="n">ekm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">numol</span>
<a name="ln-894"></a>               <span class="n">ekh</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">numol</span>
<a name="ln-895"></a>            <span class="k">end do</span>
<a name="ln-896"></a><span class="k">            end do</span>
<a name="ln-897"></a><span class="k">            end do</span>
<a name="ln-898"></a>
<a name="ln-899"></a><span class="k">            </span><span class="n">ekh</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ekh</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">ke</span><span class="p">)</span> <span class="c">! also for start up</span>
<a name="ln-900"></a>
<a name="ln-901"></a>            <span class="c">! ILS13 30.11.17, added, not sure if necessary</span>
<a name="ln-902"></a>            <span class="c">! ILS13 30.11.1, commented</span>
<a name="ln-903"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span>
<a name="ln-904"></a>               <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span>
<a name="ln-905"></a>                  <span class="n">thl0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">thl0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-906"></a>                  <span class="n">thl0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">kb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">thl0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">kb</span><span class="p">)</span>
<a name="ln-907"></a>               <span class="k">end do</span>
<a name="ln-908"></a><span class="k">            end do</span>
<a name="ln-909"></a>
<a name="ln-910"></a>            <span class="c">!! add random fluctuations</span>
<a name="ln-911"></a>            <span class="n">krand</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">krand</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-912"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">krand</span>
<a name="ln-913"></a>               <span class="k">call </span><span class="n">randomnize</span><span class="p">(</span><span class="n">um</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">randu</span><span class="p">,</span> <span class="n">irandom</span><span class="p">,</span> <span class="n">ih</span><span class="p">,</span> <span class="n">jh</span><span class="p">)</span>
<a name="ln-914"></a>            <span class="k">end do</span>
<a name="ln-915"></a><span class="k">            do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">krand</span>
<a name="ln-916"></a>               <span class="k">call </span><span class="n">randomnize</span><span class="p">(</span><span class="n">vm</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">randu</span><span class="p">,</span> <span class="n">irandom</span><span class="p">,</span> <span class="n">ih</span><span class="p">,</span> <span class="n">jh</span><span class="p">)</span>
<a name="ln-917"></a>            <span class="k">end do</span>
<a name="ln-918"></a><span class="k">            do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">krand</span>
<a name="ln-919"></a>               <span class="k">call </span><span class="n">randomnize</span><span class="p">(</span><span class="n">wm</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">randu</span><span class="p">,</span> <span class="n">irandom</span><span class="p">,</span> <span class="n">ih</span><span class="p">,</span> <span class="n">jh</span><span class="p">)</span>
<a name="ln-920"></a>            <span class="k">end do</span>
<a name="ln-921"></a>
<a name="ln-922"></a>            <span class="c">!       do k=kb+1,ke-1</span>
<a name="ln-923"></a>            <span class="c">!       do j=jb,je</span>
<a name="ln-924"></a>            <span class="c">!       do i=ib+1,ie-1</span>
<a name="ln-925"></a>            <span class="c">!         call random_number(ran)</span>
<a name="ln-926"></a>            <span class="c">!         ran1 = -1. +2.*ran</span>
<a name="ln-927"></a>            <span class="c">!         wm(i,j,k)=wm(i,j,k)+ 0.1*Uinf*ran1</span>
<a name="ln-928"></a>            <span class="c">!       end do</span>
<a name="ln-929"></a>            <span class="c">!       end do</span>
<a name="ln-930"></a>            <span class="c">!       end do</span>
<a name="ln-931"></a>            <span class="c">!</span>
<a name="ln-932"></a>            <span class="c">!       do k=kb+1,ke-1</span>
<a name="ln-933"></a>            <span class="c">!       do j=jb,je</span>
<a name="ln-934"></a>            <span class="c">!       do i=ib+2,ie-1</span>
<a name="ln-935"></a>            <span class="c">!         call random_number(ran)</span>
<a name="ln-936"></a>            <span class="c">!         ran1 = -1. +2.*ran</span>
<a name="ln-937"></a>            <span class="c">!         um(i,j,k)=um(i,j,k)+ 0.1*Uinf*ran1</span>
<a name="ln-938"></a>            <span class="c">!       end do</span>
<a name="ln-939"></a>            <span class="c">!       end do</span>
<a name="ln-940"></a>            <span class="c">!       end do</span>
<a name="ln-941"></a>            <span class="c">!</span>
<a name="ln-942"></a>            <span class="c">!       do k=kb+1,ke-1</span>
<a name="ln-943"></a>            <span class="c">!       do j=jb,je</span>
<a name="ln-944"></a>            <span class="c">!       do i=ib+1,ie-1</span>
<a name="ln-945"></a>            <span class="c">!         call random_number(ran)</span>
<a name="ln-946"></a>            <span class="c">!         ran1 = -1. +2.*ran</span>
<a name="ln-947"></a>            <span class="c">!         vm(i,j,k)=vm(i,j,k)+ 0.1*Uinf*ran1</span>
<a name="ln-948"></a>            <span class="c">!       end do</span>
<a name="ln-949"></a>            <span class="c">!       end do</span>
<a name="ln-950"></a>            <span class="c">!       end do</span>
<a name="ln-951"></a>
<a name="ln-952"></a>            <span class="n">u0</span> <span class="o">=</span> <span class="n">um</span>
<a name="ln-953"></a>            <span class="n">v0</span> <span class="o">=</span> <span class="n">vm</span>
<a name="ln-954"></a>            <span class="n">w0</span> <span class="o">=</span> <span class="n">wm</span>
<a name="ln-955"></a>
<a name="ln-956"></a>            <span class="n">uaverage</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-957"></a>            <span class="c">! call slabsum(uaverage, kb, ke, um, ib - 1, ie + 1, jb - 1, je + 1, kb - 1, ke + 1, ib, ie, jb, je, kb, ke)</span>
<a name="ln-958"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-959"></a>               <span class="n">uaverage</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">uprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dzf</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-960"></a>            <span class="k">end do</span>
<a name="ln-961"></a><span class="k">            </span><span class="n">ubulk</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">uaverage</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">zh</span><span class="p">(</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">zh</span><span class="p">(</span><span class="n">kb</span><span class="p">))</span> <span class="c">! averaged u-velocity inflow profile</span>
<a name="ln-962"></a>
<a name="ln-963"></a>            <span class="n">vaverage</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-964"></a>            <span class="c">! call slabsum(vaverage, kb, ke, vm, ib - 1, ie + 1, jb - 1, je + 1, kb - 1, ke + 1, ib, ie, jb, je, kb, ke)</span>
<a name="ln-965"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-966"></a>               <span class="n">vaverage</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">vprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dzf</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-967"></a>            <span class="k">end do</span>
<a name="ln-968"></a><span class="k">            </span><span class="n">vbulk</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">vaverage</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">zh</span><span class="p">(</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">zh</span><span class="p">(</span><span class="n">kb</span><span class="p">))</span> <span class="c">! averaged u-velocity inflow profile</span>
<a name="ln-969"></a>
<a name="ln-970"></a>            <span class="c">! Set average inlet profile to initial inlet profile in case of inletgenerator mode</span>
<a name="ln-971"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">iinletgen</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-972"></a>
<a name="ln-973"></a><span class="k">               </span><span class="n">uaverage</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-974"></a>               <span class="k">call </span><span class="n">slabsum</span><span class="p">(</span><span class="n">uaverage</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">,</span> <span class="n">um</span><span class="p">,</span> <span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-975"></a>               <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-976"></a>                  <span class="n">uaverage</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">uprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dzf</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-977"></a>               <span class="k">end do</span>
<a name="ln-978"></a><span class="k">               </span><span class="n">ubulk</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">uaverage</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">zh</span><span class="p">(</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">zh</span><span class="p">(</span><span class="n">kb</span><span class="p">))</span> <span class="c">! volume-averaged u-velocity</span>
<a name="ln-979"></a>               <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Modstartup: ubulk=&#39;</span><span class="p">,</span> <span class="n">ubulk</span>
<a name="ln-980"></a>               <span class="n">Utav</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="n">um</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-981"></a>               <span class="n">Uinl</span> <span class="o">=</span> <span class="n">um</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="c">! set the initial time-averaged inlet profile equal to um</span>
<a name="ln-982"></a>               <span class="n">Urec</span> <span class="o">=</span> <span class="n">um</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="c">! set the initial time-averaged inlet profile equal to um</span>
<a name="ln-983"></a>               <span class="n">Wrec</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">wm</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c">! set the initial time-averaged inlet profile equal to mean w-profile</span>
<a name="ln-984"></a>               <span class="n">u0inletbcold</span><span class="p">(</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="n">um</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-985"></a>               <span class="n">v0inletbcold</span><span class="p">(</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="n">vm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-986"></a>               <span class="n">w0inletbcold</span><span class="p">(</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">wm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-987"></a>               <span class="n">uminletbc</span><span class="p">(</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="n">um</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-988"></a>               <span class="n">vminletbc</span><span class="p">(</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="n">vm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-989"></a>               <span class="n">wminletbc</span><span class="p">(</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="n">wm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-990"></a>               <span class="n">u0inletbc</span><span class="p">(</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="n">um</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-991"></a>               <span class="n">v0inletbc</span><span class="p">(</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="n">vm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-992"></a>               <span class="n">w0inletbc</span><span class="p">(</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">wm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-993"></a>               <span class="n">utaui</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numol</span><span class="o">*</span><span class="n">Uinl</span><span class="p">(</span><span class="n">kb</span><span class="p">)</span><span class="o">/</span><span class="n">dzf</span><span class="p">(</span><span class="n">kb</span><span class="p">)))</span> <span class="c">! average streamwise friction at inlet (need for first time step)</span>
<a name="ln-994"></a>
<a name="ln-995"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">ltempeq</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-996"></a><span class="k">                  </span><span class="n">Ttav</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="n">thlm</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="c">! set the initial time-averaged inlet profile equal to thlm</span>
<a name="ln-997"></a>                  <span class="n">Tinl</span> <span class="o">=</span> <span class="n">thlm</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="c">! set the initial time-averaged inlet profile equal to thlm</span>
<a name="ln-998"></a>                  <span class="n">Trec</span> <span class="o">=</span> <span class="n">thlm</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="c">! set the initial time-averaged inlet profile equal to thlm</span>
<a name="ln-999"></a>                  <span class="n">t0inletbcold</span><span class="p">(</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="n">thlm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-1000"></a>                  <span class="n">t0inletbc</span><span class="p">(</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="n">thl0</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-1001"></a>                  <span class="n">tminletbc</span><span class="p">(</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="n">thlm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-1002"></a>                  <span class="n">ttaui</span> <span class="o">=</span> <span class="n">numol</span><span class="o">*</span><span class="n">prandtlmoli</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="n">Tinl</span><span class="p">(</span><span class="n">kb</span><span class="p">)</span> <span class="o">-</span> <span class="n">thls</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">dzf</span><span class="p">(</span><span class="n">kb</span><span class="p">)</span><span class="o">*</span><span class="n">utaui</span><span class="p">)</span> <span class="c">! average friction temp. at inlet (need for first time step)</span>
<a name="ln-1003"></a>               <span class="k">end if</span>
<a name="ln-1004"></a>
<a name="ln-1005"></a>               <span class="c">! add random perturbations</span>
<a name="ln-1006"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">myid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1007"></a><span class="k">                  call </span><span class="nb">random_number</span><span class="p">(</span><span class="n">ran</span><span class="p">)</span>
<a name="ln-1008"></a>                  <span class="n">ran1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">ran</span>
<a name="ln-1009"></a>                  <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;random=&#39;</span><span class="p">,</span> <span class="n">ran</span><span class="p">,</span> <span class="n">ran1</span>
<a name="ln-1010"></a>                  <span class="k">call </span><span class="nb">random_number</span><span class="p">(</span><span class="n">ran</span><span class="p">)</span>
<a name="ln-1011"></a>                  <span class="n">ran1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">ran</span>
<a name="ln-1012"></a>                  <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;random=&#39;</span><span class="p">,</span> <span class="n">ran</span><span class="p">,</span> <span class="n">ran1</span>
<a name="ln-1013"></a>                  <span class="k">call </span><span class="nb">random_number</span><span class="p">(</span><span class="n">ran</span><span class="p">)</span>
<a name="ln-1014"></a>                  <span class="n">ran1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">ran</span>
<a name="ln-1015"></a>                  <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;random=&#39;</span><span class="p">,</span> <span class="n">ran</span><span class="p">,</span> <span class="n">ran1</span>
<a name="ln-1016"></a>                  <span class="k">call </span><span class="nb">random_number</span><span class="p">(</span><span class="n">ran</span><span class="p">)</span>
<a name="ln-1017"></a>                  <span class="n">ran1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">ran</span>
<a name="ln-1018"></a>                  <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;random=&#39;</span><span class="p">,</span> <span class="n">ran</span><span class="p">,</span> <span class="n">ran1</span>
<a name="ln-1019"></a>                  <span class="k">call </span><span class="nb">random_number</span><span class="p">(</span><span class="n">ran</span><span class="p">)</span>
<a name="ln-1020"></a>                  <span class="n">ran1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">ran</span>
<a name="ln-1021"></a>                  <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;random=&#39;</span><span class="p">,</span> <span class="n">ran</span><span class="p">,</span> <span class="n">ran1</span>
<a name="ln-1022"></a>                  <span class="k">call </span><span class="nb">random_number</span><span class="p">(</span><span class="n">ran</span><span class="p">)</span>
<a name="ln-1023"></a>                  <span class="n">ran1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">ran</span>
<a name="ln-1024"></a>                  <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;random=&#39;</span><span class="p">,</span> <span class="n">ran</span><span class="p">,</span> <span class="n">ran1</span>
<a name="ln-1025"></a>               <span class="k">end if</span>
<a name="ln-1026"></a>
<a name="ln-1027"></a><span class="k">               do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">48</span>
<a name="ln-1028"></a>               <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span>
<a name="ln-1029"></a>               <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-1030"></a>                  <span class="k">call </span><span class="nb">random_number</span><span class="p">(</span><span class="n">ran</span><span class="p">)</span>
<a name="ln-1031"></a>                  <span class="n">ran1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">ran</span>
<a name="ln-1032"></a>                  <span class="n">wm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">wm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">Uinf</span><span class="o">*</span><span class="n">ran1</span>
<a name="ln-1033"></a>               <span class="k">end do</span>
<a name="ln-1034"></a><span class="k">               end do</span>
<a name="ln-1035"></a><span class="k">               end do</span>
<a name="ln-1036"></a>
<a name="ln-1037"></a>               <span class="c">!       do k=kb+1,ke-1</span>
<a name="ln-1038"></a>               <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">48</span>
<a name="ln-1039"></a>               <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span>
<a name="ln-1040"></a>               <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ie</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-1041"></a>                  <span class="k">call </span><span class="nb">random_number</span><span class="p">(</span><span class="n">ran</span><span class="p">)</span>
<a name="ln-1042"></a>                  <span class="n">ran1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">ran</span>
<a name="ln-1043"></a>                  <span class="n">um</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">um</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">Uinf</span><span class="o">*</span><span class="n">ran1</span>
<a name="ln-1044"></a>               <span class="k">end do</span>
<a name="ln-1045"></a><span class="k">               end do</span>
<a name="ln-1046"></a><span class="k">               end do</span>
<a name="ln-1047"></a>
<a name="ln-1048"></a>               <span class="c">!       do k=kb+1,ke-1</span>
<a name="ln-1049"></a>               <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">48</span>
<a name="ln-1050"></a>               <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span>
<a name="ln-1051"></a>               <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-1052"></a>                  <span class="k">call </span><span class="nb">random_number</span><span class="p">(</span><span class="n">ran</span><span class="p">)</span>
<a name="ln-1053"></a>                  <span class="n">ran1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">ran</span>
<a name="ln-1054"></a>                  <span class="n">vm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">vm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">Uinf</span><span class="o">*</span><span class="n">ran1</span>
<a name="ln-1055"></a>               <span class="k">end do</span>
<a name="ln-1056"></a><span class="k">               end do</span>
<a name="ln-1057"></a><span class="k">               end do</span>
<a name="ln-1058"></a>
<a name="ln-1059"></a><span class="k">               </span><span class="n">u0</span> <span class="o">=</span> <span class="n">um</span>
<a name="ln-1060"></a>               <span class="n">v0</span> <span class="o">=</span> <span class="n">vm</span>
<a name="ln-1061"></a>               <span class="n">w0</span> <span class="o">=</span> <span class="n">wm</span>
<a name="ln-1062"></a>
<a name="ln-1063"></a>            <span class="k">else if</span> <span class="p">(</span><span class="n">iinletgen</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1064"></a>
<a name="ln-1065"></a><span class="k">               </span><span class="n">nfile</span> <span class="o">=</span> <span class="n">nfile</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1066"></a>               <span class="k">call </span><span class="n">readinletfile</span>
<a name="ln-1067"></a>               <span class="n">u0inletbc</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">storeu0inletbc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">nstepread</span><span class="p">)</span>
<a name="ln-1068"></a>               <span class="n">v0inletbc</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">storev0inletbc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">nstepread</span><span class="p">)</span>
<a name="ln-1069"></a>               <span class="n">w0inletbc</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">storew0inletbc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">nstepread</span><span class="p">)</span>
<a name="ln-1070"></a>               <span class="n">uminletbc</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">storeu0inletbc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">nstepread</span><span class="p">)</span>
<a name="ln-1071"></a>               <span class="n">vminletbc</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">storev0inletbc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">nstepread</span><span class="p">)</span>
<a name="ln-1072"></a>               <span class="n">wminletbc</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">storew0inletbc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">nstepread</span><span class="p">)</span>
<a name="ln-1073"></a>               <span class="c">! determine bulk velocity</span>
<a name="ln-1074"></a>               <span class="k">call </span><span class="n">slabsum</span><span class="p">(</span><span class="n">uaverage</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">,</span> <span class="n">u0</span><span class="p">,</span> <span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1075"></a>               <span class="n">uaverage</span> <span class="o">=</span> <span class="n">uaverage</span><span class="o">/</span><span class="p">((</span><span class="n">ie</span> <span class="o">-</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">jge</span> <span class="o">-</span> <span class="n">jgb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="c">! this gives the i-j-averaged velocity (only correct for equidistant grid?)</span>
<a name="ln-1076"></a>               <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-1077"></a>                  <span class="n">uaverage</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">uaverage</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dzf</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1078"></a>               <span class="k">end do</span>
<a name="ln-1079"></a><span class="k">               </span><span class="n">ubulk</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">uaverage</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">zh</span><span class="p">(</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">zh</span><span class="p">(</span><span class="n">kb</span><span class="p">))</span> <span class="c">! volume-averaged u-velocity</span>
<a name="ln-1080"></a>               <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Modstartup: ubulk=&#39;</span><span class="p">,</span> <span class="n">ubulk</span>
<a name="ln-1081"></a>            <span class="n">elseif</span> <span class="p">(</span><span class="n">idriver</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span> <span class="k">then</span> <span class="c">! idriver</span>
<a name="ln-1082"></a>
<a name="ln-1083"></a>               <span class="k">call </span><span class="n">readdriverfile</span>
<a name="ln-1084"></a>
<a name="ln-1085"></a>               <span class="c">! if(myid==0) then</span>
<a name="ln-1086"></a>                 <span class="c">! write(*,*) &#39;Driver inlet velocity&#39;</span>
<a name="ln-1087"></a>                 <span class="c">! do n=1,driverstore</span>
<a name="ln-1088"></a>                   <span class="c">! write (*,&#39;(f9.2,e20.12)&#39;) storetdriver(n),     storeu0driver(1,32,n)</span>
<a name="ln-1089"></a>                 <span class="c">! end do</span>
<a name="ln-1090"></a>               <span class="c">! endif</span>
<a name="ln-1091"></a>
<a name="ln-1092"></a>              <span class="c">! call slabsum(uaverage,kb,ke,u0,ib-1,ie+1,jb-1,je+1,kb-1,ke+1,ib,ie,jb,je,kb,ke)</span>
<a name="ln-1093"></a>              <span class="c">! uaverage = uaverage / ((ie-ib+1)*(jge-jgb+1))  ! this gives the i-j-averaged velocity (only correct for equidistant grid?)</span>
<a name="ln-1094"></a>
<a name="ln-1095"></a>              <span class="k">call </span><span class="n">avexy_ibm</span><span class="p">(</span><span class="n">uaverage</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span><span class="n">u0</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span><span class="n">ib</span><span class="p">,</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">,</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">,</span><span class="n">ke</span><span class="p">,</span><span class="n">ih</span><span class="p">,</span><span class="n">jh</span><span class="p">,</span><span class="n">kh</span><span class="p">,</span><span class="n">IIu</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span><span class="n">IIus</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),.</span><span class="n">false</span><span class="p">.)</span>
<a name="ln-1096"></a>              <span class="k">do </span><span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span><span class="n">ke</span>
<a name="ln-1097"></a>                <span class="n">uaverage</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">uaverage</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dzf</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1098"></a>              <span class="k">end do</span>
<a name="ln-1099"></a><span class="k">              </span><span class="n">ubulk</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">uaverage</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">zh</span><span class="p">(</span><span class="n">ke</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">zh</span><span class="p">(</span><span class="n">kb</span><span class="p">))</span> <span class="c">!volume-averaged u-velocity</span>
<a name="ln-1100"></a>
<a name="ln-1101"></a>              <span class="k">if</span> <span class="p">(</span><span class="n">myid</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1102"></a><span class="k">                 write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Modstartup: ubulk=&#39;</span><span class="p">,</span><span class="n">ubulk</span>
<a name="ln-1103"></a>              <span class="k">end if</span>
<a name="ln-1104"></a>
<a name="ln-1105"></a><span class="k">            </span><span class="n">elseif</span> <span class="p">(</span><span class="n">idriver</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1106"></a>
<a name="ln-1107"></a><span class="k">              call </span><span class="n">drivergen</span>
<a name="ln-1108"></a>
<a name="ln-1109"></a>            <span class="k">end if</span>
<a name="ln-1110"></a>
<a name="ln-1111"></a>            <span class="c">!---------------------------------------------------------------</span>
<a name="ln-1112"></a>            <span class="c">!  1.2 randomnize fields</span>
<a name="ln-1113"></a>            <span class="c">!---------------------------------------------------------------</span>
<a name="ln-1114"></a>            <span class="c">!     if (iinletgen /= 2 .and. iinletgen /= 1) then</span>
<a name="ln-1115"></a>            <span class="c">!       write(6,*) &#39;randomnizing temperature!&#39;</span>
<a name="ln-1116"></a>            <span class="c">!       krand  = min(krand,ke)</span>
<a name="ln-1117"></a>            <span class="c">!        do k = kb,ke !edited tg3315 krand --&gt; ke</span>
<a name="ln-1118"></a>            <span class="c">!          call randomnize(thlm,k,randthl,irandom,ih,jh)</span>
<a name="ln-1119"></a>            <span class="c">!          call randomnize(thl0,k,randthl,irandom,ih,jh)</span>
<a name="ln-1120"></a>            <span class="c">!        end do</span>
<a name="ln-1121"></a>            <span class="c">!       end if</span>
<a name="ln-1122"></a>
<a name="ln-1123"></a>            <span class="n">svprof</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1124"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">myid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1125"></a><span class="k">               if</span> <span class="p">(</span><span class="n">nsv</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1126"></a><span class="k">                  open</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;scalar.inp.&#39;</span><span class="o">//</span><span class="n">cexpnr</span><span class="p">)</span>
<a name="ln-1127"></a>                  <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-1128"></a>                  <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-1129"></a>                  <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-1130"></a>                     <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1131"></a>                        <span class="n">height</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1132"></a>                        <span class="p">(</span><span class="n">svprof</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span><span class="p">)</span>
<a name="ln-1133"></a>                  <span class="k">end do</span>
<a name="ln-1134"></a><span class="k">                  open</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;scalar.inp.&#39;</span><span class="o">//</span><span class="n">cexpnr</span><span class="p">)</span>
<a name="ln-1135"></a>                  <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;height   sv(1) --------- sv(nsv) &#39;</span>
<a name="ln-1136"></a>                  <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">ke</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-1137"></a>                     <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1138"></a>                        <span class="n">height</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1139"></a>                        <span class="p">(</span><span class="n">svprof</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span><span class="p">)</span>
<a name="ln-1140"></a>                  <span class="k">end do</span>
<a name="ln-1141"></a>
<a name="ln-1142"></a><span class="k">               end if</span>
<a name="ln-1143"></a><span class="k">            end if</span> <span class="c">! end if myid==0</span>
<a name="ln-1144"></a>
<a name="ln-1145"></a>            <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">svprof</span><span class="p">,</span> <span class="p">(</span><span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span> <span class="o">-</span> <span class="p">(</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">))</span><span class="o">*</span><span class="n">nsv</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1146"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-1147"></a>               <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1148"></a>                  <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1149"></a>                     <span class="k">do </span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span>
<a name="ln-1150"></a>                        <span class="n">sv0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">=</span> <span class="n">svprof</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a name="ln-1151"></a>                        <span class="n">svm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">=</span> <span class="n">svprof</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a name="ln-1152"></a>                     <span class="k">end do</span>
<a name="ln-1153"></a><span class="k">                  end do</span>
<a name="ln-1154"></a><span class="k">               end do</span>
<a name="ln-1155"></a><span class="k">            end do</span>
<a name="ln-1156"></a><span class="k">          </span>
<a name="ln-1157"></a><span class="k">            if</span> <span class="p">(</span><span class="n">nsv</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="c">!tg3315 set these variables here for now and repeat for warmstart</span>
<a name="ln-1158"></a>
<a name="ln-1159"></a>              <span class="k">allocate</span><span class="p">(</span><span class="n">sv_top</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsv</span><span class="p">))</span>
<a name="ln-1160"></a>              <span class="n">sv_top</span><span class="p">(:)</span> <span class="o">=</span> <span class="n">svprof</span><span class="p">(</span><span class="n">ke</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nsv</span><span class="p">)</span>
<a name="ln-1161"></a>
<a name="ln-1162"></a>              <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">sv_top</span><span class="p">,</span> <span class="n">nsv</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1163"></a>
<a name="ln-1164"></a>              <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;svprof&#39;</span><span class="p">,</span> <span class="n">svprof</span>
<a name="ln-1165"></a>              <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;sv_top&#39;</span><span class="p">,</span> <span class="n">sv_top</span>
<a name="ln-1166"></a>
<a name="ln-1167"></a>            <span class="k">end if</span>
<a name="ln-1168"></a> 
<a name="ln-1169"></a>            <span class="c">!do n = 1,nsv</span>
<a name="ln-1170"></a>            <span class="c">!  do j = jb - jhc, je + jhc</span>
<a name="ln-1171"></a>            <span class="c">!    do i = ib - ihc, ie + ihc</span>
<a name="ln-1172"></a>            <span class="c">!      svm(i, j, ke + 1, n) = svm(i, j, ke)</span>
<a name="ln-1173"></a>            <span class="c">!      sv0(i, j, kb - 1, n) = sv0(i, j, kb)</span>
<a name="ln-1174"></a>            <span class="c">!    end do</span>
<a name="ln-1175"></a>            <span class="c">!  end do</span>
<a name="ln-1176"></a>            <span class="c">!end do</span>
<a name="ln-1177"></a>
<a name="ln-1178"></a>            <span class="c">!-----------------------------------------------------------------</span>
<a name="ln-1179"></a>            <span class="c">!    2.2 Initialize surface layer</span>
<a name="ln-1180"></a>            <span class="c">!-----------------------------------------------------------------</span>
<a name="ln-1181"></a>
<a name="ln-1182"></a>         <span class="c">!ILS13 reintroduced thv !tg3315 this part may wrong, could need to use</span>
<a name="ln-1183"></a>         <span class="k">call </span><span class="n">calc_halflev</span>
<a name="ln-1184"></a>         <span class="c">! exnf = (presf/pref0)**(rd/cp)  !exner functions not in restart files</span>
<a name="ln-1185"></a>         <span class="c">! anymore.. or at least not read</span>
<a name="ln-1186"></a>         <span class="c">! exnh = (presh/pref0)**(rd/cp)</span>
<a name="ln-1187"></a>
<a name="ln-1188"></a>            <span class="k">call </span><span class="n">boundary</span> <span class="c">! tg3315 17.10.17 having this in startup was causing issues for running with lmoist ! turned of when pot. temp = temp.</span>
<a name="ln-1189"></a>            <span class="k">call </span><span class="n">thermodynamics</span> <span class="c">! turned off when pot. temp = temp.</span>
<a name="ln-1190"></a>
<a name="ln-1191"></a>            <span class="k">call </span><span class="n">boundary</span>
<a name="ln-1192"></a>            <span class="k">call </span><span class="n">thermodynamics</span> <span class="c">! turned off when pot. temp = temp.</span>
<a name="ln-1193"></a>
<a name="ln-1194"></a>         <span class="k">else</span> <span class="c">!if lwarmstart</span>
<a name="ln-1195"></a>            <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s2">&quot;doing warmstart&quot;</span>
<a name="ln-1196"></a>            <span class="k">call </span><span class="n">readrestartfiles</span>
<a name="ln-1197"></a>
<a name="ln-1198"></a>            <span class="n">um</span> <span class="o">=</span> <span class="n">u0</span>
<a name="ln-1199"></a>            <span class="n">vm</span> <span class="o">=</span> <span class="n">v0</span>
<a name="ln-1200"></a>            <span class="n">wm</span> <span class="o">=</span> <span class="n">w0</span>
<a name="ln-1201"></a>            <span class="n">thlm</span> <span class="o">=</span> <span class="n">thl0</span>
<a name="ln-1202"></a>            <span class="n">qtm</span> <span class="o">=</span> <span class="n">qt0</span>
<a name="ln-1203"></a>            <span class="n">svm</span> <span class="o">=</span> <span class="n">sv0</span>
<a name="ln-1204"></a>            <span class="n">e12m</span> <span class="o">=</span> <span class="n">e120</span>
<a name="ln-1205"></a>            <span class="n">ekm</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">numol</span>
<a name="ln-1206"></a>            <span class="n">ekh</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">numol</span><span class="o">*</span><span class="n">prandtlmoli</span> <span class="c">!tg3315 added because wttop using ekh in modboundary which is called in startup</span>
<a name="ln-1207"></a>
<a name="ln-1208"></a>            <span class="n">ekh</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ekh</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">ke</span><span class="p">)</span> <span class="c">! also for start up</span>
<a name="ln-1209"></a>
<a name="ln-1210"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">idriver</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>                                                                   
<a name="ln-1211"></a>              <span class="c">!driverstore = (timeleft - tdriverstart)/dtdriver + 1</span>
<a name="ln-1212"></a>              <span class="c">!if(myid==0) then</span>
<a name="ln-1213"></a>              <span class="c">!  write(*,*) &#39;driverstore: &#39;, driverstore</span>
<a name="ln-1214"></a>              <span class="c">!end if</span>
<a name="ln-1215"></a>              <span class="k">call </span><span class="n">drivergen</span>
<a name="ln-1216"></a>              <span class="n">tdriverdump</span> <span class="o">=</span> <span class="n">tdriverstart</span>
<a name="ln-1217"></a>            <span class="n">endif</span>
<a name="ln-1218"></a>
<a name="ln-1219"></a>            <span class="c">!ILS13 reintroduced thv</span>
<a name="ln-1220"></a>            <span class="k">call </span><span class="n">calc_halflev</span>
<a name="ln-1221"></a>            <span class="c">! exnf = (presf/pref0)**(rd/cp)  !exner functions not in restart files</span>
<a name="ln-1222"></a>            <span class="c">! anymore.. or at least not read</span>
<a name="ln-1223"></a>            <span class="c">! exnh = (presh/pref0)**(rd/cp)</span>
<a name="ln-1224"></a>
<a name="ln-1225"></a>            <span class="c">!   write(*,*) &quot;exnf&quot;,enf</span>
<a name="ln-1226"></a>            <span class="c">!   write(*,*) &quot;exnh&quot;,exnh</span>
<a name="ln-1227"></a>
<a name="ln-1228"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span>
<a name="ln-1229"></a>            <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ie</span>
<a name="ln-1230"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span>
<a name="ln-1231"></a>               <span class="c">!write(*,*) &quot;thl0h&quot;,thl0h(i,j,k)</span>
<a name="ln-1232"></a>               <span class="n">thv0h</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">thl0h</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">rlv</span><span class="o">*</span><span class="n">ql0h</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">cp</span><span class="p">))</span> <span class="p">&amp;</span>
<a name="ln-1233"></a>                                <span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">rv</span><span class="o">/</span><span class="n">rd</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">qt0h</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">rv</span><span class="o">/</span><span class="n">rd</span><span class="o">*</span><span class="n">ql0h</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-1234"></a>            <span class="k">end do</span>
<a name="ln-1235"></a><span class="k">            end do</span>
<a name="ln-1236"></a><span class="k">            end do</span>
<a name="ln-1237"></a>
<a name="ln-1238"></a><span class="k">            do </span><span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="p">,</span> <span class="n">je</span>
<a name="ln-1239"></a>            <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ie</span>
<a name="ln-1240"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span>
<a name="ln-1241"></a>               <span class="n">thv0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">thl0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">rlv</span><span class="o">*</span><span class="n">ql0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">cp</span><span class="p">))</span> <span class="p">&amp;</span>
<a name="ln-1242"></a>                               <span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">rv</span><span class="o">/</span><span class="n">rd</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">qt0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">rv</span><span class="o">/</span><span class="n">rd</span><span class="o">*</span><span class="n">ql0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-1243"></a>            <span class="k">end do</span>
<a name="ln-1244"></a><span class="k">            end do</span>
<a name="ln-1245"></a><span class="k">            end do</span>
<a name="ln-1246"></a>
<a name="ln-1247"></a><span class="k">            </span><span class="n">thvh</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1248"></a>            <span class="c">! call slabsum(thvh,kb,ke,thv0h,ib-ih,ie+ih,jb-jh,je+jh,kb-kh,ke+kh,ib,ie,jb,je,kb,ke) ! redefine halflevel thv using calculated thv</span>
<a name="ln-1249"></a>            <span class="k">call </span><span class="n">avexy_ibm</span><span class="p">(</span><span class="n">thvh</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">thv0h</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">ib</span><span class="p">,</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">,</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">,</span><span class="n">ke</span><span class="p">,</span><span class="n">ih</span><span class="p">,</span><span class="n">jh</span><span class="p">,</span><span class="n">kh</span><span class="p">,</span><span class="n">IIw</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">IIws</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),.</span><span class="n">false</span><span class="p">.)</span>
<a name="ln-1250"></a>            <span class="c">! thvh = thvh/rslabs</span>
<a name="ln-1251"></a>
<a name="ln-1252"></a>            <span class="n">thvf</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-1253"></a>            <span class="k">call </span><span class="n">avexy_ibm</span><span class="p">(</span><span class="n">thvf</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">thv0</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">ib</span><span class="p">,</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">,</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">,</span><span class="n">ke</span><span class="p">,</span><span class="n">ih</span><span class="p">,</span><span class="n">jh</span><span class="p">,</span><span class="n">kh</span><span class="p">,</span><span class="n">IIc</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">IIcs</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),.</span><span class="n">false</span><span class="p">.)</span>
<a name="ln-1254"></a>            <span class="c">! call slabsum(thvf,kb,ke,thv0,ib-ih,ie+ih,jb-jh,je+jh,kb-kh,ke+kh,ib,ie,jb,je,kb,ke)</span>
<a name="ln-1255"></a>            <span class="c">! thvf = thvf/rslabs</span>
<a name="ln-1256"></a>
<a name="ln-1257"></a>            <span class="c">! Set average inlet profile to initial inlet profile in case of inletgenerator mode</span>
<a name="ln-1258"></a>            <span class="n">uaverage</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1259"></a>            <span class="n">uaveragei</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1260"></a>            <span class="n">uaverager</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1261"></a>            <span class="n">waverage</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1262"></a>            <span class="n">taveragei</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1263"></a>            <span class="n">taverager</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1264"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">iinletgen</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1265"></a><span class="k">               call </span><span class="n">slabsum</span><span class="p">(</span><span class="n">uaveragei</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">,</span> <span class="n">u0</span><span class="p">,</span> <span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ib</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1266"></a>               <span class="k">call </span><span class="n">slabsum</span><span class="p">(</span><span class="n">uaverager</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">,</span> <span class="n">u0</span><span class="p">,</span> <span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">irecy</span><span class="p">,</span> <span class="n">irecy</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1267"></a>               <span class="k">call </span><span class="n">slabsum</span><span class="p">(</span><span class="n">waverage</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-1268"></a>               <span class="k">call </span><span class="n">slabsum</span><span class="p">(</span><span class="n">uaverage</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">,</span> <span class="n">u0</span><span class="p">,</span> <span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1269"></a>               <span class="n">uaverage</span> <span class="o">=</span> <span class="n">uaverage</span><span class="o">/</span><span class="p">((</span><span class="n">ie</span> <span class="o">-</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">jge</span> <span class="o">-</span> <span class="n">jgb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="c">! this gives the i-j-averaged velocity (only correct for equidistant grid?)</span>
<a name="ln-1270"></a>               <span class="n">uaveragei</span> <span class="o">=</span> <span class="n">uaveragei</span><span class="o">/</span><span class="p">(</span><span class="n">jge</span> <span class="o">-</span> <span class="n">jgb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c">! this gives the j-averaged u-velocity at the inlet</span>
<a name="ln-1271"></a>               <span class="n">uaverager</span> <span class="o">=</span> <span class="n">uaverager</span><span class="o">/</span><span class="p">(</span><span class="n">jge</span> <span class="o">-</span> <span class="n">jgb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c">! this gives the j-averaged u-velocity at the recycle plane</span>
<a name="ln-1272"></a>               <span class="n">waverage</span> <span class="o">=</span> <span class="n">waverage</span><span class="o">/</span><span class="p">((</span><span class="n">ie</span> <span class="o">-</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">jge</span> <span class="o">-</span> <span class="n">jgb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="c">! this gives the i-j-averaged w-velocity (only correct for equidistant grid?)</span>
<a name="ln-1273"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">ltempeq</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1274"></a><span class="k">                  call </span><span class="n">slabsum</span><span class="p">(</span><span class="n">taveragei</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">,</span> <span class="n">thl0</span><span class="p">,</span> <span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1275"></a>                  <span class="k">call </span><span class="n">slabsum</span><span class="p">(</span><span class="n">taverager</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">,</span> <span class="n">thl0</span><span class="p">,</span> <span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">irecy</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">irecy</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1276"></a>                  <span class="n">taveragei</span> <span class="o">=</span> <span class="n">taveragei</span><span class="o">/</span><span class="p">((</span><span class="n">ie</span> <span class="o">-</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">jge</span> <span class="o">-</span> <span class="n">jgb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="c">! this gives the j-averaged temperature at the inlet</span>
<a name="ln-1277"></a>                  <span class="n">taverager</span> <span class="o">=</span> <span class="n">taverager</span><span class="o">/</span><span class="p">(</span><span class="n">jge</span> <span class="o">-</span> <span class="n">jgb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c">! this gives the j-averaged temperature at the recycle plane</span>
<a name="ln-1278"></a>               <span class="k">end if</span>
<a name="ln-1279"></a><span class="k">               if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">lreadminl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1280"></a><span class="k">                  if</span> <span class="p">(</span><span class="n">myid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1281"></a><span class="k">                     write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;uaverage(kb)=&#39;</span><span class="p">,</span> <span class="n">uaverage</span><span class="p">(</span><span class="n">kb</span><span class="p">)</span>
<a name="ln-1282"></a>                     <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;uaverage(ke)=&#39;</span><span class="p">,</span> <span class="n">uaverage</span><span class="p">(</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-1283"></a>                     <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;waverage(ke)=&#39;</span><span class="p">,</span> <span class="n">waverage</span><span class="p">(</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-1284"></a>                     <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;waverage(ke-20)=&#39;</span><span class="p">,</span> <span class="n">waverage</span><span class="p">(</span><span class="n">ke</span> <span class="o">-</span> <span class="mi">20</span><span class="p">)</span>
<a name="ln-1285"></a>                     <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;taveragei(kb)=&#39;</span><span class="p">,</span> <span class="n">taveragei</span><span class="p">(</span><span class="n">kb</span><span class="p">)</span>
<a name="ln-1286"></a>                     <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;taveragei(ke)=&#39;</span><span class="p">,</span> <span class="n">taveragei</span><span class="p">(</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-1287"></a>                  <span class="k">end if</span>
<a name="ln-1288"></a>
<a name="ln-1289"></a><span class="k">                  </span><span class="n">Utav</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1290"></a>                  <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ie</span>
<a name="ln-1291"></a>                     <span class="n">Utav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">uaverage</span>
<a name="ln-1292"></a>                  <span class="k">end do</span>
<a name="ln-1293"></a>
<a name="ln-1294"></a><span class="k">                  </span><span class="n">Uinl</span> <span class="o">=</span> <span class="n">uaverage</span> <span class="c">! set the initial time-averaged inlet profile equal to mean u-profile read from means</span>
<a name="ln-1295"></a>                  <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Uinl(kb+10)=&#39;</span><span class="p">,</span> <span class="n">Uinl</span><span class="p">(</span><span class="n">kb</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
<a name="ln-1296"></a>                  <span class="n">utaui</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numol</span><span class="o">*</span><span class="n">Uinl</span><span class="p">(</span><span class="n">kb</span><span class="p">)</span><span class="o">/</span><span class="n">dzf</span><span class="p">(</span><span class="n">kb</span><span class="p">)))</span> <span class="c">! average streamwise friction at inlet (need for first time step)</span>
<a name="ln-1297"></a>                  <span class="n">Urec</span> <span class="o">=</span> <span class="n">uaverage</span> <span class="c">! set the initial time-averaged inlet profile equal to mean u-profile</span>
<a name="ln-1298"></a>
<a name="ln-1299"></a>                  <span class="n">Wrec</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">waverage</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c">! set the initial time-averaged inlet profile equal to mean w-profile</span>
<a name="ln-1300"></a>                  <span class="n">Wrec</span><span class="p">(</span><span class="n">kb</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.</span> <span class="c">! set the initial time-averaged inlet profile equal to zero</span>
<a name="ln-1301"></a>                  <span class="k">if</span> <span class="p">(</span><span class="n">ltempeq</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1302"></a><span class="k">                     </span><span class="n">Ttav</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1303"></a>                     <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ie</span>
<a name="ln-1304"></a>                        <span class="n">Ttav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">taveragei</span><span class="p">(:)</span>
<a name="ln-1305"></a>                     <span class="k">end do</span>
<a name="ln-1306"></a><span class="k">                     </span><span class="n">Tinl</span> <span class="o">=</span> <span class="n">taveragei</span>
<a name="ln-1307"></a>                     <span class="n">Trec</span> <span class="o">=</span> <span class="n">taveragei</span>
<a name="ln-1308"></a>                     <span class="n">ttaui</span> <span class="o">=</span> <span class="n">numol</span><span class="o">*</span><span class="n">prandtlmoli</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="n">Tinl</span><span class="p">(</span><span class="n">kb</span><span class="p">)</span> <span class="o">-</span> <span class="n">thls</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">dzf</span><span class="p">(</span><span class="n">kb</span><span class="p">)</span><span class="o">*</span><span class="n">utaui</span><span class="p">)</span> <span class="c">! friction temp. at inlet (need at first time step)</span>
<a name="ln-1309"></a>                  <span class="k">end if</span>
<a name="ln-1310"></a><span class="k">               else</span> <span class="c">! -&gt; lreadminl -&gt; Uinl, Urec, Wrec already read</span>
<a name="ln-1311"></a>                  <span class="k">call </span><span class="n">slabsum</span><span class="p">(</span><span class="n">uaverage</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">,</span> <span class="n">u0</span><span class="p">,</span> <span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1312"></a>                  <span class="n">uaverage</span> <span class="o">=</span> <span class="n">uaverage</span><span class="o">/</span><span class="p">((</span><span class="n">ie</span> <span class="o">-</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">jge</span> <span class="o">-</span> <span class="n">jgb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="c">! this gives the i-j-averaged velocity (only correct for equidistant grid?)</span>
<a name="ln-1313"></a>               <span class="k">end if</span>
<a name="ln-1314"></a>
<a name="ln-1315"></a>               <span class="c">! determine bulk velocity</span>
<a name="ln-1316"></a>               <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-1317"></a>                  <span class="n">uaverage</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">uaverage</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dzf</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1318"></a>               <span class="k">end do</span>
<a name="ln-1319"></a><span class="k">               </span><span class="n">ubulk</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">uaverage</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">zh</span><span class="p">(</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">zh</span><span class="p">(</span><span class="n">kb</span><span class="p">))</span> <span class="c">! volume-averaged u-velocity</span>
<a name="ln-1320"></a>               <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Modstartup: ubulk=&#39;</span><span class="p">,</span> <span class="n">ubulk</span>
<a name="ln-1321"></a>
<a name="ln-1322"></a>               <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-1323"></a>               <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span>
<a name="ln-1324"></a>                  <span class="n">uminletbc</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">um</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-1325"></a>                  <span class="n">vminletbc</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">vm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-1326"></a>                  <span class="n">u0inletbcold</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">um</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-1327"></a>                  <span class="n">v0inletbcold</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">vm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-1328"></a>                  <span class="n">u0inletbc</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">um</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-1329"></a>                  <span class="n">v0inletbc</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">vm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-1330"></a>               <span class="k">end do</span>
<a name="ln-1331"></a><span class="k">               end do</span>
<a name="ln-1332"></a>
<a name="ln-1333"></a><span class="k">               do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1334"></a>               <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span>
<a name="ln-1335"></a>                  <span class="n">wminletbc</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">wm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-1336"></a>                  <span class="n">w0inletbcold</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">wm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-1337"></a>                  <span class="n">w0inletbc</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">wm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-1338"></a>               <span class="k">end do</span>
<a name="ln-1339"></a><span class="k">               end do</span>
<a name="ln-1340"></a>
<a name="ln-1341"></a><span class="k">               if</span> <span class="p">(</span><span class="n">ltempeq</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1342"></a><span class="k">                  do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-1343"></a>                  <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span>
<a name="ln-1344"></a>                     <span class="n">tminletbc</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">thlm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-1345"></a>                     <span class="n">t0inletbcold</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">thlm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-1346"></a>                     <span class="n">t0inletbc</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">thlm</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-1347"></a>                  <span class="k">end do</span>
<a name="ln-1348"></a><span class="k">                  end do</span>
<a name="ln-1349"></a><span class="k">               end if</span>
<a name="ln-1350"></a>
<a name="ln-1351"></a><span class="k">               write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;uminletbc(jb,kb),um(ib,jb,kb)=&#39;</span><span class="p">,</span> <span class="n">uminletbc</span><span class="p">(</span><span class="n">jb</span><span class="p">,</span> <span class="n">kb</span><span class="p">),</span> <span class="n">um</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">kb</span><span class="p">)</span>
<a name="ln-1352"></a>               <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;uminletbc(jb+1,kb+10),um(ib,jb+1,kb+10)=&#39;</span><span class="p">,</span> <span class="n">uminletbc</span><span class="p">(</span><span class="n">jb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">10</span><span class="p">),</span> <span class="n">um</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">jb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
<a name="ln-1353"></a>               <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;uminletbc(je,kb+10),um(ib,je,kb+10)=&#39;</span><span class="p">,</span> <span class="n">uminletbc</span><span class="p">(</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">10</span><span class="p">),</span> <span class="n">um</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">je</span><span class="p">,</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
<a name="ln-1354"></a>
<a name="ln-1355"></a>            <span class="k">else if</span> <span class="p">(</span><span class="n">iinletgen</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1356"></a>
<a name="ln-1357"></a><span class="k">               </span><span class="n">nfile</span> <span class="o">=</span> <span class="n">nfile</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1358"></a>               <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Loading inletfile&#39;</span>
<a name="ln-1359"></a>               <span class="k">call </span><span class="n">readinletfile</span>
<a name="ln-1360"></a>               <span class="n">u0inletbc</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">storeu0inletbc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">nstepread</span><span class="p">)</span>
<a name="ln-1361"></a>               <span class="n">v0inletbc</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">storev0inletbc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">nstepread</span><span class="p">)</span>
<a name="ln-1362"></a>               <span class="n">w0inletbc</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">storew0inletbc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">nstepread</span><span class="p">)</span>
<a name="ln-1363"></a>               <span class="n">uminletbc</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">storeu0inletbc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">nstepread</span><span class="p">)</span>
<a name="ln-1364"></a>               <span class="n">vminletbc</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">storev0inletbc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">nstepread</span><span class="p">)</span>
<a name="ln-1365"></a>               <span class="n">wminletbc</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">storew0inletbc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">nstepread</span><span class="p">)</span>
<a name="ln-1366"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">ltempeq</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1367"></a><span class="k">                  </span><span class="n">t0inletbc</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">storet0inletbc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">nstepread</span><span class="p">)</span>
<a name="ln-1368"></a>                  <span class="n">tminletbc</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">storet0inletbc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">nstepread</span><span class="p">)</span>
<a name="ln-1369"></a>               <span class="k">end if</span>
<a name="ln-1370"></a>               <span class="c">! determine bulk velocity</span>
<a name="ln-1371"></a>               <span class="k">call </span><span class="n">slabsum</span><span class="p">(</span><span class="n">uaverage</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">,</span> <span class="n">u0</span><span class="p">,</span> <span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1372"></a>               <span class="n">uaverage</span> <span class="o">=</span> <span class="n">uaverage</span><span class="o">/</span><span class="p">((</span><span class="n">ie</span> <span class="o">-</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">jge</span> <span class="o">-</span> <span class="n">jgb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="c">! this gives the i-j-averaged velocity (only correct for equidistant grid?)</span>
<a name="ln-1373"></a>               <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-1374"></a>                  <span class="n">uaverage</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">uaverage</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dzf</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1375"></a>               <span class="k">end do</span>
<a name="ln-1376"></a><span class="k">               </span><span class="n">ubulk</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">uaverage</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">zh</span><span class="p">(</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">zh</span><span class="p">(</span><span class="n">kb</span><span class="p">))</span> <span class="c">! volume-averaged u-velocity</span>
<a name="ln-1377"></a>               <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Modstartup: ubulk=&#39;</span><span class="p">,</span> <span class="n">ubulk</span>
<a name="ln-1378"></a>
<a name="ln-1379"></a>            <span class="n">elseif</span> <span class="p">(</span><span class="n">idriver</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span> <span class="k">then</span> <span class="c">! idriver</span>
<a name="ln-1380"></a>
<a name="ln-1381"></a>               <span class="k">call </span><span class="n">readdriverfile</span>
<a name="ln-1382"></a>               <span class="k">call </span><span class="n">drivergen</span>
<a name="ln-1383"></a>
<a name="ln-1384"></a>              <span class="c">!call slabsum(uaverage,kb,ke,u0,ib-1,ie+1,jb-1,je+1,kb-1,ke+1,ib,ie,jb,je,kb,ke)</span>
<a name="ln-1385"></a>              <span class="c">!uaverage = uaverage / ((ie-ib+1)*(jge-jgb+1))  ! this gives the i-j-averaged velocity (only correct for equidistant grid?)</span>
<a name="ln-1386"></a>              <span class="k">call </span><span class="n">avexy_ibm</span><span class="p">(</span><span class="n">uaverage</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span><span class="n">u0</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span><span class="n">ib</span><span class="p">,</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">,</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">,</span><span class="n">ke</span><span class="p">,</span><span class="n">ih</span><span class="p">,</span><span class="n">jh</span><span class="p">,</span><span class="n">kh</span><span class="p">,</span><span class="n">IIu</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span><span class="n">IIus</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),.</span><span class="n">false</span><span class="p">.)</span>
<a name="ln-1387"></a>              <span class="k">do </span><span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span><span class="n">ke</span>
<a name="ln-1388"></a>                <span class="n">uaverage</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">uaverage</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dzf</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1389"></a>              <span class="k">end do</span>
<a name="ln-1390"></a><span class="k">              </span><span class="n">ubulk</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">uaverage</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">zh</span><span class="p">(</span><span class="n">ke</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">zh</span><span class="p">(</span><span class="n">kb</span><span class="p">))</span> <span class="c">!volume-averaged u-velocity</span>
<a name="ln-1391"></a>              <span class="k">if</span> <span class="p">(</span><span class="n">myid</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1392"></a><span class="k">                 write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Modstartup: ubulk=&#39;</span><span class="p">,</span><span class="n">ubulk</span>
<a name="ln-1393"></a>              <span class="k">end if</span>
<a name="ln-1394"></a>
<a name="ln-1395"></a><span class="k">            end if</span> <span class="c">! iinletgen/idriver</span>
<a name="ln-1396"></a>
<a name="ln-1397"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">lper2inout</span><span class="p">)</span> <span class="k">then</span> <span class="c">! if the restart starts from a periodic simulation to in/outflow, lper2inout should be set to .true.</span>
<a name="ln-1398"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">myid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1399"></a><span class="k">                  write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;per2inout=.true. -&gt; reading inlet profile from prof.inp.XXX and scalar.inp.XXX&#39;</span>
<a name="ln-1400"></a>                  <span class="k">open</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;prof.inp.&#39;</span><span class="o">//</span><span class="n">cexpnr</span><span class="p">)</span> <span class="c">!  read the inlet profile from prof.inp</span>
<a name="ln-1401"></a>                  <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-1402"></a>                  <span class="k">write</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-1403"></a>                  <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-1404"></a>
<a name="ln-1405"></a>                  <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-1406"></a>                     <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1407"></a>                        <span class="n">height</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1408"></a>                        <span class="n">thlprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1409"></a>                        <span class="n">qtprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1410"></a>                        <span class="n">uprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1411"></a>                        <span class="n">vprof</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1412"></a>                        <span class="n">e12prof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1413"></a>                  <span class="k">end do</span>
<a name="ln-1414"></a><span class="k">                  </span><span class="n">svprof</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1415"></a>                  <span class="k">if</span> <span class="p">(</span><span class="n">nsv</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1416"></a><span class="k">                     open</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;scalar.inp.&#39;</span><span class="o">//</span><span class="n">cexpnr</span><span class="p">)</span>
<a name="ln-1417"></a>                     <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-1418"></a>                     <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-1419"></a>                     <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-1420"></a>                        <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1421"></a>                           <span class="n">height</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1422"></a>                           <span class="p">(</span><span class="n">svprof</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span><span class="p">)</span>
<a name="ln-1423"></a>                     <span class="k">end do</span>
<a name="ln-1424"></a><span class="k">                     open</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;scalar.inp.&#39;</span><span class="o">//</span><span class="n">cexpnr</span><span class="p">)</span>
<a name="ln-1425"></a>                     <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;height   sv(1) --------- sv(nsv) &#39;</span>
<a name="ln-1426"></a>                     <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">ke</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-1427"></a>                        <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1428"></a>                           <span class="n">height</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1429"></a>                           <span class="p">(</span><span class="n">svprof</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span><span class="p">)</span>
<a name="ln-1430"></a>                     <span class="k">end do</span>
<a name="ln-1431"></a>
<a name="ln-1432"></a><span class="k">                  end if</span>
<a name="ln-1433"></a><span class="k">               end if</span> <span class="c">! end if myid==0</span>
<a name="ln-1434"></a>
<a name="ln-1435"></a>               <span class="c">! MPI broadcast numbers reading</span>
<a name="ln-1436"></a>               <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">thlprof</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1437"></a>               <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">uprof</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1438"></a>               <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">vprof</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1439"></a>               <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">e12prof</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1440"></a>               <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">qtprof</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1441"></a>               <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">svprof</span><span class="p">,</span> <span class="p">(</span><span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span> <span class="o">-</span> <span class="p">(</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">))</span><span class="o">*</span><span class="n">nsv</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1442"></a>
<a name="ln-1443"></a>            <span class="k">else if</span> <span class="p">(</span><span class="n">linoutflow</span><span class="p">)</span> <span class="k">then</span> <span class="c">! restart of inoutflow simulation: reproduce inlet boundary condition from restartfile</span>
<a name="ln-1444"></a>               <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1445"></a>                  <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-1446"></a>                     <span class="n">uprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">u0</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-1447"></a>                     <span class="n">vprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">v0</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">v0</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span>
<a name="ln-1448"></a>                     <span class="n">thlprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">thl0</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">thl0</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span>
<a name="ln-1449"></a>                     <span class="n">qtprof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">qt0</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">qt0</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span>
<a name="ln-1450"></a>                     <span class="n">e12prof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">e120</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">e120</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span>
<a name="ln-1451"></a>                     <span class="k">do </span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span>
<a name="ln-1452"></a>                        <span class="n">svprof</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">sv0</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">sv0</span><span class="p">(</span><span class="n">ib</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span>
<a name="ln-1453"></a>                     <span class="n">enddo</span>
<a name="ln-1454"></a>                  <span class="n">enddo</span>
<a name="ln-1455"></a>               <span class="n">enddo</span>
<a name="ln-1456"></a>               <span class="c">! outlet bulk velocity</span>
<a name="ln-1457"></a>               <span class="k">call </span><span class="n">slabsum</span><span class="p">(</span><span class="n">uaverage</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">,</span> <span class="n">u0</span><span class="p">,</span> <span class="n">ib</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1458"></a>               <span class="n">uaverage</span> <span class="o">=</span> <span class="n">uaverage</span><span class="o">/</span><span class="p">((</span><span class="n">ie</span> <span class="o">-</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">jge</span> <span class="o">-</span> <span class="n">jgb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="c">! this gives the i-j-averaged velocity (only correct for equidistant grid?)</span>
<a name="ln-1459"></a>               <span class="c">! determine bulk velocity</span>
<a name="ln-1460"></a>               <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-1461"></a>                  <span class="n">uaverage</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">uaverage</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dzf</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1462"></a>               <span class="k">end do</span>
<a name="ln-1463"></a><span class="k">               </span><span class="n">ubulk</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">uaverage</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">zh</span><span class="p">(</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">zh</span><span class="p">(</span><span class="n">kb</span><span class="p">))</span> <span class="c">! volume-averaged u-velocity</span>
<a name="ln-1464"></a>               <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Modstartup: ubulk=&#39;</span><span class="p">,</span> <span class="n">ubulk</span>
<a name="ln-1465"></a>            <span class="k">else</span> <span class="c">! else per2per... read svprof regardless...</span>
<a name="ln-1466"></a>
<a name="ln-1467"></a>            <span class="c">! tg3315 read svprof (but do not use regardless of above...)</span>
<a name="ln-1468"></a>              <span class="n">svprof</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1469"></a>              <span class="k">if</span> <span class="p">(</span><span class="n">myid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1470"></a><span class="k">                 if</span> <span class="p">(</span><span class="n">nsv</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1471"></a><span class="k">                    open</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;scalar.inp.&#39;</span><span class="o">//</span><span class="n">cexpnr</span><span class="p">)</span>
<a name="ln-1472"></a>                    <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-1473"></a>                    <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-1474"></a>                    <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-1475"></a>                       <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1476"></a>                          <span class="n">height</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1477"></a>                          <span class="p">(</span><span class="n">svprof</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span><span class="p">)</span>
<a name="ln-1478"></a>                    <span class="k">end do</span>
<a name="ln-1479"></a><span class="k">                    open</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;scalar.inp.&#39;</span><span class="o">//</span><span class="n">cexpnr</span><span class="p">)</span>
<a name="ln-1480"></a>                    <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;height   sv(1) --------- sv(nsv) &#39;</span>
<a name="ln-1481"></a>                    <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">ke</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-1482"></a>                       <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1483"></a>                          <span class="n">height</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1484"></a>                          <span class="p">(</span><span class="n">svprof</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span><span class="p">)</span>
<a name="ln-1485"></a>                    <span class="k">end do</span>
<a name="ln-1486"></a>
<a name="ln-1487"></a><span class="k">                 end if</span>
<a name="ln-1488"></a><span class="k">              end if</span> <span class="c">! end if myid==0</span>
<a name="ln-1489"></a>
<a name="ln-1490"></a>              <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">svprof</span><span class="p">,</span> <span class="p">(</span><span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span> <span class="o">-</span> <span class="p">(</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">))</span><span class="o">*</span><span class="n">nsv</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1491"></a>          
<a name="ln-1492"></a>              <span class="k">if</span> <span class="p">(</span><span class="n">nsv</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="c">!tg3315 set these variables here for now and repeat for warmstart</span>
<a name="ln-1493"></a>
<a name="ln-1494"></a>                <span class="k">allocate</span><span class="p">(</span><span class="n">sv_top</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nsv</span><span class="p">))</span>
<a name="ln-1495"></a>                <span class="n">sv_top</span><span class="p">(:)</span> <span class="o">=</span> <span class="n">svprof</span><span class="p">(</span><span class="n">ke</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nsv</span><span class="p">)</span>
<a name="ln-1496"></a>
<a name="ln-1497"></a>                <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">sv_top</span><span class="p">,</span> <span class="n">nsv</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1498"></a>
<a name="ln-1499"></a>              <span class="k">end if</span>
<a name="ln-1500"></a>
<a name="ln-1501"></a><span class="k">            end if</span> <span class="c">! end if lper2inout</span>
<a name="ln-1502"></a>
<a name="ln-1503"></a>            <span class="n">u0av</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-1504"></a>            <span class="n">v0av</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-1505"></a>            <span class="n">thl0av</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-1506"></a>            <span class="n">qt0av</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-1507"></a>            <span class="n">th0av</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-1508"></a>            <span class="n">sv0av</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1509"></a>
<a name="ln-1510"></a>            <span class="c">! call slabsum(u0av  ,kb,ke+kh,u0(:,:,kb:ke+kh)  ,ib-ih,ie+ih,jb-jh,je+jh,kb,ke+kh,ib,ie,jb,je,kb,ke+kh)</span>
<a name="ln-1511"></a>            <span class="k">call </span><span class="n">avexy_ibm</span><span class="p">(</span><span class="n">u0av</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">u0</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">ib</span><span class="p">,</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">,</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">,</span><span class="n">ke</span><span class="p">,</span><span class="n">ih</span><span class="p">,</span><span class="n">jh</span><span class="p">,</span><span class="n">kh</span><span class="p">,</span><span class="n">IIu</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">IIus</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),.</span><span class="n">false</span><span class="p">.)</span>
<a name="ln-1512"></a>            <span class="c">! call slabsum(v0av  ,kb,ke+kh,v0(:,:,kb:ke+kh)  ,ib-ih,ie+ih,jb-jh,je+jh,kb,ke+kh,ib,ie,jb,je,kb,ke+kh)</span>
<a name="ln-1513"></a>            <span class="k">call </span><span class="n">avexy_ibm</span><span class="p">(</span><span class="n">v0av</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">v0</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">ib</span><span class="p">,</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">,</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">,</span><span class="n">ke</span><span class="p">,</span><span class="n">ih</span><span class="p">,</span><span class="n">jh</span><span class="p">,</span><span class="n">kh</span><span class="p">,</span><span class="n">IIv</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">IIvs</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),.</span><span class="n">false</span><span class="p">.)</span>
<a name="ln-1514"></a>            <span class="c">! call slabsum(thl0av,kb,ke+kh,thl0(:,:,kb:ke+kh),ib-ih,ie+ih,jb-jh,je+jh,kb,ke+kh,ib,ie,jb,je,kb,ke+kh)</span>
<a name="ln-1515"></a>            <span class="k">call </span><span class="n">avexy_ibm</span><span class="p">(</span><span class="n">thl0av</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">thl0</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">ib</span><span class="p">,</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">,</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">,</span><span class="n">ke</span><span class="p">,</span><span class="n">ih</span><span class="p">,</span><span class="n">jh</span><span class="p">,</span><span class="n">kh</span><span class="p">,</span><span class="n">IIc</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">IIcs</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),.</span><span class="n">false</span><span class="p">.)</span>
<a name="ln-1516"></a>            <span class="c">! call slabsum(qt0av,kb,ke+kh,qt0(:,:,kb:ke+kh),ib-ih,ie+ih,jb-jh,je+jh,kb,ke+kh,ib,ie,jb,je,kb,ke+kh)</span>
<a name="ln-1517"></a>            <span class="k">call </span><span class="n">avexy_ibm</span><span class="p">(</span><span class="n">qt0av</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">qt0</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">ib</span><span class="p">,</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">,</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">,</span><span class="n">ke</span><span class="p">,</span><span class="n">ih</span><span class="p">,</span><span class="n">jh</span><span class="p">,</span><span class="n">kh</span><span class="p">,</span><span class="n">IIc</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),</span><span class="n">IIcs</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">kh</span><span class="p">),.</span><span class="n">false</span><span class="p">.)</span>
<a name="ln-1518"></a>            <span class="k">do </span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span>
<a name="ln-1519"></a>               <span class="c">! call slabsum(sv0av(kb,n),kb,ke+kh,sv0(ib-ih,jb-jh,kb,n),ib-ih,ie+ih,jb-jh,je+jh,kb,ke+kh,ib,ie,jb,je,kb,ke+kh)</span>
<a name="ln-1520"></a>               <span class="k">call </span><span class="n">avexy_ibm</span><span class="p">(</span><span class="n">sv0av</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">khc</span><span class="p">,</span><span class="n">n</span><span class="p">),</span><span class="n">sv0</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">khc</span><span class="p">,</span><span class="n">n</span><span class="p">),</span><span class="n">ib</span><span class="p">,</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">,</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">,</span><span class="n">ke</span><span class="p">,</span><span class="n">ih</span><span class="p">,</span><span class="n">jh</span><span class="p">,</span><span class="n">kh</span><span class="p">,</span><span class="n">IIc</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">khc</span><span class="p">),</span><span class="n">IIcs</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="o">+</span><span class="n">khc</span><span class="p">),.</span><span class="n">false</span><span class="p">.)</span>
<a name="ln-1521"></a>            <span class="k">end do</span>
<a name="ln-1522"></a>
<a name="ln-1523"></a>            <span class="c">! CvH - only do this for fixed timestepping. In adaptive dt comes from restartfile</span>
<a name="ln-1524"></a>            <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">ladaptive</span><span class="p">)</span> <span class="n">dt</span> <span class="o">=</span> <span class="n">dtmax</span>
<a name="ln-1525"></a>            <span class="c">!  call boundary</span>
<a name="ln-1526"></a>         <span class="k">end if</span> <span class="c">! lwarmstart</span>
<a name="ln-1527"></a>      <span class="k">end if</span> <span class="c">! not lstratstart</span>
<a name="ln-1528"></a>      <span class="c">!-----------------------------------------------------------------</span>
<a name="ln-1529"></a>      <span class="c">!    2.1 read and initialise fields</span>
<a name="ln-1530"></a>      <span class="c">!-----------------------------------------------------------------</span>
<a name="ln-1531"></a>
<a name="ln-1532"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">myid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1533"></a><span class="k">         open</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;lscale.inp.&#39;</span><span class="o">//</span><span class="n">cexpnr</span><span class="p">)</span>
<a name="ln-1534"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-1535"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-1536"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39; height  u_geo  v_geo  pgx  pgy  subs     &#39;</span> <span class="p">&amp;</span>
<a name="ln-1537"></a>            <span class="p">,</span> <span class="s1">&#39;   dqtdx      dqtdy        dqtdtls     thl_rad &#39;</span>
<a name="ln-1538"></a>         <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-1539"></a>            <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1540"></a>               <span class="n">height</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1541"></a>               <span class="n">ug</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1542"></a>               <span class="n">vg</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1543"></a>               <span class="n">pgx</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1544"></a>               <span class="n">pgy</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1545"></a>               <span class="n">wfls</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1546"></a>               <span class="n">dqtdxls</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1547"></a>               <span class="n">dqtdyls</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1548"></a>               <span class="n">dqtdtls</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1549"></a>               <span class="n">thlpcar</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1550"></a>         <span class="k">end do</span>
<a name="ln-1551"></a><span class="k">         close</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span>
<a name="ln-1552"></a>
<a name="ln-1553"></a>         <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">ke</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
<a name="ln-1554"></a>            <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;(3f7.1,5e12.4)&#39;</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1555"></a>               <span class="n">height</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1556"></a>               <span class="n">ug</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1557"></a>               <span class="n">vg</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1558"></a>               <span class="n">pgx</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1559"></a>               <span class="n">pgy</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1560"></a>               <span class="n">wfls</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1561"></a>               <span class="n">dqtdxls</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1562"></a>               <span class="n">dqtdyls</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1563"></a>               <span class="n">dqtdtls</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1564"></a>               <span class="n">thlpcar</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1565"></a>         <span class="k">end do</span>
<a name="ln-1566"></a>
<a name="ln-1567"></a><span class="k">      end if</span> <span class="c">! end myid==0</span>
<a name="ln-1568"></a>
<a name="ln-1569"></a>      <span class="c">! MPI broadcast variables read in</span>
<a name="ln-1570"></a>
<a name="ln-1571"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">ug</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1572"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">vg</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1573"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">pgx</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1574"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">pgy</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1575"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">wfls</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1576"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dqtdxls</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1577"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dqtdyls</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1578"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">dqtdtls</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1579"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="n">thlpcar</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1580"></a>
<a name="ln-1581"></a>      <span class="c">!-----------------------------------------------------------------</span>
<a name="ln-1582"></a>      <span class="c">!    2.3 make large-scale horizontal pressure gradient</span>
<a name="ln-1583"></a>      <span class="c">!-----------------------------------------------------------------</span>
<a name="ln-1584"></a>
<a name="ln-1585"></a>      <span class="c">!******include rho if rho = rho(z) /= 1.0 ***********</span>
<a name="ln-1586"></a>
<a name="ln-1587"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">lprofforc</span><span class="p">)</span> <span class="k">then</span> <span class="c">!tg3315</span>
<a name="ln-1588"></a>         <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-1589"></a>            <span class="n">dpdxl</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">pgx</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">dpdx</span> <span class="c">!-om23_gs*ug(k)-pgx(k)-dpdx</span>
<a name="ln-1590"></a>            <span class="n">dpdyl</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">pgy</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1591"></a>         <span class="k">end do</span>
<a name="ln-1592"></a><span class="k">      else</span>
<a name="ln-1593"></a><span class="k">         do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-1594"></a>            <span class="c">!dpdxl(k) =  om23_gs*vg(k)</span>
<a name="ln-1595"></a>            <span class="c">!dpdyl(k) = -om23_gs*ug(k)</span>
<a name="ln-1596"></a>            <span class="c">!dpdxl(k) =  -ug(k)</span>
<a name="ln-1597"></a>            <span class="c">!dpdyl(k) =  -vg(k)</span>
<a name="ln-1598"></a>            <span class="n">dpdxl</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">om23_gs</span><span class="o">*</span><span class="n">vg</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">pgx</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">dpdx</span> <span class="c">!corriolis forcing and pressure gradient</span>
<a name="ln-1599"></a>            <span class="n">dpdyl</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">om23_gs</span><span class="o">*</span><span class="n">ug</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">pgy</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1600"></a>         <span class="k">end do</span>
<a name="ln-1601"></a><span class="k">      </span><span class="n">endif</span>
<a name="ln-1602"></a>
<a name="ln-1603"></a>      <span class="c">!-----------------------------------------------------------------</span>
<a name="ln-1604"></a>      <span class="c">!    2.4 large-scale subsidence, reintroduced ILS13 05.06.2014</span>
<a name="ln-1605"></a>      <span class="c">!-----------------------------------------------------------------</span>
<a name="ln-1606"></a>
<a name="ln-1607"></a>      <span class="n">whls</span><span class="p">(</span><span class="n">kb</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-1608"></a>      <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ke</span>
<a name="ln-1609"></a>         <span class="n">whls</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">wfls</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">dzf</span><span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">wfls</span><span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">dzf</span><span class="p">(</span><span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dzh</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
<a name="ln-1610"></a>      <span class="k">end do</span>
<a name="ln-1611"></a><span class="k">      </span><span class="n">whls</span><span class="p">(</span><span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">wfls</span><span class="p">(</span><span class="n">ke</span><span class="p">)</span> <span class="o">+</span> <span class="n">dzf</span><span class="p">(</span><span class="n">ke</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">wfls</span><span class="p">(</span><span class="n">ke</span><span class="p">)</span> <span class="o">-</span> <span class="n">wfls</span><span class="p">(</span><span class="n">ke</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="n">dzh</span><span class="p">(</span><span class="n">ke</span><span class="p">))</span> <span class="c">! tg3315 31/07/18 removed a 0.5</span>
<a name="ln-1612"></a>
<a name="ln-1613"></a>      <span class="c">!    idtmax = floor(dtmax/tres)</span>
<a name="ln-1614"></a>      <span class="n">btime</span> <span class="o">=</span> <span class="n">timee</span>
<a name="ln-1615"></a>      <span class="c">!    timeleft=ceiling(runtime/tres)</span>
<a name="ln-1616"></a>      <span class="n">timeleft</span> <span class="o">=</span> <span class="n">runtime</span>
<a name="ln-1617"></a>      <span class="n">dt_lim</span> <span class="o">=</span> <span class="n">timeleft</span>
<a name="ln-1618"></a>      <span class="c">!    write(6,*) &#39;real(dt)*tres= &#39;,rdt, &#39; dtmax/100= &#39;,dtmax/100</span>
<a name="ln-1619"></a>      <span class="k">if</span> <span class="p">((</span><span class="n">lwarmstart</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">lstratstart</span><span class="p">))</span> <span class="k">then</span> <span class="c">! tg3315 to have cumulative number on restart files</span>
<a name="ln-1620"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">startfile</span><span class="p">(</span><span class="mi">6</span><span class="p">:</span><span class="mi">13</span><span class="p">),</span> <span class="s1">&#39;(i4)&#39;</span><span class="p">)</span> <span class="n">ntrun</span>
<a name="ln-1621"></a>         <span class="c">! ntrun = ichar(startfile(6:13))</span>
<a name="ln-1622"></a>      <span class="k">else</span>
<a name="ln-1623"></a><span class="k">         </span><span class="n">ntrun</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1624"></a>      <span class="k">end if</span>
<a name="ln-1625"></a><span class="k">      </span><span class="n">ntimee</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span><span class="n">timee</span><span class="o">/</span><span class="n">dtmax</span><span class="p">)</span>
<a name="ln-1626"></a>      <span class="n">tnextrestart</span> <span class="o">=</span> <span class="n">btime</span> <span class="o">+</span> <span class="n">trestart</span>
<a name="ln-1627"></a>      <span class="n">tnextfielddump</span> <span class="o">=</span> <span class="n">btime</span> <span class="o">+</span> <span class="n">tfielddump</span>
<a name="ln-1628"></a>      <span class="k">deallocate</span> <span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">th0av</span><span class="p">)</span>
<a name="ln-1629"></a>
<a name="ln-1630"></a>      <span class="c">!    call boundary</span>
<a name="ln-1631"></a>
<a name="ln-1632"></a>   <span class="k">end subroutine </span><span class="n">readinitfiles</span>
<a name="ln-1633"></a>
<a name="ln-1634"></a>   <span class="k">subroutine </span><span class="n">readrestartfiles</span>
<a name="ln-1635"></a>
<a name="ln-1636"></a>      <span class="k">use </span><span class="n">modsurfdata</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">ustar</span><span class="p">,</span> <span class="n">thlflux</span><span class="p">,</span> <span class="n">qtflux</span><span class="p">,</span> <span class="n">svflux</span><span class="p">,</span> <span class="n">dudz</span><span class="p">,</span> <span class="n">dvdz</span><span class="p">,</span> <span class="n">dthldz</span><span class="p">,</span> <span class="n">dqtdz</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">thls</span><span class="p">,</span> <span class="n">qts</span><span class="p">,</span> <span class="n">thvs</span><span class="p">,</span> <span class="n">oblav</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1637"></a>         <span class="n">wtsurf</span>
<a name="ln-1638"></a>      <span class="k">use </span><span class="n">modfields</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">u0</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">thl0</span><span class="p">,</span> <span class="n">qt0</span><span class="p">,</span> <span class="n">ql0</span><span class="p">,</span> <span class="n">ql0h</span><span class="p">,</span> <span class="n">qtav</span><span class="p">,</span> <span class="n">qlav</span><span class="p">,</span> <span class="n">e120</span><span class="p">,</span> <span class="n">dthvdz</span><span class="p">,</span> <span class="n">presf</span><span class="p">,</span> <span class="n">presh</span><span class="p">,</span> <span class="n">sv0</span><span class="p">,</span> <span class="n">mindist</span><span class="p">,</span> <span class="n">wall</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1639"></a>         <span class="n">uav</span><span class="p">,</span> <span class="n">vav</span><span class="p">,</span> <span class="n">wav</span><span class="p">,</span> <span class="n">uuav</span><span class="p">,</span> <span class="n">vvav</span><span class="p">,</span> <span class="n">wwav</span><span class="p">,</span> <span class="n">uvav</span><span class="p">,</span> <span class="n">uwav</span><span class="p">,</span> <span class="n">vwav</span><span class="p">,</span> <span class="n">svav</span><span class="p">,</span> <span class="n">thlav</span><span class="p">,</span> <span class="n">thl2av</span><span class="p">,</span> <span class="n">sv2av</span><span class="p">,</span> <span class="n">pres0</span><span class="p">,</span> <span class="n">svm</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1640"></a>         <span class="n">svprof</span><span class="p">,</span> <span class="n">viscratioav</span><span class="p">,</span> <span class="n">thluav</span><span class="p">,</span> <span class="n">thlvav</span><span class="p">,</span> <span class="n">thlwav</span><span class="p">,</span> <span class="n">svuav</span><span class="p">,</span> <span class="n">svvav</span><span class="p">,</span> <span class="n">svwav</span><span class="p">,</span> <span class="n">presav</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1641"></a>         <span class="n">uusgsav</span><span class="p">,</span> <span class="n">vvsgsav</span><span class="p">,</span> <span class="n">wwsgsav</span><span class="p">,</span> <span class="n">uwsgsav</span><span class="p">,</span> <span class="n">thlusgsav</span><span class="p">,</span> <span class="n">thlwsgsav</span><span class="p">,</span> <span class="n">svusgsav</span><span class="p">,</span> <span class="n">svwsgsav</span><span class="p">,</span> <span class="n">tkesgsav</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1642"></a>         <span class="n">strain2av</span><span class="p">,</span> <span class="n">nusgsav</span>
<a name="ln-1643"></a>      <span class="k">use </span><span class="n">modglobal</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">,</span> <span class="n">ih</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">,</span> <span class="n">jh</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">,</span> <span class="n">kh</span><span class="p">,</span> <span class="n">dtheta</span><span class="p">,</span> <span class="n">dqt</span><span class="p">,</span> <span class="n">dsv</span><span class="p">,</span> <span class="n">startfile</span><span class="p">,</span> <span class="n">timee</span><span class="p">,</span> <span class="n">totavtime</span><span class="p">,</span> <span class="n">runavtime</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1644"></a>         <span class="n">iexpnr</span><span class="p">,</span> <span class="n">ntimee</span><span class="p">,</span> <span class="n">rk3step</span><span class="p">,</span> <span class="n">ifinput</span><span class="p">,</span> <span class="n">nsv</span><span class="p">,</span> <span class="n">runtime</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">cexpnr</span><span class="p">,</span> <span class="n">lreadmean</span><span class="p">,</span> <span class="n">lreadminl</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1645"></a>         <span class="n">totinletav</span><span class="p">,</span> <span class="n">lreadscal</span><span class="p">,</span> <span class="n">ltempeq</span><span class="p">,</span> <span class="n">dzf</span><span class="p">,</span> <span class="n">numol</span><span class="p">,</span> <span class="n">prandtlmoli</span>
<a name="ln-1646"></a>      <span class="k">use </span><span class="n">modmpi</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">cmyid</span><span class="p">,</span> <span class="n">myid</span>
<a name="ln-1647"></a>      <span class="k">use </span><span class="n">modsubgriddata</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">ekm</span>
<a name="ln-1648"></a>      <span class="k">use </span><span class="n">modinlet</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">zinterpolate1d</span><span class="p">,</span> <span class="n">zinterpolatet1d</span><span class="p">,</span> <span class="n">zinterpolatew1d</span><span class="p">,</span> <span class="n">zinterpolate2d</span>
<a name="ln-1649"></a>      <span class="k">use </span><span class="n">modinletdata</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">Uinl</span><span class="p">,</span> <span class="n">Urec</span><span class="p">,</span> <span class="n">Wrec</span><span class="p">,</span> <span class="n">Utav</span><span class="p">,</span> <span class="n">Tinl</span><span class="p">,</span> <span class="n">Trec</span><span class="p">,</span> <span class="n">linuf</span><span class="p">,</span> <span class="n">linuh</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1650"></a>         <span class="n">kbin</span><span class="p">,</span> <span class="n">kein</span><span class="p">,</span> <span class="n">lzinzsim</span><span class="p">,</span> <span class="n">utaui</span><span class="p">,</span> <span class="n">Ttav</span><span class="p">,</span> <span class="n">ttaui</span>
<a name="ln-1651"></a>
<a name="ln-1652"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>  <span class="kd">::</span>  <span class="n">dummy3d</span>
<a name="ln-1653"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kbin</span><span class="p">:</span><span class="n">kein</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">Utavin</span>
<a name="ln-1654"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kbin</span><span class="p">:</span><span class="n">kein</span><span class="p">)</span>    <span class="kd">::</span>  <span class="n">Ttavin</span>
<a name="ln-1655"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">kbin</span><span class="p">:</span><span class="n">kein</span><span class="p">)</span>          <span class="kd">::</span>  <span class="n">Uinlin</span>
<a name="ln-1656"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">kbin</span><span class="p">:</span><span class="n">kein</span><span class="p">)</span>          <span class="kd">::</span>  <span class="n">Urecin</span>
<a name="ln-1657"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">kbin</span><span class="p">:</span><span class="n">kein</span><span class="p">)</span>          <span class="kd">::</span>  <span class="n">Tinlin</span>
<a name="ln-1658"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">kbin</span><span class="p">:</span><span class="n">kein</span><span class="p">)</span>          <span class="kd">::</span>  <span class="n">Trecin</span>
<a name="ln-1659"></a>      <span class="kt">real</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">kbin</span><span class="p">:</span><span class="n">kein</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>        <span class="kd">::</span>  <span class="n">Wrecin</span>
<a name="ln-1660"></a>      <span class="kt">character</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span><span class="p">,</span> <span class="n">name2</span><span class="p">,</span> <span class="n">name4</span>
<a name="ln-1661"></a>      <span class="kt">real </span><span class="n">dummy</span>
<a name="ln-1662"></a>      <span class="kt">integer </span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span>
<a name="ln-1663"></a>      <span class="c">!********************************************************************</span>
<a name="ln-1664"></a>
<a name="ln-1665"></a>      <span class="c">!    1.0 Read initfiles</span>
<a name="ln-1666"></a>      <span class="c">!-----------------------------------------------------------------</span>
<a name="ln-1667"></a>      <span class="n">name</span> <span class="o">=</span> <span class="n">startfile</span>
<a name="ln-1668"></a>      <span class="n">name</span><span class="p">(</span><span class="mi">5</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;d&#39;</span>
<a name="ln-1669"></a>      <span class="n">name</span><span class="p">(</span><span class="mi">15</span><span class="p">:</span><span class="mi">17</span><span class="p">)</span> <span class="o">=</span> <span class="n">cmyid</span>
<a name="ln-1670"></a>      <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;loading &#39;</span><span class="p">,</span> <span class="n">name</span>
<a name="ln-1671"></a>      <span class="k">open</span> <span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-1672"></a>
<a name="ln-1673"></a>      <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">mindist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1674"></a>      <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">((((</span><span class="n">wall</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<a name="ln-1675"></a>      <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">u0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1676"></a>      <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">v0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1677"></a>      <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">w0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1678"></a>      <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">pres0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1679"></a>      <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">thl0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1680"></a>      <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">e120</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1681"></a>      <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">ekm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1682"></a>      <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">qt0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1683"></a>      <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">ql0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1684"></a>      <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">ql0h</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1685"></a>      <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="n">timee</span><span class="p">,</span> <span class="n">dt</span>
<a name="ln-1686"></a>      <span class="k">close</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span>
<a name="ln-1687"></a>      <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;finished loading &#39;</span><span class="p">,</span> <span class="n">name</span>
<a name="ln-1688"></a>
<a name="ln-1689"></a>      <span class="k">if</span> <span class="p">((</span><span class="n">nsv</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(</span><span class="n">lreadscal</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1690"></a><span class="k">         </span><span class="n">name</span><span class="p">(</span><span class="mi">5</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span>
<a name="ln-1691"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;loading &#39;</span><span class="p">,</span> <span class="n">name</span>
<a name="ln-1692"></a>         <span class="k">open</span> <span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">)</span>
<a name="ln-1693"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">((((</span><span class="n">sv0</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span><span class="p">)</span>
<a name="ln-1694"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="n">timee</span>
<a name="ln-1695"></a>         <span class="k">close</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span>
<a name="ln-1696"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;finished loading &#39;</span><span class="p">,</span> <span class="n">name</span>
<a name="ln-1697"></a>      <span class="n">elseif</span> <span class="p">((</span><span class="n">nsv</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">lreadscal</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1698"></a><span class="k">         </span><span class="n">sv0</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1699"></a>         <span class="n">svprof</span> <span class="o">=</span> <span class="mf">0.</span>
<a name="ln-1700"></a>      <span class="k">end if</span>
<a name="ln-1701"></a>
<a name="ln-1702"></a>      <span class="c">! read mean variables if asked for by lreadmean</span>
<a name="ln-1703"></a>      <span class="n">name2</span> <span class="o">=</span> <span class="s1">&#39;means   .&#39;</span>
<a name="ln-1704"></a>      <span class="n">name2</span><span class="p">(</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="n">cmyid</span>
<a name="ln-1705"></a>      <span class="n">name2</span><span class="p">(</span><span class="mi">10</span><span class="p">:</span><span class="mi">12</span><span class="p">)</span> <span class="o">=</span> <span class="n">cexpnr</span>
<a name="ln-1706"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">lreadmean</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1707"></a><span class="k">         write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Reading meansXXX.XXX, proc = &#39;</span><span class="p">,</span> <span class="n">myid</span>
<a name="ln-1708"></a>         <span class="k">open</span> <span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="n">name2</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">)</span>
<a name="ln-1709"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="n">totavtime</span><span class="p">,</span> <span class="n">nsv</span>
<a name="ln-1710"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">uav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1711"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">vav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1712"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">wav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1713"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">thlav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1714"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">qtav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1715"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">qlav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1716"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">presav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1717"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">((((</span><span class="n">svav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span><span class="p">)</span>
<a name="ln-1718"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">viscratioav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1719"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">uuav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1720"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">vvav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1721"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">wwav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1722"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">thl2av</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1723"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">((((</span><span class="n">sv2av</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span><span class="p">)</span>
<a name="ln-1724"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">uvav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1725"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">uwav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1726"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">vwav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1727"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">thluav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1728"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">thlvav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1729"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">thlwav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1730"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">((((</span><span class="n">svuav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span><span class="p">)</span>
<a name="ln-1731"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">((((</span><span class="n">svvav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span><span class="p">)</span>
<a name="ln-1732"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">((((</span><span class="n">svwav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span><span class="p">)</span>
<a name="ln-1733"></a>         <span class="k">close</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span>
<a name="ln-1734"></a>         <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Total averaging time so far: &#39;</span><span class="p">,</span> <span class="n">totavtime</span>
<a name="ln-1735"></a>
<a name="ln-1736"></a>         <span class="c">! read &lt;x&#39;y&#39;&gt;_SGS to file.</span>
<a name="ln-1737"></a>         <span class="n">name2</span> <span class="o">=</span> <span class="s1">&#39;SGS__   .&#39;</span>
<a name="ln-1738"></a>         <span class="n">name2</span><span class="p">(</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="n">cmyid</span>
<a name="ln-1739"></a>         <span class="n">name2</span><span class="p">(</span><span class="mi">10</span><span class="p">:</span><span class="mi">12</span><span class="p">)</span> <span class="o">=</span> <span class="n">cexpnr</span>
<a name="ln-1740"></a>         <span class="k">open</span> <span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="n">name2</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">)</span>
<a name="ln-1741"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="n">dummy</span><span class="p">,</span> <span class="n">dummy</span>
<a name="ln-1742"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">uusgsav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1743"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">vvsgsav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1744"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">wwsgsav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span> <span class="o">-</span> <span class="n">jh</span><span class="p">,</span> <span class="n">je</span> <span class="o">+</span> <span class="n">jh</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1745"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">uwsgsav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1746"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">dummy3d</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span> <span class="c">! this is dissresav, which will be computed using other mean quantities</span>
<a name="ln-1747"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">tkesgsav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1748"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">dummy3d</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span> <span class="c">! this is disssgsav, which will be computed using other mean quantities</span>
<a name="ln-1749"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">strain2av</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span> <span class="c">! &lt;SijSij&gt; (NOT &lt;Sij&gt;&lt;Sij&gt; !!) (average over time)</span>
<a name="ln-1750"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">nusgsav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span> <span class="c">! &lt;nu_sgs&gt; (average over time)</span>
<a name="ln-1751"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">thlusgsav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1752"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(((</span><span class="n">thlwsgsav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1753"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">((((</span><span class="n">svusgsav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span> <span class="o">+</span> <span class="n">ih</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span><span class="p">)</span>
<a name="ln-1754"></a>         <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">((((</span><span class="n">svwsgsav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nsv</span><span class="p">)</span>
<a name="ln-1755"></a>         <span class="k">close</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span>
<a name="ln-1756"></a>
<a name="ln-1757"></a>      <span class="k">end if</span>
<a name="ln-1758"></a>
<a name="ln-1759"></a>      <span class="c">! read mean profiles for inlet generator</span>
<a name="ln-1760"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">lreadminl</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1761"></a><span class="k">         if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">lzinzsim</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1762"></a><span class="k">            </span><span class="n">name4</span> <span class="o">=</span> <span class="s1">&#39;meaninlet.   &#39;</span>
<a name="ln-1763"></a>            <span class="n">name4</span><span class="p">(</span><span class="mi">11</span><span class="p">:</span><span class="mi">13</span><span class="p">)</span> <span class="o">=</span> <span class="n">cexpnr</span>
<a name="ln-1764"></a>            <span class="k">open</span> <span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="n">name4</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">)</span>
<a name="ln-1765"></a>            <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="n">totinletav</span> <span class="c">! interval of time-average</span>
<a name="ln-1766"></a>            <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(</span><span class="n">Uinlin</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kbin</span><span class="p">,</span> <span class="n">kein</span><span class="p">)</span>
<a name="ln-1767"></a>            <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(</span><span class="n">Urecin</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kbin</span><span class="p">,</span> <span class="n">kein</span><span class="p">)</span>
<a name="ln-1768"></a>            <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(</span><span class="n">Wrecin</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kbin</span><span class="p">,</span> <span class="n">kein</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-1769"></a>            <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">((</span><span class="n">Utavin</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kbin</span><span class="p">,</span> <span class="n">kein</span><span class="p">)</span>
<a name="ln-1770"></a>            <span class="k">close</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span>
<a name="ln-1771"></a>
<a name="ln-1772"></a>            <span class="k">call </span><span class="n">zinterpolate1d</span><span class="p">(</span><span class="n">Uinlin</span><span class="p">,</span> <span class="n">Uinl</span><span class="p">)</span> <span class="c">! interpolate inlet profile to zgrid</span>
<a name="ln-1773"></a>            <span class="k">call </span><span class="n">zinterpolate1d</span><span class="p">(</span><span class="n">Urecin</span><span class="p">,</span> <span class="n">Urec</span><span class="p">)</span>
<a name="ln-1774"></a>            <span class="k">call </span><span class="n">zinterpolatew1d</span><span class="p">(</span><span class="n">Wrecin</span><span class="p">,</span> <span class="n">Wrec</span><span class="p">)</span>
<a name="ln-1775"></a>            <span class="k">call </span><span class="n">zinterpolate2d</span><span class="p">(</span><span class="n">Utavin</span><span class="p">,</span> <span class="n">Utav</span><span class="p">)</span>
<a name="ln-1776"></a>
<a name="ln-1777"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">ltempeq</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1778"></a><span class="k">               </span><span class="n">name4</span> <span class="o">=</span> <span class="s1">&#39;tempinlet.   &#39;</span>
<a name="ln-1779"></a>               <span class="n">name4</span><span class="p">(</span><span class="mi">11</span><span class="p">:</span><span class="mi">13</span><span class="p">)</span> <span class="o">=</span> <span class="n">cexpnr</span>
<a name="ln-1780"></a>               <span class="k">open</span> <span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="n">name4</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">)</span>
<a name="ln-1781"></a>               <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="n">totinletav</span> <span class="c">! interval of time-average</span>
<a name="ln-1782"></a>               <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(</span><span class="n">Tinlin</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kbin</span><span class="p">,</span> <span class="n">kein</span><span class="p">)</span>
<a name="ln-1783"></a>               <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(</span><span class="n">Trecin</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kbin</span><span class="p">,</span> <span class="n">kein</span><span class="p">)</span>
<a name="ln-1784"></a>               <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">((</span><span class="n">Ttavin</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kbin</span><span class="p">,</span> <span class="n">kein</span><span class="p">)</span>
<a name="ln-1785"></a>               <span class="k">close</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span>
<a name="ln-1786"></a>
<a name="ln-1787"></a>               <span class="k">call </span><span class="n">zinterpolatet1d</span><span class="p">(</span><span class="n">Tinlin</span><span class="p">,</span> <span class="n">Tinl</span><span class="p">)</span>
<a name="ln-1788"></a>               <span class="k">call </span><span class="n">zinterpolatet1d</span><span class="p">(</span><span class="n">Trecin</span><span class="p">,</span> <span class="n">Trec</span><span class="p">)</span>
<a name="ln-1789"></a>               <span class="k">call </span><span class="n">zinterpolate2d</span><span class="p">(</span><span class="n">Ttavin</span><span class="p">,</span> <span class="n">Ttav</span><span class="p">)</span>
<a name="ln-1790"></a>            <span class="k">end if</span> <span class="c">! ltempeq</span>
<a name="ln-1791"></a>
<a name="ln-1792"></a>         <span class="k">else</span> <span class="c">!lzinzsim=.true. -&gt; inlet grid equals sim grid</span>
<a name="ln-1793"></a>            <span class="n">name4</span> <span class="o">=</span> <span class="s1">&#39;meaninlet.   &#39;</span>
<a name="ln-1794"></a>            <span class="n">name4</span><span class="p">(</span><span class="mi">11</span><span class="p">:</span><span class="mi">13</span><span class="p">)</span> <span class="o">=</span> <span class="n">cexpnr</span>
<a name="ln-1795"></a>            <span class="k">open</span> <span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="n">name4</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">)</span>
<a name="ln-1796"></a>            <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="n">totinletav</span> <span class="c">! interval of time-average</span>
<a name="ln-1797"></a>            <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(</span><span class="n">Uinl</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1798"></a>            <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(</span><span class="n">Urec</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1799"></a>            <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(</span><span class="n">Wrec</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-1800"></a>            <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">((</span><span class="n">Utav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1801"></a>
<a name="ln-1802"></a>            <span class="k">close</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span>
<a name="ln-1803"></a>
<a name="ln-1804"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">ltempeq</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1805"></a><span class="k">               </span><span class="n">name4</span> <span class="o">=</span> <span class="s1">&#39;tempinlet.   &#39;</span>
<a name="ln-1806"></a>               <span class="n">name4</span><span class="p">(</span><span class="mi">11</span><span class="p">:</span><span class="mi">13</span><span class="p">)</span> <span class="o">=</span> <span class="n">cexpnr</span>
<a name="ln-1807"></a>               <span class="k">open</span> <span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="n">name4</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">)</span>
<a name="ln-1808"></a>               <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="n">totinletav</span> <span class="c">! interval of time-average</span>
<a name="ln-1809"></a>               <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(</span><span class="n">Tinl</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1810"></a>               <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">(</span><span class="n">Trec</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1811"></a>               <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span> <span class="p">((</span><span class="n">Ttav</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
<a name="ln-1812"></a>
<a name="ln-1813"></a>               <span class="k">close</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span>
<a name="ln-1814"></a>            <span class="k">end if</span> <span class="c">! ltempeq</span>
<a name="ln-1815"></a>         <span class="k">end if</span> <span class="c">! lzinzsim</span>
<a name="ln-1816"></a>
<a name="ln-1817"></a>         <span class="n">utaui</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numol</span><span class="o">*</span><span class="n">Uinl</span><span class="p">(</span><span class="n">kb</span><span class="p">)</span><span class="o">/</span><span class="n">dzf</span><span class="p">(</span><span class="n">kb</span><span class="p">)))</span> <span class="c">! average streamwise friction at inlet (need for first time step)</span>
<a name="ln-1818"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ltempeq</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1819"></a><span class="k">            </span><span class="n">ttaui</span> <span class="o">=</span> <span class="n">numol</span><span class="o">*</span><span class="n">prandtlmoli</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="n">Tinl</span><span class="p">(</span><span class="n">kb</span><span class="p">)</span> <span class="o">-</span> <span class="n">thls</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">dzf</span><span class="p">(</span><span class="n">kb</span><span class="p">)</span><span class="o">*</span><span class="n">utaui</span><span class="p">)</span>
<a name="ln-1820"></a>         <span class="k">end if</span>
<a name="ln-1821"></a><span class="k">      end if</span> <span class="c">!(lreadminl)</span>
<a name="ln-1822"></a>
<a name="ln-1823"></a>   <span class="k">end subroutine </span><span class="n">readrestartfiles</span>
<a name="ln-1824"></a>
<a name="ln-1825"></a>   <span class="k">subroutine </span><span class="n">exitmodules</span>
<a name="ln-1826"></a>      <span class="k">use </span><span class="n">modfields</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">exitfields</span>
<a name="ln-1827"></a>      <span class="k">use </span><span class="n">modglobal</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">exitglobal</span>
<a name="ln-1828"></a>      <span class="k">use </span><span class="n">modmpi</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">exitmpi</span>
<a name="ln-1829"></a>      <span class="k">use </span><span class="n">modpois</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">exitpois</span>
<a name="ln-1830"></a>      <span class="k">use </span><span class="n">modsubgrid</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">exitsubgrid</span>
<a name="ln-1831"></a>      <span class="k">use </span><span class="n">modthermodynamics</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">exitthermodynamics</span>
<a name="ln-1832"></a>      <span class="k">use </span><span class="n">modinlet</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">exitinlet</span>
<a name="ln-1833"></a>
<a name="ln-1834"></a>      <span class="k">call </span><span class="n">exitthermodynamics</span>
<a name="ln-1835"></a>      <span class="k">call </span><span class="n">exitsubgrid</span>
<a name="ln-1836"></a>      <span class="k">call </span><span class="n">exitpois</span>
<a name="ln-1837"></a>      <span class="k">call </span><span class="n">exitfields</span>
<a name="ln-1838"></a>      <span class="k">call </span><span class="n">exitglobal</span>
<a name="ln-1839"></a>      <span class="k">call </span><span class="n">exitinlet</span>
<a name="ln-1840"></a>      <span class="k">call </span><span class="n">exitmpi</span>
<a name="ln-1841"></a>
<a name="ln-1842"></a>   <span class="k">end subroutine </span><span class="n">exitmodules</span>
<a name="ln-1843"></a>
<a name="ln-1844"></a>   <span class="k">subroutine </span><span class="n">randomnize</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">klev</span><span class="p">,</span> <span class="n">ampl</span><span class="p">,</span> <span class="n">ir</span><span class="p">,</span> <span class="n">ihl</span><span class="p">,</span> <span class="n">jhl</span><span class="p">)</span>
<a name="ln-1845"></a>
<a name="ln-1846"></a>      <span class="k">use </span><span class="n">modmpi</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">myid</span><span class="p">,</span> <span class="n">nprocs</span>
<a name="ln-1847"></a>      <span class="k">use </span><span class="n">modglobal</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">,</span> <span class="n">imax</span><span class="p">,</span> <span class="n">jmax</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">,</span> <span class="n">kh</span>
<a name="ln-1848"></a>      <span class="kt">integer</span><span class="p">(</span><span class="nb">KIND</span><span class="o">=</span><span class="nb">selected_int_kind</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span><span class="kd">::</span> <span class="n">imm</span><span class="p">,</span> <span class="n">ia</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">ir</span>
<a name="ln-1849"></a>      <span class="kt">integer </span><span class="n">ihl</span><span class="p">,</span> <span class="n">jhl</span>
<a name="ln-1850"></a>      <span class="kt">integer </span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">klev</span>
<a name="ln-1851"></a>      <span class="kt">integer </span><span class="n">m</span><span class="p">,</span> <span class="n">mfac</span>
<a name="ln-1852"></a>      <span class="kt">real </span><span class="n">ran</span><span class="p">,</span> <span class="n">ampl</span>
<a name="ln-1853"></a>      <span class="kt">real </span><span class="n">field</span><span class="p">(</span><span class="n">ib</span> <span class="o">-</span> <span class="n">ihl</span><span class="p">:</span><span class="n">ie</span> <span class="o">+</span> <span class="n">ihl</span><span class="p">,</span> <span class="n">jb</span> <span class="o">-</span> <span class="n">jhl</span><span class="p">:</span><span class="n">je</span> <span class="o">+</span> <span class="n">jhl</span><span class="p">,</span> <span class="n">kb</span> <span class="o">-</span> <span class="n">kh</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="n">kh</span><span class="p">)</span>
<a name="ln-1854"></a>      <span class="k">parameter</span><span class="p">(</span><span class="n">imm</span><span class="o">=</span><span class="mi">134456</span><span class="p">,</span> <span class="n">ia</span><span class="o">=</span><span class="mi">8121</span><span class="p">,</span> <span class="n">ic</span><span class="o">=</span><span class="mi">28411</span><span class="p">)</span>
<a name="ln-1855"></a>
<a name="ln-1856"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">myid</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1857"></a><span class="k">         </span><span class="n">mfac</span> <span class="o">=</span> <span class="n">myid</span><span class="o">*</span><span class="n">jmax</span><span class="o">*</span><span class="n">imax</span>
<a name="ln-1858"></a>         <span class="k">do </span><span class="n">m</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mfac</span>
<a name="ln-1859"></a>            <span class="n">ir</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">((</span><span class="n">ir</span><span class="p">)</span><span class="o">*</span><span class="n">ia</span> <span class="o">+</span> <span class="n">ic</span><span class="p">,</span> <span class="n">imm</span><span class="p">)</span>
<a name="ln-1860"></a>
<a name="ln-1861"></a>         <span class="k">end do</span>
<a name="ln-1862"></a><span class="k">      end if</span>
<a name="ln-1863"></a><span class="k">      do </span><span class="n">j</span> <span class="o">=</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span>
<a name="ln-1864"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ie</span>
<a name="ln-1865"></a>         <span class="n">ir</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">((</span><span class="n">ir</span><span class="p">)</span><span class="o">*</span><span class="n">ia</span> <span class="o">+</span> <span class="n">ic</span><span class="p">,</span> <span class="n">imm</span><span class="p">)</span>
<a name="ln-1866"></a>         <span class="n">ran</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">ir</span><span class="p">)</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="n">imm</span><span class="p">)</span>
<a name="ln-1867"></a>         <span class="n">field</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">klev</span><span class="p">)</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">klev</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">ran</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="mf">2.0</span><span class="o">*</span><span class="n">ampl</span>
<a name="ln-1868"></a>      <span class="k">end do</span>
<a name="ln-1869"></a><span class="k">      end do</span>
<a name="ln-1870"></a>
<a name="ln-1871"></a><span class="k">      if</span> <span class="p">(</span><span class="n">nprocs</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">myid</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1872"></a><span class="k">         </span><span class="n">mfac</span> <span class="o">=</span> <span class="p">(</span><span class="n">nprocs</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">myid</span><span class="p">)</span><span class="o">*</span><span class="n">imax</span><span class="o">*</span><span class="n">jmax</span>
<a name="ln-1873"></a>         <span class="k">do </span><span class="n">m</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mfac</span>
<a name="ln-1874"></a>            <span class="n">ir</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">((</span><span class="n">ir</span><span class="p">)</span><span class="o">*</span><span class="n">ia</span> <span class="o">+</span> <span class="n">ic</span><span class="p">,</span> <span class="n">imm</span><span class="p">)</span>
<a name="ln-1875"></a>         <span class="k">end do</span>
<a name="ln-1876"></a><span class="k">      end if</span>
<a name="ln-1877"></a>
<a name="ln-1878"></a><span class="k">      return</span>
<a name="ln-1879"></a><span class="k">   end subroutine </span><span class="n">randomnize</span>
<a name="ln-1880"></a>
<a name="ln-1881"></a>   <span class="k">subroutine </span><span class="n">createmasks</span>
<a name="ln-1882"></a>      <span class="k">use </span><span class="n">modglobal</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">ib</span><span class="p">,</span> <span class="n">ie</span><span class="p">,</span> <span class="n">ih</span><span class="p">,</span> <span class="n">ihc</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">je</span><span class="p">,</span> <span class="n">jh</span><span class="p">,</span> <span class="n">jhc</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span><span class="p">,</span> <span class="n">kh</span><span class="p">,</span> <span class="n">khc</span><span class="p">,</span> <span class="n">rslabs</span><span class="p">,</span> <span class="n">jmax</span><span class="p">,</span> <span class="n">nblocks</span><span class="p">,&amp;</span>
<a name="ln-1883"></a>         <span class="n">ifinput</span><span class="p">,</span> <span class="n">cexpnr</span><span class="p">,</span> <span class="n">libm</span><span class="p">,</span> <span class="n">jtot</span><span class="p">,</span> <span class="k">block</span>
<a name="ln-1884"></a><span class="k">      use </span><span class="n">modfields</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">IIc</span><span class="p">,</span> <span class="n">IIu</span><span class="p">,</span> <span class="n">IIv</span><span class="p">,</span> <span class="n">IIw</span><span class="p">,</span> <span class="n">IIuw</span><span class="p">,</span> <span class="n">IIvw</span><span class="p">,</span> <span class="n">IIuv</span><span class="p">,</span> <span class="n">IIct</span><span class="p">,</span> <span class="n">IIwt</span><span class="p">,</span> <span class="n">IIut</span><span class="p">,</span> <span class="n">IIuwt</span><span class="p">,</span> <span class="n">IIvt</span><span class="p">,&amp;</span>
<a name="ln-1885"></a>         <span class="n">IIcs</span><span class="p">,</span> <span class="n">IIus</span><span class="p">,</span> <span class="n">IIuws</span><span class="p">,</span> <span class="n">IIvws</span><span class="p">,</span> <span class="n">IIuvs</span><span class="p">,</span> <span class="n">IIvs</span><span class="p">,</span> <span class="n">IIws</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1886"></a>         <span class="n">um</span><span class="p">,</span> <span class="n">u0</span><span class="p">,</span> <span class="n">vm</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">wm</span><span class="p">,</span> <span class="n">w0</span>
<a name="ln-1887"></a>      <span class="k">use </span><span class="n">modmpi</span><span class="p">,</span> <span class="k">only</span><span class="p">:</span><span class="n">myid</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="n">MPI_DOUBLE_PRECISION</span><span class="p">,</span> <span class="n">MY_REAL</span><span class="p">,</span> <span class="n">nprocs</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1888"></a>         <span class="n">cmyid</span><span class="p">,</span> <span class="n">MPI_REAL8</span><span class="p">,</span> <span class="n">MPI_REAL4</span><span class="p">,</span> <span class="n">MPI_SUM</span><span class="p">,</span> <span class="n">excjs</span>
<a name="ln-1889"></a>      <span class="c">! use initfac, only:block</span>
<a name="ln-1890"></a>      <span class="kt">integer </span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">il</span><span class="p">,</span> <span class="n">iu</span><span class="p">,</span> <span class="n">jl</span><span class="p">,</span> <span class="n">ju</span><span class="p">,</span> <span class="n">kl</span><span class="p">,</span> <span class="n">ku</span>
<a name="ln-1891"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">IIcl</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="n">khc</span><span class="p">),</span> <span class="n">IIul</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="n">khc</span><span class="p">),</span> <span class="n">IIvl</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="n">khc</span><span class="p">),</span> <span class="n">IIwl</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="n">khc</span><span class="p">),</span> <span class="n">IIuwl</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="n">khc</span><span class="p">),</span> <span class="n">IIvwl</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="n">khc</span><span class="p">),</span> <span class="n">IIuvl</span><span class="p">(</span><span class="n">kb</span><span class="p">:</span><span class="n">ke</span> <span class="o">+</span> <span class="n">khc</span><span class="p">)</span>
<a name="ln-1892"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">IIcd</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-1893"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">IIwd</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-1894"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">IIuwd</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-1895"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">IIud</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-1896"></a>      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">IIvd</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span>
<a name="ln-1897"></a>      <span class="kt">character</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span> <span class="n">chmess</span><span class="p">,</span> <span class="n">name2</span>
<a name="ln-1898"></a>
<a name="ln-1899"></a>      <span class="c">! II*l needn&#39;t be defined up to ke_khc, but for now would require large scale changes in modstatsdump so if works leave as is ! tg3315 04/07/18</span>
<a name="ln-1900"></a>
<a name="ln-1901"></a>      <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">libm</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1902"></a><span class="k">         </span><span class="n">IIc</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1903"></a>         <span class="n">IIu</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1904"></a>         <span class="n">IIv</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1905"></a>         <span class="n">IIw</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1906"></a>         <span class="n">IIuw</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1907"></a>         <span class="n">IIvw</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1908"></a>         <span class="n">IIuv</span><span class="p">(:,</span> <span class="p">:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1909"></a>         <span class="n">IIcs</span><span class="p">(:)</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span><span class="n">rslabs</span><span class="p">)</span>
<a name="ln-1910"></a>         <span class="n">IIus</span><span class="p">(:)</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span><span class="n">rslabs</span><span class="p">)</span>
<a name="ln-1911"></a>         <span class="n">IIvs</span><span class="p">(:)</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span><span class="n">rslabs</span><span class="p">)</span>
<a name="ln-1912"></a>         <span class="n">IIws</span><span class="p">(:)</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span><span class="n">rslabs</span><span class="p">)</span>
<a name="ln-1913"></a>         <span class="n">IIuws</span><span class="p">(:)</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span><span class="n">rslabs</span><span class="p">)</span>
<a name="ln-1914"></a>         <span class="n">IIvws</span><span class="p">(:)</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span><span class="n">rslabs</span><span class="p">)</span>
<a name="ln-1915"></a>         <span class="n">IIuvs</span><span class="p">(:)</span> <span class="o">=</span> <span class="nb">nint</span><span class="p">(</span><span class="n">rslabs</span><span class="p">)</span>
<a name="ln-1916"></a>         <span class="n">IIct</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">jtot</span> 
<a name="ln-1917"></a>         <span class="n">IIut</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">jtot</span>
<a name="ln-1918"></a>         <span class="n">IIvt</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">jtot</span>
<a name="ln-1919"></a>         <span class="n">IIwt</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">jtot</span>
<a name="ln-1920"></a>         <span class="n">IIuwt</span><span class="p">(:,</span> <span class="p">:)</span> <span class="o">=</span> <span class="n">jtot</span>
<a name="ln-1921"></a>         <span class="k">return</span>
<a name="ln-1922"></a><span class="k">      end if</span>
<a name="ln-1923"></a>
<a name="ln-1924"></a><span class="k">      allocate</span> <span class="p">(</span><span class="k">block</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nblocks</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">11</span><span class="p">))</span>
<a name="ln-1925"></a>
<a name="ln-1926"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">myid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1927"></a><span class="k">         if</span> <span class="p">(</span><span class="n">nblocks</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1928"></a><span class="k">            open</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;blocks.inp.&#39;</span><span class="o">//</span><span class="n">cexpnr</span><span class="p">)</span>
<a name="ln-1929"></a>            <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-1930"></a>            <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="s1">&#39;(a80)&#39;</span><span class="p">)</span> <span class="n">chmess</span>
<a name="ln-1931"></a>            <span class="k">do </span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nblocks</span>
<a name="ln-1932"></a>               <span class="k">read</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1933"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1934"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1935"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1936"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1937"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1938"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1939"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1940"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1941"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1942"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1943"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
<a name="ln-1944"></a>            <span class="k">end do</span>
<a name="ln-1945"></a><span class="k">            close</span> <span class="p">(</span><span class="n">ifinput</span><span class="p">)</span>
<a name="ln-1946"></a>
<a name="ln-1947"></a>            <span class="k">do </span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nblocks</span>
<a name="ln-1948"></a>               <span class="k">write</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1949"></a>                  <span class="n">n</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1950"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1951"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1952"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1953"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1954"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-1955"></a>                  <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<a name="ln-1956"></a>            <span class="k">end do</span>
<a name="ln-1957"></a><span class="k">         end if</span> <span class="c">!nblocks&gt;0</span>
<a name="ln-1958"></a>      <span class="k">end if</span> <span class="c">!myid</span>
<a name="ln-1959"></a>
<a name="ln-1960"></a>      <span class="k">call </span><span class="n">MPI_BCAST</span><span class="p">(</span><span class="k">block</span><span class="p">,</span> <span class="mi">11</span><span class="o">*</span><span class="n">nblocks</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-1961"></a>
<a name="ln-1962"></a>      <span class="c">! Create masking matrices</span>
<a name="ln-1963"></a>      <span class="n">IIc</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIu</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIct</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIw</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIuw</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIvw</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIuv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIwt</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIut</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIvt</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIuwt</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIcs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIus</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIvs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIws</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIuws</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIvws</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">IIuvs</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-1964"></a>
<a name="ln-1965"></a>      <span class="k">do </span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nblocks</span>
<a name="ln-1966"></a>         <span class="n">il</span> <span class="o">=</span> <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-1967"></a>         <span class="n">iu</span> <span class="o">=</span> <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-1968"></a>         <span class="c">!kl = block(n, 5)</span>
<a name="ln-1969"></a>         <span class="n">kl</span> <span class="o">=</span> <span class="n">kb</span> <span class="c">! tg3315 changed as buildings for lEB must start at kb+1 not kb with no block below</span>
<a name="ln-1970"></a>         <span class="n">ku</span> <span class="o">=</span> <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<a name="ln-1971"></a>         <span class="n">jl</span> <span class="o">=</span> <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">myid</span><span class="o">*</span><span class="n">jmax</span>
<a name="ln-1972"></a>         <span class="n">ju</span> <span class="o">=</span> <span class="k">block</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="n">myid</span><span class="o">*</span><span class="n">jmax</span>
<a name="ln-1973"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ju</span> <span class="o">&lt;</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">jl</span> <span class="o">&gt;</span> <span class="n">je</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1974"></a><span class="k">            cycle</span>
<a name="ln-1975"></a><span class="k">         else</span>
<a name="ln-1976"></a><span class="k">            if</span> <span class="p">(</span><span class="n">ju</span> <span class="o">&gt;=</span> <span class="n">je</span><span class="p">)</span> <span class="k">then</span> <span class="c">!tg3315 04/07/18 to avoid ju+1 when is last cell...</span>
<a name="ln-1977"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">jl</span> <span class="o">&lt;</span> <span class="n">jb</span><span class="p">)</span> <span class="n">jl</span> <span class="o">=</span> <span class="n">jb</span>
<a name="ln-1978"></a>               <span class="n">ju</span> <span class="o">=</span> <span class="n">je</span>
<a name="ln-1979"></a>
<a name="ln-1980"></a>               <span class="c">! Masking matrices !tg3315</span>
<a name="ln-1981"></a>               <span class="n">IIc</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span><span class="p">,</span> <span class="n">jl</span><span class="p">:</span><span class="n">ju</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1982"></a>               <span class="n">IIu</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jl</span><span class="p">:</span><span class="n">ju</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1983"></a>               <span class="n">IIv</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span><span class="p">,</span> <span class="n">jl</span><span class="p">:</span><span class="n">ju</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1984"></a>               <span class="n">IIw</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span><span class="p">,</span> <span class="n">jl</span><span class="p">:</span><span class="n">ju</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1985"></a>               <span class="n">IIuw</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jl</span><span class="p">:</span><span class="n">ju</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1986"></a>               <span class="n">IIvw</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span><span class="p">,</span> <span class="n">jl</span><span class="p">:</span><span class="n">ju</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1987"></a>               <span class="n">IIuv</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jl</span><span class="p">:</span><span class="n">ju</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1988"></a>
<a name="ln-1989"></a>            <span class="k">else if</span> <span class="p">(</span><span class="n">ju</span> <span class="o">==</span> <span class="n">jb</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span> <span class="c">! if end of block is in cell before proc</span>
<a name="ln-1990"></a>
<a name="ln-1991"></a>               <span class="n">IIv</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1992"></a>               <span class="n">IIvw</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1993"></a>               <span class="n">IIuv</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1994"></a>
<a name="ln-1995"></a>            <span class="k">else</span> <span class="c">! ju is in this proc...</span>
<a name="ln-1996"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">jl</span> <span class="o">&lt;</span> <span class="n">jb</span><span class="p">)</span> <span class="n">jl</span> <span class="o">=</span> <span class="n">jb</span>
<a name="ln-1997"></a>
<a name="ln-1998"></a>               <span class="c">! Masking matrices !tg3315</span>
<a name="ln-1999"></a>               <span class="n">IIc</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span><span class="p">,</span> <span class="n">jl</span><span class="p">:</span><span class="n">ju</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2000"></a>               <span class="n">IIu</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jl</span><span class="p">:</span><span class="n">ju</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2001"></a>               <span class="n">IIv</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span><span class="p">,</span> <span class="n">jl</span><span class="p">:</span><span class="n">ju</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2002"></a>               <span class="n">IIw</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span><span class="p">,</span> <span class="n">jl</span><span class="p">:</span><span class="n">ju</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2003"></a>               <span class="n">IIuw</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jl</span><span class="p">:</span><span class="n">ju</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2004"></a>               <span class="n">IIvw</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span><span class="p">,</span> <span class="n">jl</span><span class="p">:</span><span class="n">ju</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2005"></a>               <span class="n">IIuv</span><span class="p">(</span><span class="n">il</span><span class="p">:</span><span class="n">iu</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jl</span><span class="p">:</span><span class="n">ju</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kl</span><span class="p">:</span><span class="n">ku</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2006"></a>
<a name="ln-2007"></a>            <span class="k">end if</span>
<a name="ln-2008"></a>
<a name="ln-2009"></a>            <span class="c">! ensure that ghost cells know where blocks are !tg3315 this is not necessary</span>
<a name="ln-2010"></a>            <span class="c">! if (jl&lt;jb+jh)  IIc(il:iu,je+jh,kl:ku) = 0</span>
<a name="ln-2011"></a>            <span class="c">! if (jl&lt;jb+jhc) IIc(il:iu,je+jhc,kl:ku) = 0</span>
<a name="ln-2012"></a>            <span class="c">! if (ju&gt;je-jh)  IIc(il:iu,jb-jh,kl:ku) = 0</span>
<a name="ln-2013"></a>            <span class="c">! if (ju&gt;je-jhc) IIc(il:iu,jb-jhc,kl:ku) = 0</span>
<a name="ln-2014"></a>
<a name="ln-2015"></a>            <span class="c">! if (il&lt;ib+ih)  IIc(ie+ih,jl:ju,kl:ku) = 0</span>
<a name="ln-2016"></a>            <span class="c">! if (il&lt;ib+ihc) IIc(ie+ihc,jl:ju,kl:ku) = 0</span>
<a name="ln-2017"></a>            <span class="c">! if (iu&gt;ie-ih)  IIc(ib-ih,jl:ju,kl:ku) = 0</span>
<a name="ln-2018"></a>            <span class="c">! if (iu&gt;ie-ihc) IIc(ib-ihc,jl:ju,kl:ku) = 0</span>
<a name="ln-2019"></a>
<a name="ln-2020"></a>         <span class="k">end if</span>
<a name="ln-2021"></a><span class="k">      end do</span>
<a name="ln-2022"></a>
<a name="ln-2023"></a><span class="k">      </span><span class="n">IIw</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">kb</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">IIuw</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">kb</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">IIvw</span><span class="p">(:,</span> <span class="p">:,</span> <span class="n">kb</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-2024"></a>
<a name="ln-2025"></a>      <span class="c">! for correct ghost cells from adjacent processors !tg3315 ?unsure if this is correct</span>
<a name="ln-2026"></a>      <span class="c">! tg3315 22/11/17 does not work because II is an integer and needs real numbers... !tg3315 not necessary</span>
<a name="ln-2027"></a>      <span class="c">!call excjs( IIc  , ib,ie,jb,je,kb,ke+khc,ihc,jhc)</span>
<a name="ln-2028"></a>      <span class="c">!call excjs( IIu  , ib,ie,jb,je,kb,ke+khc,ihc,jhc)</span>
<a name="ln-2029"></a>      <span class="c">!call excjs( IIv  , ib,ie,jb,je,kb,ke+khc,ihc,jhc)</span>
<a name="ln-2030"></a>      <span class="c">!call excjs( IIw  , ib,ie,jb,je,kb,ke+khc,ihc,jhc)</span>
<a name="ln-2031"></a>
<a name="ln-2032"></a>      <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">khc</span>
<a name="ln-2033"></a>         <span class="n">IIcl</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">IIc</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-2034"></a>         <span class="n">IIul</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">IIu</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-2035"></a>         <span class="n">IIvl</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">IIv</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-2036"></a>         <span class="n">IIwl</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">IIw</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-2037"></a>         <span class="n">IIuwl</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">IIuw</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-2038"></a>         <span class="n">IIvwl</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">IIvw</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-2039"></a>         <span class="n">IIuvl</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">IIuv</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<a name="ln-2040"></a>      <span class="n">enddo</span>
<a name="ln-2041"></a>
<a name="ln-2042"></a>      <span class="k">call </span><span class="n">MPI_ALLREDUCE</span><span class="p">(</span><span class="n">IIcl</span><span class="p">,</span> <span class="n">IIcs</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">khc</span> <span class="o">-</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2043"></a>                         <span class="n">MPI_SUM</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-2044"></a>      <span class="k">call </span><span class="n">MPI_ALLREDUCE</span><span class="p">(</span><span class="n">IIul</span><span class="p">,</span> <span class="n">IIus</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">khc</span> <span class="o">-</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2045"></a>                         <span class="n">MPI_SUM</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-2046"></a>      <span class="k">call </span><span class="n">MPI_ALLREDUCE</span><span class="p">(</span><span class="n">IIvl</span><span class="p">,</span> <span class="n">IIvs</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">khc</span> <span class="o">-</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2047"></a>                         <span class="n">MPI_SUM</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-2048"></a>      <span class="k">call </span><span class="n">MPI_ALLREDUCE</span><span class="p">(</span><span class="n">IIwl</span><span class="p">,</span> <span class="n">IIws</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">khc</span> <span class="o">-</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2049"></a>                         <span class="n">MPI_SUM</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-2050"></a>      <span class="k">call </span><span class="n">MPI_ALLREDUCE</span><span class="p">(</span><span class="n">IIuwl</span><span class="p">,</span> <span class="n">IIuws</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">khc</span> <span class="o">-</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2051"></a>                         <span class="n">MPI_SUM</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-2052"></a>      <span class="k">call </span><span class="n">MPI_ALLREDUCE</span><span class="p">(</span><span class="n">IIvwl</span><span class="p">,</span> <span class="n">IIvws</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">khc</span> <span class="o">-</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2053"></a>                         <span class="n">MPI_SUM</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-2054"></a>      <span class="k">call </span><span class="n">MPI_ALLREDUCE</span><span class="p">(</span><span class="n">IIuvl</span><span class="p">,</span> <span class="n">IIuvs</span><span class="p">,</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">khc</span> <span class="o">-</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2055"></a>                         <span class="n">MPI_SUM</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-2056"></a>
<a name="ln-2057"></a>      <span class="n">IIcd</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">IIc</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span> <span class="nb">DIM</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-2058"></a>      <span class="n">IIwd</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">IIw</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span> <span class="nb">DIM</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-2059"></a>      <span class="n">IIuwd</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">IIuw</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span> <span class="nb">DIM</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-2060"></a>      <span class="n">IIud</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">IIu</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span> <span class="nb">DIM</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-2061"></a>      <span class="n">IIvd</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">IIv</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">jb</span><span class="p">:</span><span class="n">je</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span> <span class="nb">DIM</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-2062"></a>
<a name="ln-2063"></a>      <span class="k">call </span><span class="n">MPI_ALLREDUCE</span><span class="p">(</span><span class="n">IIwd</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span> <span class="n">IIwt</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span> <span class="p">(</span><span class="n">ke</span> <span class="o">-</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ie</span> <span class="o">-</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="n">MPI_SUM</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-2064"></a>      <span class="k">call </span><span class="n">MPI_ALLREDUCE</span><span class="p">(</span><span class="n">IIcd</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span> <span class="n">IIct</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span> <span class="p">(</span><span class="n">ke</span> <span class="o">-</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ie</span> <span class="o">-</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="n">MPI_SUM</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-2065"></a>      <span class="k">call </span><span class="n">MPI_ALLREDUCE</span><span class="p">(</span><span class="n">IIuwd</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span> <span class="n">IIuwt</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span> <span class="p">(</span><span class="n">ke</span> <span class="o">-</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ie</span> <span class="o">-</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="n">MPI_SUM</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-2066"></a>      <span class="k">call </span><span class="n">MPI_ALLREDUCE</span><span class="p">(</span><span class="n">IIud</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span> <span class="n">IIut</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span> <span class="p">(</span><span class="n">ke</span> <span class="o">-</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ie</span> <span class="o">-</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="n">MPI_SUM</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-2067"></a>      <span class="k">call </span><span class="n">MPI_ALLREDUCE</span><span class="p">(</span><span class="n">IIvd</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span> <span class="n">IIvt</span><span class="p">(</span><span class="n">ib</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span> <span class="n">kb</span><span class="p">:</span><span class="n">ke</span><span class="p">),</span> <span class="p">(</span><span class="n">ke</span> <span class="o">-</span> <span class="n">kb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ie</span> <span class="o">-</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">MPI_INTEGER</span><span class="p">,</span> <span class="n">MPI_SUM</span><span class="p">,</span> <span class="n">comm3d</span><span class="p">,</span> <span class="n">mpierr</span><span class="p">)</span>
<a name="ln-2068"></a>
<a name="ln-2069"></a>      <span class="c">! masking matrix for switch if entire slab is blocks</span>
<a name="ln-2070"></a>      <span class="c">!if (IIcs(kb) == 0) then</span>
<a name="ln-2071"></a>      <span class="c">!  IIbl = 0</span>
<a name="ln-2072"></a>      <span class="c">!else</span>
<a name="ln-2073"></a>      <span class="c">!  IIbl = 1</span>
<a name="ln-2074"></a>      <span class="c">!end if</span>
<a name="ln-2075"></a>
<a name="ln-2076"></a>      <span class="c">!where (IIcs == 0)</span>
<a name="ln-2077"></a>      <span class="c">!IIcs = nint(rslabs)</span>
<a name="ln-2078"></a>      <span class="c">!endwhere</span>
<a name="ln-2079"></a>      <span class="c">!where (IIus == 0)</span>
<a name="ln-2080"></a>      <span class="c">!IIus = nint(rslabs)</span>
<a name="ln-2081"></a>      <span class="c">!endwhere</span>
<a name="ln-2082"></a>      <span class="c">!where (IIvs == 0)</span>
<a name="ln-2083"></a>      <span class="c">!IIvs = nint(rslabs)</span>
<a name="ln-2084"></a>      <span class="c">!endwhere</span>
<a name="ln-2085"></a>      <span class="c">!where (IIws == 0)</span>
<a name="ln-2086"></a>      <span class="c">!IIws = nint(rslabs)</span>
<a name="ln-2087"></a>      <span class="c">!endwhere</span>
<a name="ln-2088"></a>      <span class="c">!where (IIuws == 0)</span>
<a name="ln-2089"></a>      <span class="c">!IIuws = nint(rslabs)</span>
<a name="ln-2090"></a>      <span class="c">!endwhere</span>
<a name="ln-2091"></a>      <span class="c">!where (IIvws == 0)</span>
<a name="ln-2092"></a>      <span class="c">!IIvws = nint(rslabs)</span>
<a name="ln-2093"></a>      <span class="c">!endwhere</span>
<a name="ln-2094"></a>
<a name="ln-2095"></a>      <span class="c">! use masking matrices to set 0 in blocks from start? tg3315 13/12/17</span>
<a name="ln-2096"></a>      <span class="c">! um(ib-ih:ie+ih,jb-jh:je+jh,kb:ke+kh) = IIu(ib-ih:ie+ih,jb-jh:je+jh,kb:ke+kh)*um(ib-ih:ie+ih,jb-jh:je+jh,kb:ke+kh)</span>
<a name="ln-2097"></a>      <span class="c">! vm(ib-ih:ie+ih,jb-jh:je+jh,kb:ke+kh) = IIv(ib-ih:ie+ih,jb-jh:je+jh,kb:ke+kh)*vm(ib-ih:ie+ih,jb-jh:je+jh,kb:ke+kh)</span>
<a name="ln-2098"></a>      <span class="c">! wm(ib-ih:ie+ih,jb-jh:je+jh,kb:ke+kh) = IIw(ib-ih:ie+ih,jb-jh:je+jh,kb:ke+kh)*wm(ib-ih:ie+ih,jb-jh:je+jh,kb:ke+kh)</span>
<a name="ln-2099"></a>
<a name="ln-2100"></a>      <span class="c">! u0 = um</span>
<a name="ln-2101"></a>      <span class="c">! v0 = vm</span>
<a name="ln-2102"></a>      <span class="c">! w0 = wm</span>
<a name="ln-2103"></a>
<a name="ln-2104"></a>   <span class="k">end subroutine </span><span class="n">createmasks</span>
<a name="ln-2105"></a>
<a name="ln-2106"></a><span class="k">end module </span><span class="n">modstartup</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2021 
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
            
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> uDALES was developed by The uDALES Team</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>